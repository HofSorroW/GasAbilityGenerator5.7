# Father Companion System - Complete Manifest
# Version: 3.0.3
# Engine: Unreal Engine 5.7
# Plugin: Narrative Pro v2.2
# Total Tags: 216
# Total Assets: 166
# Event Graph Support: ENABLED
# NPC Systems: Warden Husk, Guard Formation, Possessed Exploder, Support Buffer, Biomechanical Detachment, Gatherer Scout, Stalker Random Aggression

# ============================================================================
# DISABLED/PLACEHOLDER ENTRIES TRACKER
# ============================================================================
# The following entries have placeholders or are disabled pending external dependencies.
#
# | Entry Name          | Status      | Issue                         | Fix When                      |
# |---------------------|-------------|-------------------------------|-------------------------------|
# | GA_FatherRifle      | PLACEHOLDER | item_class: NarrativeItem     | Change to EI_FatherRifleWeapon after first gen |
# | GA_FatherSword      | PLACEHOLDER | item_class: NarrativeItem     | Change to EI_FatherSwordWeapon after first gen |
# | animation_montages  | COMMENTED   | SK_FatherCompanion missing    | Uncomment after skeleton import |
# | animation_notifies  | COMMENTED   | Depends on AM_FatherAttack    | Uncomment after montages ready  |
#
# Search for "TODO:" comments to find all placeholders
# ============================================================================

project_root: /Game/FatherCompanion
tags_ini_path: Config/DefaultGameplayTags.ini

# ============================================================================
# GAMEPLAY TAGS (202 total)
# ============================================================================
tags:
  # Ability Tags (25)
  - tag: Ability.Father.Armor
    comment: Form activation ability
  - tag: Ability.Father.Attack
    comment: Crawler melee attack
  - tag: Ability.Father.Backstab
    comment: Passive backstab damage bonus
  - tag: Ability.Father.Crawler
    comment: Form activation ability
  - tag: Ability.Father.DomeBurst
    comment: Armor form active burst
  - tag: Ability.Father.ElectricTrap
    comment: Engineer electric web trap
  - tag: Ability.Father.Engineer
    comment: Form activation ability
  - tag: Ability.Father.Engineer.ElectricTrap
    comment: Hierarchical child - electric trap
  - tag: Ability.Father.Engineer.TurretShoot
    comment: Hierarchical child - turret shoot
  - tag: Ability.Father.Exoskeleton
    comment: Form activation ability
  - tag: Ability.Father.Exoskeleton.Dash
    comment: Hierarchical child - dash ability
  - tag: Ability.Father.Exoskeleton.Sprint
    comment: Hierarchical child - sprint ability
  - tag: Ability.Father.LaserShot
    comment: Crawler ranged laser attack
  - tag: Ability.Father.Mark
    comment: Enemy marking passive
  - tag: Ability.Father.ProtectiveDome
    comment: Armor dome passive
  - tag: Ability.Father.ProximityStrike
    comment: Symbiote proximity damage
  - tag: Ability.Father.Rifle
    comment: Rifle weapon form ability
  - tag: Ability.Father.Sacrifice
    comment: Emergency sacrifice passive
  - tag: Ability.Father.StealthField
    comment: Exoskeleton stealth ability
  - tag: Ability.Father.Sword
    comment: Sword weapon form ability
  - tag: Ability.Father.Symbiote
    comment: Form activation ability
  - tag: Ability.Father.Symbiote.ProximityStrike
    comment: Hierarchical child - proximity AOE damage
  - tag: Ability.Father.TurretShoot
    comment: Engineer turret auto-fire

  # Action Tags (1)
  - tag: Action.Attacking
    comment: Generic attacking state

  # AI Tags (8)
  - tag: AI.Action.MarkEnemy
    comment: AI behavior mark action
  - tag: AI.Action.MeleeAttack
    comment: AI behavior melee action
  - tag: AI.Action.ShootLaser
    comment: AI behavior laser action
  - tag: AI.Action.ThrowElectricWeb
    comment: AI behavior trap action
  - tag: AI.Action.TurretShoot
    comment: AI behavior turret action
  - tag: AI.State.HasElectricWebTarget
    comment: AI has valid trap target
  - tag: AI.State.HasTarget
    comment: AI has combat target
  - tag: AI.State.InCombat
    comment: AI is in combat state

  # Character Tags (4)
  - tag: Character.Enemy
    comment: Character is enemy faction
  - tag: Character.Marked
    comment: Character is marked by father
  - tag: Character.Player
    comment: Character is player
  - tag: Character.Father
    comment: Character is father companion

  # Companion Tags (7)
  - tag: Companion.Slot.1
    comment: Companion wheel slot 1
  - tag: Companion.Slot.2
    comment: Companion wheel slot 2
  - tag: Companion.Slot.3
    comment: Companion wheel slot 3
  - tag: Companion.Slot.4
    comment: Companion wheel slot 4
  - tag: Companion.State.Selected
    comment: Companion selected in wheel
  - tag: Companion.State.TimeDilated
    comment: Wheel time dilation active
  - tag: Companion.State.WheelOpen
    comment: Companion wheel is open

  # Cooldown Tags (9)
  - tag: Cooldown.Father.DomeBurst
    comment: Dome burst cooldown
  - tag: Cooldown.Father.ElectricTrap
    comment: Electric trap cooldown
  - tag: Cooldown.Father.Exoskeleton.Dash
    comment: Dash ability cooldown
  - tag: Cooldown.Father.FormChange
    comment: Shared 15s form transition cooldown
  - tag: Cooldown.Father.LaserShot
    comment: Laser shot cooldown
  - tag: Cooldown.Father.ProximityStrike
    comment: Proximity strike cooldown
  - tag: Cooldown.Father.Sacrifice
    comment: Sacrifice ability cooldown
  - tag: Cooldown.Father.StealthField
    comment: Stealth field cooldown
  - tag: Cooldown.Father.Symbiote
    comment: Symbiote form cooldown

  # Data Tags - SetByCaller (13)
  - tag: Data.Backstab.DamageBonus
    comment: SetByCaller backstab bonus
  - tag: Data.Damage.DomeExplosion
    comment: SetByCaller dome damage
  - tag: Data.Damage.ElectricWeb
    comment: SetByCaller trap damage
  - tag: Data.Damage.ProximityStrike
    comment: SetByCaller proximity damage
  - tag: Data.Damage.Father
    comment: SetByCaller father base damage
  - tag: Data.Damage.Turret
    comment: SetByCaller turret damage
  - tag: Data.Dome.Damage
    comment: SetByCaller dome burst damage
  - tag: Data.Dome.Energy
    comment: SetByCaller dome energy
  - tag: Data.Duration
    comment: SetByCaller effect duration
  - tag: Data.Mark.DamageBonus
    comment: SetByCaller mark bonus
  - tag: Data.Mark.Duration
    comment: SetByCaller mark duration
  - tag: Data.Sacrifice.DormantDuration
    comment: SetByCaller dormant time
  - tag: Data.Symbiote.Duration
    comment: SetByCaller symbiote duration

  # Effect Tags (38)
  - tag: Effect.Backstab
    comment: Backstab damage effect
  - tag: Effect.Backstab.Critical
    comment: Critical backstab effect
  - tag: Effect.Damage.Laser
    comment: Laser damage effect
  - tag: Effect.ElectricWeb.Damage
    comment: Electric web damage
  - tag: Effect.ElectricWeb.Root
    comment: Electric web root effect
  - tag: Effect.Knockback
    comment: Knockback effect
  - tag: Effect.Father.ArmorBoost
    comment: Armor stat boost effect
  - tag: Effect.Father.Damage
    comment: Base father damage effect
  - tag: Effect.Father.DashDamage
    comment: Dash collision damage
  # v4.13.5: Effect.Father.DashInvulnerability REMOVED per GAS Audit INV-1
  - tag: Effect.Father.DashKnockback
    comment: Dash knockback effect
  - tag: Effect.Father.DashSpeed
    comment: Dash speed boost
  - tag: Effect.Father.DomeAbsorption
    comment: Dome damage absorption
  - tag: Effect.Father.DomeBurst
    comment: Dome burst damage effect
  - tag: Effect.Father.DomeEnergy
    comment: Dome energy modification
  - tag: Effect.Father.FormState
    comment: Base asset tag for all form state gameplay effects
  - tag: Effect.Father.FormState.Armor
    comment: Asset tag for GE_ArmorState effect
  - tag: Effect.Father.FormState.Crawler
    comment: Asset tag for GE_CrawlerState effect
  - tag: Effect.Father.FormState.Engineer
    comment: Asset tag for GE_EngineerState effect
  - tag: Effect.Father.FormState.Exoskeleton
    comment: Asset tag for GE_ExoskeletonState effect
  - tag: Effect.Father.FormState.Symbiote
    comment: Asset tag for GE_SymbioteState effect
  - tag: Effect.Father.Mark
    comment: Enemy mark effect
  - tag: Effect.Father.ProximityDamage
    comment: Proximity strike damage
  - tag: Effect.Father.Recruited
    comment: Asset tag for GE_GrantRecruitedTag effect
  - tag: Effect.Father.SacrificeInvulnerability
    comment: Sacrifice invulnerability effect
  - tag: Effect.Father.SpeedBoost
    comment: Generic speed boost
  - tag: Effect.Father.SprintJump
    comment: Sprint jump boost
  - tag: Effect.Father.SprintPush
    comment: Sprint enemy push
  - tag: Effect.Father.SprintSpeed
    comment: Sprint speed boost
  - tag: Effect.Father.Stealth
    comment: Stealth invisibility effect
  - tag: Effect.Father.StealthDamageBonus
    comment: Stealth damage bonus
  - tag: Effect.Father.StealthSpeedReduction
    comment: Stealth speed penalty
  - tag: Effect.Father.SymbioteActive
    comment: Symbiote form active effect
  - tag: Effect.Father.SymbioteDuration
    comment: Symbiote duration timer
  # v4.13.5: Effect.Father.TransitionInvulnerability REMOVED per GAS Audit INV-1
  - tag: Effect.Father.TurretDamage
    comment: Turret shot damage
  - tag: Effect.Father.TurretMode
    comment: Turret mode state effect
  - tag: Effect.Symbiote.StatBoost
    comment: Gameplay Effect providing Symbiote stat boosts

  # Event Tags (1)
  - tag: Event.Combat.Backstab
    comment: Backstab combat event

  # GameplayCue Tags (14)
  - tag: GameplayCue.Father.Backstab
    comment: Backstab VFX/SFX cue
  - tag: GameplayCue.Father.FormChange
    comment: Form change VFX/SFX cue
  - tag: GameplayCue.Father.Transition
    comment: Form transition VFX/SFX cue (5s transformation sequence)
  - tag: GameplayCue.Father.Mark
    comment: Enemy mark VFX/SFX cue
  - tag: GameplayCue.Father.Reactivate
    comment: Reactivation VFX/SFX cue
  - tag: GameplayCue.Father.Sacrifice
    comment: Sacrifice VFX/SFX cue
  - tag: GameplayCue.Father.Sprint
    comment: VFX and SFX for Exoskeleton sprint ability
  - tag: GameplayCue.Father.Stealth
    comment: Stealth VFX/SFX cue
  - tag: GameplayCue.Father.TakeDamage
    comment: Base father damage feedback VFX
  - tag: GameplayCue.Father.Attack.Hit
    comment: Attack impact VFX/SFX
  - tag: GameplayCue.Father.ProximityStrike
    comment: Symbiote aura pulse VFX
  - tag: GameplayCue.Father.ElectricTrap
    comment: Engineer trap field VFX
  - tag: GameplayCue.Father.TurretFire
    comment: Engineer turret muzzle flash VFX
  - tag: GameplayCue.Father.Death
    comment: Death effect VFX/SFX

  # Form Tags (7)
  - tag: Father.Form.Armor
    comment: Father is in armor form (chest attachment)
  - tag: Father.Form.Crawler
    comment: Father is in crawler form (following)
  - tag: Father.Form.Engineer
    comment: Father is in engineer form (turret mode)
  - tag: Father.Form.Exoskeleton
    comment: Father is in exoskeleton form (back attachment)
  - tag: Father.Form.Rifle
    comment: Father is in rifle form (weapon)
  - tag: Father.Form.Sword
    comment: Father is in sword form (weapon)
  - tag: Father.Form.Symbiote
    comment: Father is in symbiote form (merged)

  # Input Tags - Father (8) - follows Narrative.Input.* convention
  - tag: Narrative.Input.Father.DomeBurst
    comment: Input for dome burst ability
  - tag: Narrative.Input.Father.ElectricTrap
    comment: Input for electric trap ability
  - tag: Narrative.Input.Father.FormWheel
    comment: Input for form selection wheel
  - tag: Narrative.Input.Father.ProximityStrike
    comment: Input for proximity strike ability
  - tag: Narrative.Input.Father.Sprint
    comment: Input for exoskeleton sprint
  - tag: Narrative.Input.Father.Stealth
    comment: Input for stealth field ability
  - tag: Narrative.Input.Father.TurretShoot
    comment: Input for turret shoot ability
  - tag: Narrative.Input.Move
    comment: Generic move input tag

  # State Tags - Father (21)
  - tag: Father.State.Alive
    comment: Father is alive - required for form activation
  - tag: Father.State.Attached
    comment: Father is attached to player
  - tag: Father.State.Attacking
    comment: Father is attacking
  - tag: Father.State.Dashing
    comment: Father is dashing
  - tag: Father.State.Deployed
    comment: Father deployed as turret (INI canonical name)
  - tag: Father.State.Detached
    comment: Father is detached from player
  - tag: Father.State.Dormant
    comment: Father is dormant after sacrifice
  - tag: Father.State.Following
    comment: Father is following player
  - tag: Father.State.Marking
    comment: Father is marking enemy
  - tag: Father.State.Merged
    comment: Father merged with player (Symbiote form)
  - tag: Father.State.Offline
    comment: Father is offline
  - tag: Father.State.ProximityActive
    comment: Proximity strike is active
  - tag: Father.State.Recruited
    comment: Father is recruited by player
  - tag: Father.State.Sacrificing
    comment: Father is sacrificing
  - tag: Father.State.Sprinting
    comment: Father is sprinting
  - tag: Father.State.Stealthed
    comment: Father is stealthed
  - tag: Father.State.SymbioteLocked
    comment: Form changes locked during symbiote
  - tag: Father.State.Transitioning
    comment: Father is in form transition
  - tag: Father.State.TurretActive
    comment: Turret mode is active
  - tag: Father.State.TurretDeployed
    comment: Father deployed as turret (manifest alias for Deployed)

  # Dome Tags (4)
  - tag: Father.Dome.Active
    comment: Protective dome is active
  - tag: Father.Dome.Charging
    comment: Dome is charging energy
  - tag: Father.Dome.FullyCharged
    comment: Dome at max energy
  - tag: Father.Dome.OnCooldown
    comment: Dome burst on cooldown

  # State Tags - General (5)
  - tag: State.Invulnerable
    comment: Entity cannot take damage
  - tag: State.BackstabReady
    comment: Backstab conditions met
  - tag: State.Rooted
    comment: Entity cannot move
  - tag: State.Invisible
    comment: Entity is invisible
  - tag: Player.State.Stealth
    comment: Player stealth state

  # Symbiote Tags (2)
  - tag: Symbiote.Charge.Ready
    comment: Symbiote charge at 100%
  - tag: Symbiote.State.Merged
    comment: Father merged with player

  # Faction Tags (2)
  - tag: Narrative.Factions.FatherCompanion
    comment: Father companion faction
  - tag: Narrative.Factions.Player
    comment: Player faction

  # Equipment Tags (1)
  - tag: Narrative.Equipment.Slot.FatherForm
    comment: Equipment slot for father form items

# ============================================================================
# INPUT ACTIONS (7)
# ============================================================================
input_actions:
  - name: IA_FatherFormWheel
    folder: Input
    value_type: Bool
    triggers:
      - Pressed

  - name: IA_FatherDomeBurst
    folder: Input
    value_type: Bool
    triggers:
      - Pressed

  - name: IA_FatherStealth
    folder: Input
    value_type: Bool
    triggers:
      - Pressed

  - name: IA_FatherSprint
    folder: Input
    value_type: Bool
    triggers:
      - Down

  - name: IA_FatherProximityStrike
    folder: Input
    value_type: Bool
    triggers:
      - Pressed

  - name: IA_FatherElectricTrap
    folder: Input
    value_type: Bool
    triggers:
      - Pressed

  - name: IA_FatherTurretShoot
    folder: Input
    value_type: Bool
    triggers:
      - Down

# ============================================================================
# INPUT MAPPING CONTEXT (1)
# ============================================================================
input_mapping_contexts:
  - name: IMC_FatherCompanion
    folder: Input
    mappings:
      - action: IA_FatherFormWheel
        key: T
      - action: IA_FatherDomeBurst
        key: Q
      - action: IA_FatherStealth
        key: E
      - action: IA_FatherSprint
        key: Q
        modifiers:
          - Hold
      - action: IA_FatherProximityStrike
        key: Q
      - action: IA_FatherElectricTrap
        key: Q
      - action: IA_FatherTurretShoot
        key: LeftMouseButton

# ============================================================================
# ENUMERATIONS (2)
# ============================================================================
enumerations:
  - name: E_FatherForm
    folder: Enums
    values:
      - Crawler
      - Armor
      - Exoskeleton
      - Symbiote
      - Engineer
      - Offline

  - name: E_DashDirection
    folder: Enums
    values:
      - Forward
      - Backward
      - Left
      - Right

  # v4.18.1: Ultimate charge system enumeration
  - name: E_FatherUltimate
    folder: Enums
    values:
      - Symbiote
      - Sword
      - Rifle
      - Bow

# ============================================================================
# FLOAT CURVES (1) - Level-based scaling
# ============================================================================
float_curves:
  # v4.18.1: Ultimate charge threshold scaling by player level
  # Level 1 → 5000, Level 10 → 10000, Level 25 → 20000, Level 50 → 40000, Level 100 → 80000
  - name: FC_UltimateThreshold
    folder: Curves
    extrapolation_before: Constant
    extrapolation_after: Linear
    keys:
      - time: 1.0
        value: 5000.0
        interp_mode: Linear
      - time: 10.0
        value: 10000.0
        interp_mode: Linear
      - time: 25.0
        value: 20000.0
        interp_mode: Linear
      - time: 50.0
        value: 40000.0
        interp_mode: Linear
      - time: 100.0
        value: 80000.0
        interp_mode: Linear

# ============================================================================
# FORM STATE EFFECTS (5) - Compact Preset (P1.1)
# Auto-expands to GE_*State with Effect.Father.FormState.{Form} tag
# Option B Architecture: Single Active Form State Invariant
# ============================================================================
form_state_effects:
  - form: Crawler
    invulnerable: false
  - form: Armor
    invulnerable: false    # v4.14.2: Removed per GAS Audit INV-1
  - form: Exoskeleton
    invulnerable: false
  - form: Symbiote
    invulnerable: false
  - form: Engineer
    invulnerable: false

# ============================================================================
# GAMEPLAY EFFECTS (30) - Stat/Damage/Cooldown effects
# ============================================================================
gameplay_effects:
  # ==========================================================================
  # FORM EQUIPMENT MODIFIER EFFECTS (7) - Stats Only (GE Split Rule)
  # Child GEs of GE_EquipmentModifier for stat modifications
  # Stats applied via SetByCaller from EquippableItem equipment_effect_values
  # ==========================================================================
  - name: GE_EquipmentModifier_FatherCrawler
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  - name: GE_EquipmentModifier_FatherArmor
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  - name: GE_EquipmentModifier_FatherExoskeleton
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  # v4.26: Decision 1B - StaminaRegenRate via direct modifier (no SetByCaller.StaminaRegenRate in Narrative Pro)
  - name: GE_EquipmentModifier_FatherSymbiote
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite
    modifiers:
      - attribute: NarrativeAttributeSetBase.StaminaRegenRate
        modifier_op: Override
        magnitude_type: ScalableFloat
        magnitude_value: 10000.0

  - name: GE_EquipmentModifier_FatherEngineer
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  - name: GE_EquipmentModifier_FatherRifle
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  - name: GE_EquipmentModifier_FatherSword
    folder: Effects/Forms
    parent_class: GE_EquipmentModifier
    duration_policy: Infinite

  # Stat Boost Effects (1) - v4.26: Removed GE_ArmorBoost (Decision 2 - orphan, stats via EI + CharMov)
  - name: GE_ExoskeletonSpeed
    folder: Effects/Stats
    duration_policy: Infinite
    granted_tags:
      - Father.State.SpeedBoosted
    asset_tag: Effect.Father.SpeedBoost
  # v4.26: Removed GE_SymbioteBoost (Decision 3 - orphan, misconfigured, stats via EI + GE_EquipmentModifier_FatherSymbiote)

  # Cooldown Effects (8)
  - name: GE_FormChangeCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 15.0
    granted_tags:
      - Cooldown.Father.FormChange

  - name: GE_AttackCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 1.5
    granted_tags:
      - Cooldown.Father.Attack

  - name: GE_LaserCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 3.0
    granted_tags:
      - Cooldown.Father.LaserShot

  - name: GE_DomeBurstCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 12.0
    granted_tags:
      - Cooldown.Father.DomeBurst

  - name: GE_ExoskeletonDashCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 4.0
    granted_tags:
      - Cooldown.Father.Exoskeleton.Dash

  - name: GE_StealthCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 20.0
    granted_tags:
      - Cooldown.Father.StealthField

  - name: GE_ProximityStrikeCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 8.0
    granted_tags:
      - Cooldown.Father.ProximityStrike

  - name: GE_ElectricTrapCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 10.0
    granted_tags:
      - Cooldown.Father.ElectricTrap

  - name: GE_TurretShootCooldown
    folder: Effects/Cooldowns
    duration_policy: HasDuration
    duration_magnitude: 0.5
    granted_tags:
      - Cooldown.Father.TurretShoot

  # Damage Effects (5)
  - name: GE_FatherDamage
    folder: Effects/Damage
    duration_policy: Instant
    execution_calculations:
      - class: NarrativeDamageExecCalc
    setbycaller_magnitudes:
      - tag: Data.Damage.Father
    asset_tag: Effect.Father.Damage

  - name: GE_LaserDamage
    folder: Effects/Damage
    duration_policy: Instant
    execution_calculations:
      - class: NarrativeDamageExecCalc
    setbycaller_magnitudes:
      - tag: Data.Damage.Laser
    asset_tag: Effect.Damage.Laser

  - name: GE_DomeBurstDamage
    folder: Effects/Damage
    duration_policy: Instant
    execution_calculations:
      - class: NarrativeDamageExecCalc
    setbycaller_magnitudes:
      - tag: Data.Dome.Damage
    asset_tag: Effect.Father.DomeBurst

  - name: GE_ProximityDamage
    folder: Effects/Damage
    duration_policy: Instant
    execution_calculations:
      - class: NarrativeDamageExecCalc
    setbycaller_magnitudes:
      - tag: Data.Damage.ProximityStrike
    asset_tag: Effect.Father.ProximityDamage

  - name: GE_ElectricTrapDamage
    folder: Effects/Damage
    duration_policy: Instant
    execution_calculations:
      - class: NarrativeDamageExecCalc
    setbycaller_magnitudes:
      - tag: Data.Damage.ElectricWeb
    asset_tag: Effect.ElectricWeb.Damage

  # Utility Effects (7)
  - name: GE_MarkEffect
    folder: Effects/Utility
    duration_policy: HasDuration
    duration_setbycaller: Data.Mark.Duration
    granted_tags:
      - Character.Marked
    asset_tag: Effect.Father.Mark

  # v4.13.5: GE_TransitionInvulnerability REMOVED per GAS Audit INV-1
  # Form transitions now use AddLooseGameplayTag(Father.State.Transitioning) directly

  # v4.13.5: GE_DashInvulnerability REMOVED per GAS Audit INV-1
  # Dash now uses Father.State.Dashing tag only (no invulnerability)

  - name: GE_SacrificeInvulnerability
    folder: Effects/Utility
    duration_policy: HasDuration
    duration_magnitude: 10.0
    granted_tags:
      - Narrative.State.Invulnerable

  - name: GE_FatherOffline
    folder: Effects/Utility
    duration_policy: HasDuration
    duration_setbycaller: Data.Sacrifice.DormantDuration
    granted_tags:
      - Father.State.Dormant
      - Father.State.Offline

  - name: GE_GrantRecruitedTag
    folder: Effects/Utility
    duration_policy: Infinite
    granted_tags:
      - Father.State.Recruited

  - name: GE_SymbioteDuration
    folder: Effects/Utility
    duration_policy: HasDuration
    duration_setbycaller: Data.Symbiote.Duration
    granted_tags:
      - Father.State.SymbioteLocked

  - name: GE_StealthActive
    folder: Effects/Utility
    duration_policy: Infinite
    granted_tags:
      - Father.State.Stealthed
      - State.Invisible
      - Player.State.Stealth

  - name: GE_DomeAbsorption
    folder: Effects/Utility
    duration_policy: Infinite
    granted_tags:
      - Father.Dome.Active

  - name: GE_SprintSpeed
    folder: Effects/Utility
    duration_policy: Infinite
    granted_tags:
      - Father.State.Sprinting

  # v4.14: Backstab damage bonus effect per GA_Backstab_Implementation_Guide_v1_6.md
  # Instant effect that adds +25 to AttackRating for next attack
  - name: GE_BackstabBonus
    folder: Effects/Utility
    duration_policy: Instant
    modifiers:
      - attribute: NarrativeAttributeSetBase.AttackRating
        modifier_op: Add
        magnitude: 25.0
    granted_tags:
      - Effect.Backstab

  - name: GE_ElectricTrapRoot
    folder: Effects/Utility
    duration_policy: HasDuration
    duration_magnitude: 3.0
    granted_tags:
      - State.Rooted

# ============================================================================
# GAMEPLAY ABILITIES (18) - WITH EVENT GRAPH DEFINITIONS
# ============================================================================
gameplay_abilities:
  # ---------------------------------------------------------------------------
  # FORM ABILITIES (5)
  # ---------------------------------------------------------------------------
  
  # GA_FatherCrawler - Detach and Follow Mode (Option B Form Identity)
  # v4.13.5: GAS Audit compliant - NO invulnerability per INV-1
  - name: GA_FatherCrawler
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_FormChangeCooldown
    tags:
      ability_tags:
        - Ability.Father.Crawler
      cancel_abilities_with_tag:
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
      # activation_owned_tags removed - form identity via GE_CrawlerState (Option B)
      activation_required_tags:
        - Father.State.Alive
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.State.Dormant
        - Father.State.Transitioning
        - Father.State.SymbioteLocked
        - Cooldown.Father.FormChange
    # v4.21: Delegate bindings - track damage in default form
    delegate_bindings:
      - id: BindCrawlerDamageTaken
        delegate: OnDamagedBy                    # Fires when Father takes damage
        source: OwnerASC                         # Father's ASC
        handler: HandleCrawlerDamageTaken        # Custom Event for damage tracking/UI
        # Handler params: DamagerCauserASC, Damage, Spec
      - id: BindCrawlerDamageDealt
        delegate: OnDealtDamage                  # Fires when Father deals damage
        source: OwnerASC                         # Father's ASC
        handler: HandleCrawlerDamageDealt        # Custom Event for combat tracking
        # Handler params: DamagedASC, Damage, Spec - Ultimate charge accumulation
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: bIsFirstActivation
        type: Bool
        default_value: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetFirstActivation
          type: VariableGet
          properties:
            variable_name: bIsFirstActivation
          position: [1100, 100]
        - id: Branch_First
          type: Branch
          position: [1200, 0]
        - id: SetCurrentForm
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [1500, -100]
        - id: SetIsAttached
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [1800, -100]
        - id: SetFirstFalse
          type: VariableSet
          properties:
            variable_name: bIsFirstActivation
          position: [2100, -100]
        - id: EndAbility_First
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, -100]
        # FULL TRANSITION FLOW (Option B + VFX, NO Invulnerability) - False branch (form switch)
        # v4.13.5: Using AddLooseGameplayTag instead of GE_TransitionInvulnerability per GAS Audit INV-1
        # Step 1: Add Transitioning tag
        - id: GetFatherASC_Transition
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1500, 300]
        - id: AddTransitioningTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1700, 200]
        - id: MakeTagContainer_AddTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1600, 300]
        - id: MakeLiteralTag_AddTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [1500, 350]
        # Step 2: Spawn transition VFX
        - id: GetFatherMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1700, 450]
        - id: SpawnTransitionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [1900, 200]
        # Step 3: Wait 5 seconds for transition animation (v4.15: WaitDelay auto-terminates with ability)
        - id: TransitionDelay
          type: AbilityTaskWaitDelay
          properties:
            duration: 5.0
          position: [2100, 200]
        # Step 4: Remove prior form state (Option B prelude)
        - id: RemovePriorFormState
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [2300, 200]
        - id: MakeTagContainer_FormState
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2200, 350]
        - id: MakeLiteralTag_FormState
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Effect.Father.FormState
          position: [2000, 350]
        # Step 5: Apply new form state
        - id: ApplyCrawlerState
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_CrawlerState
          position: [2500, 200]
        # Step 6: Remove Transitioning tag
        - id: RemoveTransitioningTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [2700, 200]
        - id: MakeTagContainer_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2600, 300]
        - id: MakeLiteralTag_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2500, 350]
        # Continue form switch flow after transition
        - id: DetachFromActor
          type: CallFunction
          properties:
            function: K2_DetachFromActor
          position: [2900, 200]
        - id: SetCurrentForm_Switch
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [3100, 200]
        - id: SetIsAttached_Switch
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [3300, 200]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [3500, 200]
        - id: EndAbility_Switch
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [3700, 200]
        # === POST-DELAY GUARDS (GAS Audit CRIT-4 fix) ===
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Guard
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [2100, 400]
        - id: IsValid_FatherRef_Guard
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [2200, 350]
        - id: Branch_FatherValid_Guard
          type: Branch
          position: [2350, 350]
        # Guard 2: Check Father.State.Transitioning tag (still in valid transition)
        - id: GetFatherASC_Guard
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [2400, 450]
        - id: HasTransitioningTag_Guard
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [2550, 400]
        - id: MakeLiteralTag_Transitioning_Guard
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2400, 500]
        - id: Branch_TransitioningTag_Guard
          type: Branch
          position: [2700, 350]
        # === EVENT_ENDABILITY (GAS Audit CRIT-4 fix) ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 600]
        - id: Branch_WasCancelled
          type: Branch
          position: [250, 600]
        # Cleanup path (only when cancelled) - remove Transitioning tag
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [400, 700]
        - id: IsValid_Father_End
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [500, 650]
        - id: Branch_FatherValid_End
          type: Branch
          position: [650, 600]
        - id: GetFatherASC_End
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [750, 700]
        - id: RemoveTransitioningTag_End
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [900, 600]
        - id: MakeTagContainer_End
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [800, 750]
        - id: MakeLiteralTag_End
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [700, 800]
      connections:
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [Branch_First, Exec]
        # === FIRST ACTIVATION PATH (True branch) - Skip VFX/delay, merge into CommitCooldown ===
        # v4.26 (Rule 4): True path must merge into stateful setup chain, not early-terminate
        - from: [Branch_First, True]
          to: [SetCurrentForm, Exec]
        - from: [SetCurrentForm, Exec]
          to: [SetIsAttached, Exec]
        - from: [SetIsAttached, Exec]
          to: [SetFirstFalse, Exec]
        - from: [SetFirstFalse, Exec]
          to: [CommitCooldown, Exec]
        # === FORM SWITCH PATH (False branch) - v4.13.5: NO invulnerability ===
        - from: [Branch_First, False]
          to: [AddTransitioningTag, Exec]
        - from: [AddTransitioningTag, Exec]
          to: [SpawnTransitionVFX, Exec]
        - from: [SpawnTransitionVFX, Exec]
          to: [TransitionDelay, Exec]
        # v4.14: Route through guards after delay (GAS Audit CRIT-4)
        - from: [TransitionDelay, OnFinish]
          to: [Branch_FatherValid_Guard, Exec]
        - from: [Branch_FatherValid_Guard, True]
          to: [Branch_TransitioningTag_Guard, Exec]
        - from: [Branch_TransitioningTag_Guard, True]
          to: [RemovePriorFormState, Exec]
        - from: [RemovePriorFormState, Exec]
          to: [ApplyCrawlerState, Exec]
        - from: [ApplyCrawlerState, Exec]
          to: [RemoveTransitioningTag, Exec]
        - from: [RemoveTransitioningTag, Exec]
          to: [DetachFromActor, Exec]
        - from: [DetachFromActor, Exec]
          to: [SetCurrentForm_Switch, Exec]
        - from: [SetCurrentForm_Switch, Exec]
          to: [SetIsAttached_Switch, Exec]
        - from: [SetIsAttached_Switch, Exec]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility_Switch, Exec]
        # Data flow - Cast
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [DetachFromActor, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm_Switch, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached_Switch, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherASC_Transition, Actor]
        # Data flow - Branch condition
        - from: [GetFirstActivation, bIsFirstActivation]
          to: [Branch_First, Condition]
        # Data flow - Transitioning tag (v4.13.5)
        - from: [MakeLiteralTag_AddTransitioning, ReturnValue]
          to: [MakeTagContainer_AddTransitioning, Tag]
        - from: [MakeTagContainer_AddTransitioning, ReturnValue]
          to: [AddTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AddTransitioningTag, Actor]
        - from: [MakeLiteralTag_RemoveTransitioning, ReturnValue]
          to: [MakeTagContainer_RemoveTransitioning, Tag]
        - from: [MakeTagContainer_RemoveTransitioning, ReturnValue]
          to: [RemoveTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [RemoveTransitioningTag, Actor]
        # Data flow - VFX spawn
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherMesh, Target]
        - from: [GetFatherMesh, Mesh]
          to: [SpawnTransitionVFX, AttachToComponent]
        # Data flow - Tag container for form state removal
        - from: [MakeLiteralTag_FormState, ReturnValue]
          to: [MakeTagContainer_FormState, Tag]
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState, WithGrantedTags]
        # === GUARD DATA FLOW (GAS Audit CRIT-4) ===
        # Guard 1: IsValid(FatherRef)
        - from: [GetFatherRef_Guard, FatherRef]
          to: [IsValid_FatherRef_Guard, Object]
        - from: [IsValid_FatherRef_Guard, ReturnValue]
          to: [Branch_FatherValid_Guard, Condition]
        - from: [GetFatherRef_Guard, FatherRef]
          to: [GetFatherASC_Guard, Actor]
        # Guard 2: HasMatchingGameplayTag(Father.State.Transitioning)
        - from: [GetFatherASC_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Target]
        - from: [MakeLiteralTag_Transitioning_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Tag]
        - from: [HasTransitioningTag_Guard, ReturnValue]
          to: [Branch_TransitioningTag_Guard, Condition]
        # === EVENT_ENDABILITY FLOW (GAS Audit CRIT-4) ===
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        - from: [Branch_WasCancelled, True]
          to: [Branch_FatherValid_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_Father_End, Object]
        - from: [IsValid_Father_End, ReturnValue]
          to: [Branch_FatherValid_End, Condition]
        - from: [Branch_FatherValid_End, True]
          to: [RemoveTransitioningTag_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [GetFatherASC_End, Actor]
        - from: [GetFatherRef_End, FatherRef]
          to: [RemoveTransitioningTag_End, Actor]
        - from: [MakeLiteralTag_End, ReturnValue]
          to: [MakeTagContainer_End, Tag]
        - from: [MakeTagContainer_End, ReturnValue]
          to: [RemoveTransitioningTag_End, GameplayTags]

  # GA_FatherArmor - Attach to Player Chest (Option B Form Identity)
  # v4.13.5: GAS Audit compliant - NO invulnerability per INV-1
  - name: GA_FatherArmor
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_FormChangeCooldown
    tags:
      ability_tags:
        - Ability.Father.Armor
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
      activation_owned_tags:
        # Father.Form.Armor removed - form identity via GE_ArmorState (Option B)
        - Father.State.Attached
      activation_required_tags:
        - Father.State.Alive
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.State.Dormant
        - Father.State.Transitioning
        - Father.State.SymbioteLocked
        - Cooldown.Father.FormChange
    # v4.21: Delegate bindings - auto-bind in ActivateAbility, unbind in EndAbility
    delegate_bindings:
      - id: BindArmorDamage
        delegate: OnDamagedBy                    # Fires when Father takes damage
        source: OwnerASC                         # Father's ASC (keyword)
        handler: HandleArmorDamageReceived       # Custom Event (auto-created with signature)
        # Handler params: DamagerCauserASC, Damage, Spec
      - id: BindFatherDeath
        delegate: OnDied                         # Fires when Father dies
        source: FatherASC                        # Variable source (tests variable resolution)
        handler: HandleFatherDied                # Custom Event (auto-created with signature)
        # Handler params: KilledActor, KilledActorASC
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: FatherASC
        type: Object
        class: NarrativeAbilitySystemComponent   # ASC variable for delegate binding source
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: OriginalWalkSpeed
        type: Float
        default_value: 0.0
        instance_editable: true
      - name: SpeedPenaltyMultiplier
        type: Float
        default_value: 0.85
        instance_editable: true
      - name: ChestSocketName
        type: Name
        default_value: FatherChestSocket
        instance_editable: true
      - name: bIsFirstActivation
        type: Bool
        default_value: true
    event_graph:
      nodes:
        # === ACTIVATION FLOW (Row Y=0 for exec, Y=-150 for pure getters) ===
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [400, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [800, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [1200, 0]
        # v4.14: First activation vs form switch branch
        - id: GetFirstActivation
          type: VariableGet
          properties:
            variable_name: bIsFirstActivation
          position: [1400, 100]
        - id: Branch_First
          type: Branch
          position: [1500, 0]
        # === FIRST ACTIVATION PATH (Row Y=-200) - Simple setup, no VFX/delay ===
        - id: RemovePriorFormState_First
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [1700, -200]
        - id: ApplyArmorState_First
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_ArmorState
          position: [2100, -200]
        - id: SetFirstFalse
          type: VariableSet
          properties:
            variable_name: bIsFirstActivation
          position: [2300, -200]
        - id: EndAbility_First
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2500, -200]
        # === FORM SWITCH PATH (Row Y=200) - Full transition with VFX/delay ===
        # v4.13.5: FULL TRANSITION FLOW (Option B + VFX, NO Invulnerability per GAS Audit INV-1)
        # Step 1: Add Transitioning tag
        - id: GetFatherASC_Transition
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1700, 300]
        - id: AddTransitioningTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1900, 200]
        - id: MakeTagContainer_AddTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1800, 300]
        - id: MakeLiteralTag_AddTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [1700, 350]
        # Step 2: Spawn transition VFX
        - id: GetFatherMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1900, 450]
        - id: SpawnTransitionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [2100, 200]
        # Step 3: Wait 5 seconds (v4.15: WaitDelay auto-terminates with ability)
        - id: TransitionDelay
          type: AbilityTaskWaitDelay
          properties:
            duration: 5.0
          position: [2300, 200]
        # === POST-DELAY GUARDS (GAS Audit MED-1 - move guards BEFORE GE ops) ===
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Guard
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [2400, 350]
        - id: IsValid_FatherRef_Guard
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [2450, 300]
        - id: Branch_FatherValid_Guard
          type: Branch
          position: [2550, 200]
        # Guard 2: Check Father.State.Transitioning tag
        - id: GetFatherASC_Guard
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [2600, 350]
        - id: HasTransitioningTag_Guard
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [2700, 300]
        - id: MakeLiteralTag_Transitioning_Guard
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2600, 400]
        - id: Branch_TransitioningTag_Guard
          type: Branch
          position: [2850, 200]
        # Step 4: Remove prior form state (now guarded)
        - id: RemovePriorFormState
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [2500, 200]
        - id: MakeTagContainer_FormState
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2400, 350]
        - id: MakeLiteralTag_FormState
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Effect.Father.FormState
          position: [2200, 350]
        # Step 5: Apply new form state
        - id: ApplyArmorState
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_ArmorState
          position: [2700, 200]
        # Step 6: Remove Transitioning tag
        - id: RemoveTransitioningTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [2900, 200]
        - id: MakeTagContainer_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2800, 300]
        - id: MakeLiteralTag_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2700, 350]
        # Pure nodes - below main exec flow
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1200, -150]
        - id: IsValid_Player
          type: CallFunction
          properties:
            function: IsValid
          position: [1500, -150]
        - id: Branch_Valid
          type: Branch
          position: [1600, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [2000, 0]
        # Pure getters for CharacterMovement chain
        - id: GetCharMov
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [2000, -150]
        - id: GetMaxSpeed
          type: PropertyGet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [2300, -150]
        - id: SetOrigSpeed
          type: VariableSet
          properties:
            variable_name: OriginalWalkSpeed
          position: [2400, 0]
        - id: GetPenalty
          type: VariableGet
          properties:
            variable_name: SpeedPenaltyMultiplier
          position: [2600, -150]
        - id: MultiplySpeed
          type: CallFunction
          properties:
            function: Multiply_DoubleDouble
            class: KismetMathLibrary
          position: [2800, -150]
        - id: SetMaxSpeed
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [2800, 0]
        # Pure getters for attach
        - id: GetMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [3000, -150]
        - id: GetSocket
          type: VariableGet
          properties:
            variable_name: ChestSocketName
          position: [3000, -280]
        - id: AttachToComponent
          type: CallFunction
          properties:
            function: K2_AttachToComponent
          position: [3200, 0]
        - id: SetCurrentForm
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [3600, 0]
        - id: SetIsAttached
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [4000, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [4400, 0]
        # === END ABILITY FLOW (Row Y=500) ===
        # v2.5.5: Added bWasCancelled check - cleanup only runs when cancelled by form switch
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 500]
        # Branch on bWasCancelled - only cleanup when cancelled by another form
        - id: Branch_WasCancelled
          type: Branch
          position: [300, 500]
        # Pure getters for end flow (only used in TRUE path)
        - id: GetPlayerRef_End
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [700, 350]
        - id: IsValid_End
          type: CallFunction
          properties:
            function: IsValid
          position: [1000, 350]
        - id: Branch_End
          type: Branch
          position: [700, 500]
        - id: GetCharMov_End
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [1100, 350]
        - id: GetOrigSpeed
          type: VariableGet
          properties:
            variable_name: OriginalWalkSpeed
          position: [1400, 350]
        - id: RestoreSpeed
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [1100, 500]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [Branch_First, Exec]
        # === FIRST ACTIVATION PATH (True branch) - Skip VFX/delay, merge into setup chain ===
        # v4.26 (Rule 4): True path must merge into stateful setup chain, not early-terminate
        - from: [Branch_First, True]
          to: [RemovePriorFormState_First, Exec]
        - from: [RemovePriorFormState_First, Exec]
          to: [ApplyArmorState_First, Exec]
        - from: [ApplyArmorState_First, Exec]
          to: [SetFirstFalse, Exec]
        - from: [SetFirstFalse, Exec]
          to: [Branch_Valid, Exec]
        # === FORM SWITCH PATH (False branch) - v4.13.5: NO invulnerability ===
        - from: [Branch_First, False]
          to: [AddTransitioningTag, Exec]
        - from: [AddTransitioningTag, Exec]
          to: [SpawnTransitionVFX, Exec]
        - from: [SpawnTransitionVFX, Exec]
          to: [TransitionDelay, Exec]
        # v4.14: Route through guards after delay (GAS Audit MED-1)
        - from: [TransitionDelay, OnFinish]
          to: [Branch_FatherValid_Guard, Exec]
        - from: [Branch_FatherValid_Guard, True]
          to: [Branch_TransitioningTag_Guard, Exec]
        - from: [Branch_TransitioningTag_Guard, True]
          to: [RemovePriorFormState, Exec]
        - from: [RemovePriorFormState, Exec]
          to: [ApplyArmorState, Exec]
        - from: [ApplyArmorState, Exec]
          to: [RemoveTransitioningTag, Exec]
        - from: [RemoveTransitioningTag, Exec]
          to: [Branch_Valid, Exec]
        - from: [Branch_Valid, then]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SetOrigSpeed, Exec]
        - from: [SetOrigSpeed, Exec]
          to: [SetMaxSpeed, Exec]
        - from: [SetMaxSpeed, Exec]
          to: [AttachToComponent, Exec]
        - from: [AttachToComponent, Exec]
          to: [SetCurrentForm, Exec]
        - from: [SetCurrentForm, Exec]
          to: [SetIsAttached, Exec]
        - from: [SetIsAttached, Exec]
          to: [CommitCooldown, Exec]
        # Data flow - GetAvatarActor to Cast
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        # Data flow - Cast output to SetFatherRef INPUT and other destinations
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AttachToComponent, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherASC_Transition, Actor]
        # Data flow - Branch condition
        - from: [GetFirstActivation, bIsFirstActivation]
          to: [Branch_First, Condition]
        # Data flow - First activation path (tag container for form state removal)
        - from: [MakeLiteralTag_FormState, ReturnValue]
          to: [MakeTagContainer_FormState, Tag]
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState_First, WithGrantedTags]
        # Data flow - Form switch path (tag containers)
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState, WithGrantedTags]
        # v4.13.5: Transitioning tag via AddLooseGameplayTag (not GE)
        - from: [MakeLiteralTag_AddTransitioning, ReturnValue]
          to: [MakeTagContainer_AddTransitioning, Tag]
        - from: [MakeTagContainer_AddTransitioning, ReturnValue]
          to: [AddTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AddTransitioningTag, Actor]
        - from: [MakeLiteralTag_RemoveTransitioning, ReturnValue]
          to: [MakeTagContainer_RemoveTransitioning, Tag]
        - from: [MakeTagContainer_RemoveTransitioning, ReturnValue]
          to: [RemoveTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [RemoveTransitioningTag, Actor]
        # Data flow - VFX spawn
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherMesh, Target]
        - from: [GetFatherMesh, Mesh]
          to: [SpawnTransitionVFX, AttachToComponent]
        # === GUARD DATA FLOW (GAS Audit MED-1) ===
        # Guard 1: IsValid(FatherRef)
        - from: [GetFatherRef_Guard, FatherRef]
          to: [IsValid_FatherRef_Guard, Object]
        - from: [IsValid_FatherRef_Guard, ReturnValue]
          to: [Branch_FatherValid_Guard, Condition]
        - from: [GetFatherRef_Guard, FatherRef]
          to: [GetFatherASC_Guard, Actor]
        # Guard 2: HasMatchingGameplayTag(Father.State.Transitioning)
        - from: [GetFatherASC_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Target]
        - from: [MakeLiteralTag_Transitioning_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Tag]
        - from: [HasTransitioningTag_Guard, ReturnValue]
          to: [Branch_TransitioningTag_Guard, Condition]
        # Data flow - GetOwnerPlayer to IsValid
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [IsValid_Player, Object]
        # Data flow - IsValid result to Branch condition
        - from: [IsValid_Player, ReturnValue]
          to: [Branch_Valid, Condition]
        # Data flow - OwnerPlayer to SetPlayerRef INPUT and other destinations
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetCharMov, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetMesh, Target]
        # Data flow - CharMov to GetMaxSpeed and SetMaxSpeed
        - from: [GetCharMov, CharacterMovement]
          to: [GetMaxSpeed, Target]
        - from: [GetCharMov, CharacterMovement]
          to: [SetMaxSpeed, Target]
        # Data flow - MaxSpeed to SetOrigSpeed value and multiply
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [SetOrigSpeed, OriginalWalkSpeed]
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [MultiplySpeed, A]
        # Data flow - Speed calculation
        - from: [GetPenalty, SpeedPenaltyMultiplier]
          to: [MultiplySpeed, B]
        - from: [MultiplySpeed, ReturnValue]
          to: [SetMaxSpeed, MaxWalkSpeed]
        # Data flow - AttachToComponent inputs
        - from: [GetMesh, Mesh]
          to: [AttachToComponent, Parent]
        - from: [GetSocket, ChestSocketName]
          to: [AttachToComponent, SocketName]
        # === END ABILITY FLOW ===
        # v2.5.5: First check bWasCancelled - only cleanup when cancelled by form switch
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        # TRUE path (was cancelled by form switch) - do cleanup
        - from: [Branch_WasCancelled, then]
          to: [Branch_End, Exec]
        - from: [Branch_End, then]
          to: [RestoreSpeed, Exec]
        # FALSE path (normal end after setup) - skip cleanup (no connection needed)
        # Data flow - PlayerRef to IsValid (pure nodes)
        - from: [GetPlayerRef_End, PlayerRef]
          to: [IsValid_End, Object]
        - from: [IsValid_End, ReturnValue]
          to: [Branch_End, Condition]
        # Data flow - PlayerRef to GetCharMov_End (pure node)
        - from: [GetPlayerRef_End, PlayerRef]
          to: [GetCharMov_End, Target]
        # Data flow - CharMov to RestoreSpeed target
        - from: [GetCharMov_End, CharacterMovement]
          to: [RestoreSpeed, Target]
        # Data flow - Original speed to restore
        - from: [GetOrigSpeed, OriginalWalkSpeed]
          to: [RestoreSpeed, NewMaxWalkSpeed]

  # GA_FatherExoskeleton - Attach to Player Back with Speed/Jump Boost (Option B Form Identity)
  # v4.14.3: GAS Audit FIX-3 - Added JumpZVelocity boost and restore; INV-1 compliant (no invulnerability)
  - name: GA_FatherExoskeleton
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_FormChangeCooldown
    tags:
      ability_tags:
        - Ability.Father.Exoskeleton
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
      activation_owned_tags:
        - Father.State.Attached
      activation_required_tags:
        - Father.State.Alive
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.State.Dormant
        - Father.State.Transitioning
        - Father.State.SymbioteLocked
        - Cooldown.Father.FormChange
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: OriginalWalkSpeed
        type: Float
        default_value: 0.0
        instance_editable: true
      - name: OriginalJumpZVelocity
        type: Float
        default_value: 0.0
        instance_editable: true
      - name: SpeedBoostMultiplier
        type: Float
        default_value: 1.25
        instance_editable: true
      - name: JumpBoostMultiplier
        type: Float
        default_value: 1.3
        instance_editable: true
      - name: BackSocketName
        type: Name
        default_value: FatherBackSocket
        instance_editable: true
      - name: bIsFirstActivation
        type: Bool
        default_value: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        # v4.14: First activation vs form switch branch
        - id: GetFirstActivation
          type: VariableGet
          properties:
            variable_name: bIsFirstActivation
          position: [1100, 100]
        - id: Branch_First
          type: Branch
          position: [1200, 0]
        # === FIRST ACTIVATION PATH (Row Y=-200) - Simple setup, no VFX/delay ===
        - id: RemovePriorFormState_First
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [1600, -200]
        - id: ApplyExoskeletonState_First
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_ExoskeletonState
          position: [1800, -200]
        - id: SetFirstFalse
          type: VariableSet
          properties:
            variable_name: bIsFirstActivation
          position: [2000, -200]
        - id: EndAbility_First
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2200, -200]
        # === FORM SWITCH PATH (Row Y=200) - Full transition with VFX/delay ===
        # v4.13.5: FULL TRANSITION FLOW (Option B + VFX, NO Invulnerability per GAS Audit INV-1)
        # Step 1: Add Transitioning tag (instead of GE_TransitionInvulnerability)
        - id: GetFatherASC_Transition
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1500, 300]
        - id: AddTransitioningTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1600, 200]
        - id: MakeTagContainer_AddTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1500, 250]
        - id: MakeLiteralTag_AddTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [1400, 300]
        # Step 2: Spawn transition VFX
        - id: GetFatherMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1600, 350]
        - id: SpawnTransitionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [1800, 200]
        # Step 3: Wait 5 seconds (v4.15: WaitDelay auto-terminates with ability)
        - id: TransitionDelay
          type: AbilityTaskWaitDelay
          properties:
            duration: 5.0
          position: [2000, 200]
        # === POST-DELAY GUARDS (GAS Audit MED-2) ===
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Guard
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [2050, 350]
        - id: IsValid_FatherRef_Guard
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [2100, 300]
        - id: Branch_FatherValid_Guard
          type: Branch
          position: [2200, 200]
        # Guard 2: Check Father.State.Transitioning tag
        - id: GetFatherASC_Guard
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [2250, 350]
        - id: HasTransitioningTag_Guard
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [2350, 300]
        - id: MakeLiteralTag_Transitioning_Guard
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2250, 400]
        - id: Branch_TransitioningTag_Guard
          type: Branch
          position: [2500, 200]
        # Step 4: Remove prior form state (now guarded)
        - id: RemovePriorFormState
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [2700, 200]
        - id: MakeTagContainer_FormState
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2600, 350]
        - id: MakeLiteralTag_FormState
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Effect.Father.FormState
          position: [2400, 350]
        # Step 5: Apply new form state
        - id: ApplyExoskeletonState
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_ExoskeletonState
          position: [2400, 200]
        # Step 6: Remove Transitioning tag (v4.13.5: replaces GE removal)
        - id: RemoveTransitioningTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [2600, 200]
        - id: MakeTagContainer_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2550, 300]
        - id: MakeLiteralTag_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2500, 350]
        # Continue form switch flow after transition
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1500, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1800, 0]
        - id: GetCharMov
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [1800, 0]
        - id: GetMaxSpeed
          type: PropertyGet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [2100, 0]
        - id: SetOrigSpeed
          type: VariableSet
          properties:
            variable_name: OriginalWalkSpeed
          position: [2400, 0]
        - id: GetSpeedBoost
          type: VariableGet
          properties:
            variable_name: SpeedBoostMultiplier
          position: [2400, 100]
        - id: MultiplySpeed
          type: CallFunction
          properties:
            function: Multiply_DoubleDouble
            class: KismetMathLibrary
          position: [2700, 0]
        - id: SetMaxSpeed
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [3000, 0]
        # v4.14.3: Jump boost (FIX-3 per GAS Audit)
        - id: GetJumpZVelocity
          type: PropertyGet
          properties:
            property_name: JumpZVelocity
            target_class: CharacterMovementComponent
          position: [3000, -100]
        - id: SetOrigJump
          type: VariableSet
          properties:
            variable_name: OriginalJumpZVelocity
          position: [3200, 0]
        - id: GetJumpBoost
          type: VariableGet
          properties:
            variable_name: JumpBoostMultiplier
          position: [3200, 100]
        - id: MultiplyJump
          type: CallFunction
          properties:
            function: Multiply_DoubleDouble
            class: KismetMathLibrary
          position: [3400, 0]
        - id: SetJumpVelocity
          type: PropertySet
          properties:
            property_name: JumpZVelocity
            target_class: CharacterMovementComponent
          position: [3600, 0]
        - id: GetMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [3000, 100]
        - id: GetBackSocket
          type: VariableGet
          properties:
            variable_name: BackSocketName
          position: [3000, 200]
        - id: AttachToComponent
          type: CallFunction
          properties:
            function: K2_AttachToComponent
          position: [3300, 0]
        - id: SetCurrentForm
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [3600, 0]
        - id: SetIsAttached
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [3900, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [4200, 0]
        # v2.5.5: Added bWasCancelled check - cleanup only runs when cancelled by form switch
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 400]
        - id: Branch_WasCancelled
          type: Branch
          position: [300, 400]
        - id: GetPlayerRef_End
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [600, 400]
        - id: GetCharMov_End
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [900, 400]
        - id: GetOrigSpeed_End
          type: VariableGet
          properties:
            variable_name: OriginalWalkSpeed
          position: [1200, 500]
        - id: RestoreSpeed_End
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [1200, 400]
        # v4.14.3: Jump restore (FIX-3 per GAS Audit)
        - id: GetOrigJump_End
          type: VariableGet
          properties:
            variable_name: OriginalJumpZVelocity
          position: [1500, 500]
        - id: RestoreJump_End
          type: PropertySet
          properties:
            property_name: JumpZVelocity
            target_class: CharacterMovementComponent
          position: [1500, 400]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [Branch_First, Exec]
        # === FIRST ACTIVATION PATH (True branch) - Skip VFX/delay, merge into setup chain ===
        # v4.26 (Rule 4): True path must merge into stateful setup chain, not early-terminate
        - from: [Branch_First, True]
          to: [RemovePriorFormState_First, Exec]
        - from: [RemovePriorFormState_First, Exec]
          to: [ApplyExoskeletonState_First, Exec]
        - from: [ApplyExoskeletonState_First, Exec]
          to: [SetFirstFalse, Exec]
        - from: [SetFirstFalse, Exec]
          to: [SetPlayerRef, Exec]
        # === FORM SWITCH PATH (False branch) - Full transition with VFX/delay ===
        # v4.13.5: NO invulnerability - uses AddLooseGameplayTag/RemoveLooseGameplayTag
        - from: [Branch_First, False]
          to: [AddTransitioningTag, Exec]
        - from: [AddTransitioningTag, Exec]
          to: [SpawnTransitionVFX, Exec]
        - from: [SpawnTransitionVFX, Exec]
          to: [TransitionDelay, Exec]
        # v4.14: Route through guards after delay (GAS Audit MED-2)
        - from: [TransitionDelay, OnFinish]
          to: [Branch_FatherValid_Guard, Exec]
        - from: [Branch_FatherValid_Guard, True]
          to: [Branch_TransitioningTag_Guard, Exec]
        - from: [Branch_TransitioningTag_Guard, True]
          to: [RemovePriorFormState, Exec]
        - from: [RemovePriorFormState, Exec]
          to: [ApplyExoskeletonState, Exec]
        - from: [ApplyExoskeletonState, Exec]
          to: [RemoveTransitioningTag, Exec]
        - from: [RemoveTransitioningTag, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SetOrigSpeed, Exec]
        - from: [SetOrigSpeed, Exec]
          to: [SetMaxSpeed, Exec]
        - from: [SetMaxSpeed, Exec]
          to: [SetOrigJump, Exec]
        # v4.14.3: Jump boost exec flow (FIX-3 per GAS Audit)
        - from: [SetOrigJump, Exec]
          to: [SetJumpVelocity, Exec]
        - from: [SetJumpVelocity, Exec]
          to: [AttachToComponent, Exec]
        - from: [AttachToComponent, Exec]
          to: [SetCurrentForm, Exec]
        - from: [SetCurrentForm, Exec]
          to: [SetIsAttached, Exec]
        - from: [SetIsAttached, Exec]
          to: [CommitCooldown, Exec]
        # Data flow - GetAvatarActor to Cast
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        # Data flow - Cast output to SetFatherRef INPUT and other destinations
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AttachToComponent, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached, Target]
        # Data flow - Branch condition
        - from: [GetFirstActivation, bIsFirstActivation]
          to: [Branch_First, Condition]
        # Data flow - First activation path (tag container for form state removal)
        - from: [MakeLiteralTag_FormState, ReturnValue]
          to: [MakeTagContainer_FormState, Tag]
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState_First, WithGrantedTags]
        # Data flow - Form switch path (tag containers)
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState, WithGrantedTags]
        # v4.13.5: Data flow for Transitioning tag (AddLooseGameplayTag/RemoveLooseGameplayTag)
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherASC_Transition, Actor]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AddTransitioningTag, Actor]
        - from: [MakeLiteralTag_AddTransitioning, ReturnValue]
          to: [MakeTagContainer_AddTransitioning, Tag]
        - from: [MakeTagContainer_AddTransitioning, ReturnValue]
          to: [AddTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [RemoveTransitioningTag, Actor]
        - from: [MakeLiteralTag_RemoveTransitioning, ReturnValue]
          to: [MakeTagContainer_RemoveTransitioning, Tag]
        - from: [MakeTagContainer_RemoveTransitioning, ReturnValue]
          to: [RemoveTransitioningTag, GameplayTags]
        # === GUARD DATA FLOW (GAS Audit MED-2) ===
        # Guard 1: IsValid(FatherRef)
        - from: [GetFatherRef_Guard, FatherRef]
          to: [IsValid_FatherRef_Guard, Object]
        - from: [IsValid_FatherRef_Guard, ReturnValue]
          to: [Branch_FatherValid_Guard, Condition]
        - from: [GetFatherRef_Guard, FatherRef]
          to: [GetFatherASC_Guard, Actor]
        # Guard 2: HasMatchingGameplayTag(Father.State.Transitioning)
        - from: [GetFatherASC_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Target]
        - from: [MakeLiteralTag_Transitioning_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Tag]
        - from: [HasTransitioningTag_Guard, ReturnValue]
          to: [Branch_TransitioningTag_Guard, Condition]
        # Data flow - VFX spawn
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherMesh, Target]
        - from: [GetFatherMesh, Mesh]
          to: [SpawnTransitionVFX, AttachToComponent]
        # Data flow - Player
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetCharMov, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetMesh, Target]
        # Data flow - CharMov
        - from: [GetCharMov, CharacterMovement]
          to: [GetMaxSpeed, Target]
        - from: [GetCharMov, CharacterMovement]
          to: [SetMaxSpeed, Target]
        # Data flow - Speed
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [SetOrigSpeed, OriginalWalkSpeed]
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [MultiplySpeed, A]
        - from: [GetSpeedBoost, SpeedBoostMultiplier]
          to: [MultiplySpeed, B]
        - from: [MultiplySpeed, ReturnValue]
          to: [SetMaxSpeed, NewMaxWalkSpeed]
        # v4.14.3: Data flow - Jump (FIX-3 per GAS Audit)
        - from: [GetCharMov, CharacterMovement]
          to: [GetJumpZVelocity, Target]
        - from: [GetJumpZVelocity, JumpZVelocity]
          to: [SetOrigJump, OriginalJumpZVelocity]
        - from: [GetJumpZVelocity, JumpZVelocity]
          to: [MultiplyJump, A]
        - from: [GetJumpBoost, JumpBoostMultiplier]
          to: [MultiplyJump, B]
        - from: [MultiplyJump, ReturnValue]
          to: [SetJumpVelocity, NewJumpZVelocity]
        - from: [GetCharMov, CharacterMovement]
          to: [SetJumpVelocity, Target]
        # Data flow - Attach
        - from: [GetMesh, Mesh]
          to: [AttachToComponent, Parent]
        - from: [GetBackSocket, BackSocketName]
          to: [AttachToComponent, SocketName]
        # === END ABILITY FLOW ===
        # v2.5.5: check bWasCancelled first
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        # TRUE path (was cancelled by form switch) - do cleanup
        - from: [Branch_WasCancelled, then]
          to: [RestoreSpeed_End, Exec]
        # v4.14.3: Chain jump restore after speed restore (FIX-3 per GAS Audit)
        - from: [RestoreSpeed_End, Exec]
          to: [RestoreJump_End, Exec]
        # FALSE path (normal end) - skip cleanup (no connection needed)
        - from: [GetPlayerRef_End, PlayerRef]
          to: [GetCharMov_End, Target]
        - from: [GetCharMov_End, CharacterMovement]
          to: [RestoreSpeed_End, Target]
        - from: [GetOrigSpeed_End, OriginalWalkSpeed]
          to: [RestoreSpeed_End, NewMaxWalkSpeed]
        # v4.14.3: Jump restore data flow (FIX-3 per GAS Audit)
        - from: [GetCharMov_End, CharacterMovement]
          to: [RestoreJump_End, Target]
        - from: [GetOrigJump_End, OriginalJumpZVelocity]
          to: [RestoreJump_End, NewJumpZVelocity]

  # GA_FatherSymbiote - Merge with Player (Timed) (Option B Form Identity)
  # v4.13.5: GAS Audit compliant - NO invulnerability, timer guards, Event_EndAbility
  - name: GA_FatherSymbiote
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_FormChangeCooldown
    tags:
      ability_tags:
        - Ability.Father.Symbiote
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Engineer
      activation_owned_tags:
        - Symbiote.State.Merged
      activation_required_tags:
        - Father.State.Alive
        - Father.State.Recruited
        - Symbiote.Charge.Ready
      activation_blocked_tags:
        - Father.State.Dormant
        - Father.State.Transitioning
        - Father.State.SymbioteLocked
        - Cooldown.Father.FormChange
    # v4.21: Delegate bindings - fires when merged Father deals proximity damage
    delegate_bindings:
      - id: BindSymbioteDamageDealt
        delegate: OnDealtDamage                  # Fires when Father deals damage
        source: OwnerASC                         # Father's ASC
        handler: HandleSymbioteDamageDealt       # Custom Event (auto-created with signature)
        # Handler params: DamagedASC, Damage, Spec
      - id: BindSymbioteHealing
        delegate: OnHealedBy                     # Fires when Father is healed (symbiote regen)
        source: OwnerASC                         # Father's ASC
        handler: HandleSymbioteHealing           # Custom Event (auto-created with signature)
        # Handler params: Healer, Amount, Spec
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: SymbioteDuration
        type: Float
        default_value: 30.0
        instance_editable: true
      - name: DurationTimerHandle
        type: TimerHandle
      - name: bIsFirstActivation
        type: Bool
        default_value: true
      # v4.13.5: Variables for speed/jump restoration (GAS Audit FIX-1)
      - name: OriginalMaxWalkSpeed
        type: Float
        default_value: 0.0
      - name: OriginalJumpZVelocity
        type: Float
        default_value: 0.0
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        # v4.14: First activation vs form switch branch
        - id: GetFirstActivation
          type: VariableGet
          properties:
            variable_name: bIsFirstActivation
          position: [1100, 100]
        - id: Branch_First
          type: Branch
          position: [1200, 0]
        # === FIRST ACTIVATION PATH (Row Y=-200) - Simple setup, no VFX/delay ===
        - id: RemovePriorFormState_First
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [1600, -200]
        - id: ApplySymbioteState_First
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_SymbioteState
          position: [1800, -200]
        - id: SetFirstFalse
          type: VariableSet
          properties:
            variable_name: bIsFirstActivation
          position: [2000, -200]
        - id: EndAbility_First
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2200, -200]
        # === FORM SWITCH PATH (Row Y=200) - Full transition with VFX/delay ===
        # v4.13.5: FULL TRANSITION FLOW (Option B + VFX, NO Invulnerability per GAS Audit INV-1)
        # Step 1: Add Transitioning tag (instead of GE_TransitionInvulnerability)
        - id: GetFatherASC_Transition
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1500, 300]
        - id: AddTransitioningTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1700, 200]
        - id: MakeTagContainer_AddTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1600, 300]
        - id: MakeLiteralTag_AddTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [1500, 350]
        # Step 2: Spawn transition VFX
        - id: GetFatherMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1600, 450]
        - id: SpawnTransitionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [1900, 200]
        # Step 3: Wait 5 seconds (v4.15: WaitDelay auto-terminates with ability)
        - id: TransitionDelay
          type: AbilityTaskWaitDelay
          properties:
            duration: 5.0
          position: [2100, 200]
        # Step 4: Remove prior form state
        - id: RemovePriorFormState
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [2300, 200]
        - id: MakeTagContainer_FormState
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2200, 350]
        - id: MakeLiteralTag_FormState
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Effect.Father.FormState
          position: [2000, 350]
        # Step 5: Apply new form state
        - id: ApplySymbioteState
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_SymbioteState
          position: [2500, 200]
        # Step 6: Remove Transitioning tag (instead of GE removal)
        - id: RemoveTransitioningTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [2700, 200]
        - id: MakeTagContainer_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2600, 300]
        - id: MakeLiteralTag_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2500, 350]
        # Continue form switch flow after transition
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1200, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1500, 0]
        - id: HideFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [1800, 0]
        - id: DisableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [2100, 0]
        - id: SetCurrentForm
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [2400, 0]
        - id: SetIsAttached
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [2700, 0]
        - id: GetDuration
          type: VariableGet
          properties:
            variable_name: SymbioteDuration
          position: [3000, 100]
        - id: SetTimer
          type: CallFunction
          properties:
            function: K2_SetTimerDelegate
          position: [3000, 0]
        - id: SetTimerHandle
          type: VariableSet
          properties:
            variable_name: DurationTimerHandle
          position: [3300, 0]
        # v4.26 (VTF-7): CommitCooldown required when cooldown_gameplay_effect_class defined
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [3500, 0]
        # === TIMER EXPIRED FLOW (with guards per GAS Audit FIX-2) ===
        - id: CustomEvent_TimerExpired
          type: CustomEvent
          properties:
            event_name: OnSymbioteTimerExpired
          position: [0, 400]
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Timer
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [100, 500]
        - id: IsValid_FatherRef
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [250, 400]
        - id: Branch_FatherValid
          type: Branch
          position: [400, 400]
        # Guard 2: Check CurrentForm == Symbiote
        - id: GetCurrentForm_Timer
          type: PropertyGet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [450, 550]
        - id: EqualEnum_Symbiote
          type: CallFunction
          properties:
            function: EqualEqual_ByteByte
          position: [600, 500]
        - id: Branch_FormCheck
          type: Branch
          position: [750, 400]
        # Guard 3: Check Symbiote.State.Merged tag (ability still active)
        - id: GetFatherASC_Timer
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [800, 550]
        - id: HasMergedTag
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [950, 500]
        - id: MakeLiteralTag_Merged
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Symbiote.State.Merged
          position: [800, 650]
        - id: Branch_MergedTag
          type: Branch
          position: [1100, 400]
        # Guarded timer callback logic
        - id: GetPlayerRef_Timer
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [1150, 550]
        - id: ShowFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [1250, 400]
        - id: EnableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1500, 400]
        - id: GetPlayerASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1550, 550]
        - id: TryActivateArmor
          type: CallFunction
          properties:
            function: TryActivateAbilityByClass
          position: [1750, 400]
        - id: EndAbility_Timer
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2000, 400]
        # === EVENT_ENDABILITY (with bWasCancelled check per GAS Audit FIX-1) ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 800]
        - id: Branch_WasCancelled
          type: Branch
          position: [250, 800]
        # Cleanup path (only when cancelled)
        - id: ClearTimer_End
          type: CallFunction
          properties:
            function: K2_ClearAndInvalidateTimerHandle
            class: KismetSystemLibrary
          position: [450, 800]
        - id: GetTimerHandle_End
          type: VariableGet
          properties:
            variable_name: DurationTimerHandle
          position: [300, 900]
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [500, 900]
        - id: IsValid_Father_End
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [650, 800]
        - id: Branch_FatherValid_End
          type: Branch
          position: [800, 800]
        - id: ShowFather_End
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [950, 800]
        - id: EnableCollision_End
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1150, 800]
        - id: TryActivateArmor_End
          type: CallFunction
          properties:
            function: TryActivateAbilityByClass
          position: [1350, 800]
        - id: GetFatherASC_End
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1200, 900]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [Branch_First, Exec]
        # === FIRST ACTIVATION PATH (True branch) - Skip VFX/delay, merge into setup chain ===
        # v4.26 (Rule 4): True path must merge into stateful setup chain, not early-terminate
        - from: [Branch_First, True]
          to: [RemovePriorFormState_First, Exec]
        - from: [RemovePriorFormState_First, Exec]
          to: [ApplySymbioteState_First, Exec]
        - from: [ApplySymbioteState_First, Exec]
          to: [SetFirstFalse, Exec]
        - from: [SetFirstFalse, Exec]
          to: [SetPlayerRef, Exec]
        # === FORM SWITCH PATH (False branch) - Full transition with VFX/delay ===
        # v4.13.5: No invulnerability - use AddLooseGameplayTag instead
        - from: [Branch_First, False]
          to: [AddTransitioningTag, Exec]
        - from: [AddTransitioningTag, Exec]
          to: [SpawnTransitionVFX, Exec]
        - from: [SpawnTransitionVFX, Exec]
          to: [TransitionDelay, Exec]
        - from: [TransitionDelay, OnFinish]
          to: [RemovePriorFormState, Exec]
        - from: [RemovePriorFormState, Exec]
          to: [ApplySymbioteState, Exec]
        - from: [ApplySymbioteState, Exec]
          to: [RemoveTransitioningTag, Exec]
        - from: [RemoveTransitioningTag, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [HideFather, Exec]
        - from: [HideFather, Exec]
          to: [DisableCollision, Exec]
        - from: [DisableCollision, Exec]
          to: [SetCurrentForm, Exec]
        - from: [SetCurrentForm, Exec]
          to: [SetIsAttached, Exec]
        - from: [SetIsAttached, Exec]
          to: [SetTimer, Exec]
        - from: [SetTimer, Exec]
          to: [SetTimerHandle, Exec]
        # v4.26 (VTF-7): CommitCooldown after setup complete
        - from: [SetTimerHandle, Exec]
          to: [CommitCooldown, Exec]
        # Data flow - GetAvatarActor to Cast
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        # Data flow - Cast output to SetFatherRef INPUT and other destinations
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [HideFather, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [DisableCollision, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherASC_Transition, Actor]
        # Data flow - Branch condition
        - from: [GetFirstActivation, bIsFirstActivation]
          to: [Branch_First, Condition]
        # Data flow - First activation path (tag container for form state removal)
        - from: [MakeLiteralTag_FormState, ReturnValue]
          to: [MakeTagContainer_FormState, Tag]
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState_First, WithGrantedTags]
        # Data flow - Form switch path (tag containers)
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState, WithGrantedTags]
        # v4.13.5: Transitioning tag via AddLooseGameplayTag (not GE)
        - from: [MakeLiteralTag_AddTransitioning, ReturnValue]
          to: [MakeTagContainer_AddTransitioning, Tag]
        - from: [MakeTagContainer_AddTransitioning, ReturnValue]
          to: [AddTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AddTransitioningTag, Actor]
        - from: [MakeLiteralTag_RemoveTransitioning, ReturnValue]
          to: [MakeTagContainer_RemoveTransitioning, Tag]
        - from: [MakeTagContainer_RemoveTransitioning, ReturnValue]
          to: [RemoveTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [RemoveTransitioningTag, Actor]
        # Data flow - VFX spawn
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherMesh, Target]
        - from: [GetFatherMesh, Mesh]
          to: [SpawnTransitionVFX, AttachToComponent]
        # Data flow - Player
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        # Data flow - Timer
        - from: [GetDuration, SymbioteDuration]
          to: [SetTimer, Time]
        - from: [SetTimer, ReturnValue]
          to: [SetTimerHandle, DurationTimerHandle]
        # === TIMER EXPIRED FLOW (with guards per GAS Audit FIX-2) ===
        # Guard 1: IsValid(FatherRef)
        - from: [CustomEvent_TimerExpired, Then]
          to: [IsValid_FatherRef, Exec]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [IsValid_FatherRef, Object]
        - from: [IsValid_FatherRef, ReturnValue]
          to: [Branch_FatherValid, Condition]
        - from: [IsValid_FatherRef, Exec]
          to: [Branch_FatherValid, Exec]
        # Guard 2: CurrentForm == Symbiote
        - from: [Branch_FatherValid, True]
          to: [EqualEnum_Symbiote, Exec]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [GetCurrentForm_Timer, Target]
        - from: [GetCurrentForm_Timer, CurrentForm]
          to: [EqualEnum_Symbiote, A]
        - from: [EqualEnum_Symbiote, ReturnValue]
          to: [Branch_FormCheck, Condition]
        - from: [EqualEnum_Symbiote, Exec]
          to: [Branch_FormCheck, Exec]
        # Guard 3: HasMatchingGameplayTag(Symbiote.State.Merged)
        - from: [Branch_FormCheck, True]
          to: [HasMergedTag, Exec]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [GetFatherASC_Timer, Actor]
        - from: [GetFatherASC_Timer, ReturnValue]
          to: [HasMergedTag, Target]
        - from: [MakeLiteralTag_Merged, ReturnValue]
          to: [HasMergedTag, Tag]
        - from: [HasMergedTag, ReturnValue]
          to: [Branch_MergedTag, Condition]
        - from: [HasMergedTag, Exec]
          to: [Branch_MergedTag, Exec]
        # All guards passed - proceed with cleanup
        - from: [Branch_MergedTag, True]
          to: [ShowFather, Exec]
        - from: [ShowFather, Exec]
          to: [EnableCollision, Exec]
        - from: [EnableCollision, Exec]
          to: [TryActivateArmor, Exec]
        - from: [TryActivateArmor, Exec]
          to: [EndAbility_Timer, Exec]
        # Timer data flow
        - from: [GetFatherRef_Timer, FatherRef]
          to: [ShowFather, Target]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [EnableCollision, Target]
        - from: [GetPlayerRef_Timer, PlayerRef]
          to: [GetPlayerASC, Actor]
        - from: [GetPlayerASC, ReturnValue]
          to: [TryActivateArmor, Target]
        # === EVENT_ENDABILITY FLOW (per GAS Audit FIX-1) ===
        # Check bWasCancelled - only cleanup when cancelled
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        # True path: Was cancelled - need cleanup
        - from: [Branch_WasCancelled, True]
          to: [ClearTimer_End, Exec]
        - from: [GetTimerHandle_End, DurationTimerHandle]
          to: [ClearTimer_End, Handle]
        - from: [ClearTimer_End, Exec]
          to: [IsValid_Father_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_Father_End, Object]
        - from: [IsValid_Father_End, ReturnValue]
          to: [Branch_FatherValid_End, Condition]
        - from: [IsValid_Father_End, Exec]
          to: [Branch_FatherValid_End, Exec]
        # Cleanup when father valid
        - from: [Branch_FatherValid_End, True]
          to: [ShowFather_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [ShowFather_End, Target]
        - from: [ShowFather_End, Exec]
          to: [EnableCollision_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [EnableCollision_End, Target]
        - from: [EnableCollision_End, Exec]
          to: [TryActivateArmor_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [GetFatherASC_End, Actor]
        - from: [GetFatherASC_End, ReturnValue]
          to: [TryActivateArmor_End, Target]

  # GA_FatherEngineer - Deploy as Turret (Option B Form Identity)
  # v4.13.5: GAS Audit compliant - NO invulnerability per INV-1
  - name: GA_FatherEngineer
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_FormChangeCooldown
    tags:
      ability_tags:
        - Ability.Father.Engineer
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
      activation_owned_tags:
        - Father.State.TurretDeployed
      activation_required_tags:
        - Father.State.Alive
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.State.Dormant
        - Father.State.Transitioning
        - Father.State.SymbioteLocked
        - Cooldown.Father.FormChange
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: DeployLocation
        type: Vector
      - name: bIsFirstActivation
        type: Bool
        default_value: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        # v4.14: First activation vs form switch branch
        - id: GetFirstActivation
          type: VariableGet
          properties:
            variable_name: bIsFirstActivation
          position: [1100, 100]
        - id: Branch_First
          type: Branch
          position: [1200, 0]
        # === FIRST ACTIVATION PATH (Row Y=-200) - Simple setup, no VFX/delay ===
        - id: RemovePriorFormState_First
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [1600, -200]
        - id: ApplyEngineerState_First
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_EngineerState
          position: [1800, -200]
        - id: SetFirstFalse
          type: VariableSet
          properties:
            variable_name: bIsFirstActivation
          position: [2000, -200]
        - id: EndAbility_First
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2200, -200]
        # === FORM SWITCH PATH (Row Y=200) - Full transition with VFX/delay ===
        # v4.13.5: FULL TRANSITION FLOW (Option B + VFX, NO Invulnerability per GAS Audit INV-1)
        # Step 1: Add Transitioning tag (instead of GE_TransitionInvulnerability)
        - id: GetFatherASC_Transition
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1500, 300]
        - id: AddTransitioningTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1600, 200]
        - id: MakeTagContainer_AddTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1500, 250]
        - id: MakeLiteralTag_AddTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [1400, 300]
        # Step 2: Spawn transition VFX
        - id: GetFatherMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1600, 350]
        - id: SpawnTransitionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [1800, 200]
        # Step 3: Wait 5 seconds (v4.15: WaitDelay auto-terminates with ability)
        - id: TransitionDelay
          type: AbilityTaskWaitDelay
          properties:
            duration: 5.0
          position: [2000, 200]
        # === POST-DELAY GUARDS (GAS Audit MED-3) ===
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Guard
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [2050, 350]
        - id: IsValid_FatherRef_Guard
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [2100, 300]
        - id: Branch_FatherValid_Guard
          type: Branch
          position: [2200, 200]
        # Guard 2: Check Father.State.Transitioning tag
        - id: GetFatherASC_Guard
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [2250, 350]
        - id: HasTransitioningTag_Guard
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [2350, 300]
        - id: MakeLiteralTag_Transitioning_Guard
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2250, 400]
        - id: Branch_TransitioningTag_Guard
          type: Branch
          position: [2500, 200]
        # Step 4: Remove prior form state (now guarded)
        - id: RemovePriorFormState
          type: CallFunction
          properties:
            function: BP_RemoveGameplayEffectFromOwnerWithGrantedTags
            target_self: true
          position: [2700, 200]
        - id: MakeTagContainer_FormState
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2600, 350]
        - id: MakeLiteralTag_FormState
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Effect.Father.FormState
          position: [2400, 350]
        # Step 5: Apply new form state
        - id: ApplyEngineerState
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_EngineerState
          position: [2400, 200]
        # Step 6: Remove Transitioning tag (v4.13.5: replaces GE removal)
        - id: RemoveTransitioningTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [2600, 200]
        - id: MakeTagContainer_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [2550, 300]
        - id: MakeLiteralTag_RemoveTransitioning
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Transitioning
          position: [2500, 350]
        # Continue form switch flow after transition
        - id: GetFatherLocation
          type: CallFunction
          properties:
            function: K2_GetActorLocation
          position: [1200, 0]
        - id: SetDeployLocation
          type: VariableSet
          properties:
            variable_name: DeployLocation
          position: [1500, 0]
        - id: SetCurrentForm
          type: PropertySet
          properties:
            property_name: CurrentForm
            target_class: BP_FatherCompanion
          position: [1800, 0]
        - id: SetIsAttached
          type: PropertySet
          properties:
            property_name: IsAttached
            target_class: BP_FatherCompanion
          position: [2100, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [2400, 0]
        # === END ABILITY FLOW ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 500]
        # v2.5.5: Branch on bWasCancelled - only cleanup when cancelled by another form
        - id: Branch_WasCancelled
          type: Branch
          position: [300, 500]
        # Pure getters for end flow (only used in TRUE path)
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [600, 350]
        - id: IsValid_Father_End
          type: CallFunction
          properties:
            function: IsValid
          position: [900, 350]
        - id: Branch_Valid_End
          type: Branch
          position: [600, 500]
        - id: SetIsDeployed_End
          type: PropertySet
          properties:
            property_name: IsDeployed
            target_class: BP_FatherCompanion
          position: [900, 500]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [Branch_First, Exec]
        # === FIRST ACTIVATION PATH (True branch) - Skip VFX/delay, merge into setup chain ===
        # v4.26 (Rule 4): True path must merge into stateful setup chain, not early-terminate
        - from: [Branch_First, True]
          to: [RemovePriorFormState_First, Exec]
        - from: [RemovePriorFormState_First, Exec]
          to: [ApplyEngineerState_First, Exec]
        - from: [ApplyEngineerState_First, Exec]
          to: [SetFirstFalse, Exec]
        - from: [SetFirstFalse, Exec]
          to: [GetFatherLocation, Exec]
        # === FORM SWITCH PATH (False branch) - Full transition with VFX/delay ===
        # v4.13.5: NO invulnerability - uses AddLooseGameplayTag/RemoveLooseGameplayTag
        - from: [Branch_First, False]
          to: [AddTransitioningTag, Exec]
        - from: [AddTransitioningTag, Exec]
          to: [SpawnTransitionVFX, Exec]
        - from: [SpawnTransitionVFX, Exec]
          to: [TransitionDelay, Exec]
        # v4.14: Route through guards after delay (GAS Audit MED-3)
        - from: [TransitionDelay, OnFinish]
          to: [Branch_FatherValid_Guard, Exec]
        - from: [Branch_FatherValid_Guard, True]
          to: [Branch_TransitioningTag_Guard, Exec]
        - from: [Branch_TransitioningTag_Guard, True]
          to: [RemovePriorFormState, Exec]
        - from: [RemovePriorFormState, Exec]
          to: [ApplyEngineerState, Exec]
        - from: [ApplyEngineerState, Exec]
          to: [RemoveTransitioningTag, Exec]
        - from: [RemoveTransitioningTag, Exec]
          to: [GetFatherLocation, Exec]
        - from: [GetFatherLocation, Exec]
          to: [SetDeployLocation, Exec]
        - from: [SetDeployLocation, Exec]
          to: [SetCurrentForm, Exec]
        - from: [SetCurrentForm, Exec]
          to: [SetIsAttached, Exec]
        - from: [SetIsAttached, Exec]
          to: [CommitCooldown, Exec]
        # Data flow - GetAvatarActor to Cast
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        # Data flow - Cast output to SetFatherRef INPUT and other destinations
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherLocation, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetCurrentForm, Target]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetIsAttached, Target]
        # Data flow - Branch condition
        - from: [GetFirstActivation, bIsFirstActivation]
          to: [Branch_First, Condition]
        # Data flow - First activation path (tag container for form state removal)
        - from: [MakeLiteralTag_FormState, ReturnValue]
          to: [MakeTagContainer_FormState, Tag]
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState_First, WithGrantedTags]
        # Data flow - Form switch path (tag containers)
        - from: [MakeTagContainer_FormState, ReturnValue]
          to: [RemovePriorFormState, WithGrantedTags]
        # === GUARD DATA FLOW (GAS Audit MED-3) ===
        # Guard 1: IsValid(FatherRef)
        - from: [GetFatherRef_Guard, FatherRef]
          to: [IsValid_FatherRef_Guard, Object]
        - from: [IsValid_FatherRef_Guard, ReturnValue]
          to: [Branch_FatherValid_Guard, Condition]
        - from: [GetFatherRef_Guard, FatherRef]
          to: [GetFatherASC_Guard, Actor]
        # Guard 2: HasMatchingGameplayTag(Father.State.Transitioning)
        - from: [GetFatherASC_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Target]
        - from: [MakeLiteralTag_Transitioning_Guard, ReturnValue]
          to: [HasTransitioningTag_Guard, Tag]
        - from: [HasTransitioningTag_Guard, ReturnValue]
          to: [Branch_TransitioningTag_Guard, Condition]
        # v4.13.5: Data flow for Transitioning tag (AddLooseGameplayTag/RemoveLooseGameplayTag)
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherASC_Transition, Actor]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [AddTransitioningTag, Actor]
        - from: [MakeLiteralTag_AddTransitioning, ReturnValue]
          to: [MakeTagContainer_AddTransitioning, Tag]
        - from: [MakeTagContainer_AddTransitioning, ReturnValue]
          to: [AddTransitioningTag, GameplayTags]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [RemoveTransitioningTag, Actor]
        - from: [MakeLiteralTag_RemoveTransitioning, ReturnValue]
          to: [MakeTagContainer_RemoveTransitioning, Tag]
        - from: [MakeTagContainer_RemoveTransitioning, ReturnValue]
          to: [RemoveTransitioningTag, GameplayTags]
        # Data flow - VFX spawn
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetFatherMesh, Target]
        - from: [GetFatherMesh, Mesh]
          to: [SpawnTransitionVFX, AttachToComponent]
        # Data flow - Location
        - from: [GetFatherLocation, ReturnValue]
          to: [SetDeployLocation, DeployLocation]
        # === END ABILITY FLOW ===
        # v2.5.5: First check bWasCancelled - only cleanup when cancelled by form switch
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        # TRUE path (was cancelled by form switch) - do cleanup
        - from: [Branch_WasCancelled, then]
          to: [Branch_Valid_End, Exec]
        - from: [Branch_Valid_End, then]
          to: [SetIsDeployed_End, Exec]
        # FALSE path (normal end after setup) - skip cleanup (no connection needed)
        # Data flow - FatherRef to IsValid (pure nodes)
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_Father_End, Object]
        - from: [IsValid_Father_End, ReturnValue]
          to: [Branch_Valid_End, Condition]
        # Data flow - FatherRef to SetIsDeployed target
        - from: [GetFatherRef_End, FatherRef]
          to: [SetIsDeployed_End, Target]

  # ---------------------------------------------------------------------------
  # COMBAT ABILITIES (4)
  # ---------------------------------------------------------------------------
  
  # GA_FatherAttack - Melee Attack (NarrativeGameplayAbility for custom logic)
  # NOTE: Runs on Father ASC, only in Crawler form
  - name: GA_FatherAttack
    folder: Abilities/Combat
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_AttackCooldown
    tags:
      ability_tags:
        - Ability.Father.Attack
      activation_owned_tags:
        - Father.State.Attacking
      activation_required_tags:
        - Effect.Father.FormState.Crawler  # Uses GE-granted tag (Option B)
      activation_blocked_tags:
        - Cooldown.Father.Attack
        - Father.State.Transitioning
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: TargetEnemy
        type: Object
        class: Actor
      - name: AttackDamage
        type: Float
        default_value: 25.0
        instance_editable: true
      - name: AttackMontage
        type: Object
        class: AnimMontage
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetMontage
          type: VariableGet
          properties:
            variable_name: AttackMontage
          position: [1200, 100]
        - id: PlayMontage
          type: CallFunction
          properties:
            function: PlayAnimMontage
          position: [1200, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [1500, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [1800, 0]
      connections:
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [PlayMontage, Exec]
        - from: [SetFatherRef, FatherRef]
          to: [PlayMontage, Target]
        - from: [GetMontage, AttackMontage]
          to: [PlayMontage, AnimMontage]
        - from: [PlayMontage, Exec]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]

  # GA_FatherLaserShot - Ranged Laser Attack
  # NOTE: Runs on Father ASC, only in Crawler form
  - name: GA_FatherLaserShot
    folder: Abilities/Combat
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_LaserCooldown
    tags:
      ability_tags:
        - Ability.Father.LaserShot
      activation_owned_tags:
        - Father.State.Attacking
      activation_required_tags:
        - Effect.Father.FormState.Crawler  # Uses GE-granted tag (Option B)
      activation_blocked_tags:
        - Cooldown.Father.LaserShot
        - Father.State.Transitioning
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: ProjectileClass
        type: Class
        class: NarrativeProjectile
        instance_editable: true
      - name: LaserDamage
        type: Float
        default_value: 40.0
        instance_editable: true
      - name: MuzzleSocketName
        type: Name
        default_value: MuzzleSocket
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1200, 0]
        - id: GetSocketName
          type: VariableGet
          properties:
            variable_name: MuzzleSocketName
          position: [1200, 100]
        - id: GetSocketLocation
          type: CallFunction
          properties:
            function: GetSocketLocation
          position: [1500, 0]
        - id: GetSocketRotation
          type: CallFunction
          properties:
            function: GetSocketRotation
          position: [1500, 100]
        - id: MakeSpawnTransform
          type: CallFunction
          properties:
            function: MakeTransform
          position: [1650, 50]
        - id: GetProjectileClass
          type: VariableGet
          properties:
            variable_name: ProjectileClass
          position: [1800, 100]
        - id: SpawnProjectile
          type: SpawnActor
          properties:
            actor_class_variable: ProjectileClass
          position: [1800, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [2100, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, 0]
      connections:
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [GetMesh, Exec]
        - from: [SetFatherRef, FatherRef]
          to: [GetMesh, Target]
        - from: [GetMesh, Mesh]
          to: [GetSocketLocation, Target]
        - from: [GetSocketName, MuzzleSocketName]
          to: [GetSocketLocation, InSocketName]
        - from: [GetMesh, Mesh]
          to: [GetSocketRotation, Target]
        - from: [GetSocketName, MuzzleSocketName]
          to: [GetSocketRotation, InSocketName]
        - from: [GetMesh, Exec]
          to: [SpawnProjectile, Exec]
        - from: [GetProjectileClass, ProjectileClass]
          to: [SpawnProjectile, Class]
        - from: [GetSocketLocation, ReturnValue]
          to: [MakeSpawnTransform, Location]
        - from: [GetSocketRotation, ReturnValue]
          to: [MakeSpawnTransform, Rotation]
        - from: [MakeSpawnTransform, ReturnValue]
          to: [SpawnProjectile, SpawnTransform]
        - from: [SpawnProjectile, Exec]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]

  # GA_TurretShoot - Engineer Turret Auto-Fire
  # NOTE: Runs on Father ASC, only in Engineer form when deployed
  - name: GA_TurretShoot
    folder: Abilities/Combat
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_TurretShootCooldown
    tags:
      ability_tags:
        - Ability.Father.TurretShoot
        - Ability.Father.Engineer.TurretShoot
      activation_owned_tags:
        - Father.State.Attacking
      activation_required_tags:
        - Effect.Father.FormState.Engineer  # Uses GE-granted tag (Option B)
        - Father.State.TurretDeployed
      activation_blocked_tags:
        - Cooldown.Father.TurretShoot
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: ProjectileClass
        type: Class
        class: NarrativeProjectile
        instance_editable: true
      - name: TurretDamage
        type: Float
        default_value: 15.0
        instance_editable: true
      - name: MuzzleSocketName
        type: Name
        default_value: TurretMuzzle
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [1200, 0]
        - id: GetSocketName
          type: VariableGet
          properties:
            variable_name: MuzzleSocketName
          position: [1200, 100]
        - id: GetSocketLocation
          type: CallFunction
          properties:
            function: GetSocketLocation
          position: [1500, 0]
        - id: GetSocketRotation
          type: CallFunction
          properties:
            function: GetSocketRotation
          position: [1500, 100]
        - id: MakeSpawnTransform
          type: CallFunction
          properties:
            function: MakeTransform
          position: [1650, 50]
        - id: GetProjectileClass
          type: VariableGet
          properties:
            variable_name: ProjectileClass
          position: [1800, 100]
        - id: SpawnProjectile
          type: SpawnActor
          properties:
            actor_class_variable: ProjectileClass
          position: [1800, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [2100, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, 0]
      connections:
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [GetMesh, Exec]
        - from: [SetFatherRef, FatherRef]
          to: [GetMesh, Target]
        - from: [GetMesh, Mesh]
          to: [GetSocketLocation, Target]
        - from: [GetSocketName, MuzzleSocketName]
          to: [GetSocketLocation, InSocketName]
        - from: [GetMesh, Mesh]
          to: [GetSocketRotation, Target]
        - from: [GetSocketName, MuzzleSocketName]
          to: [GetSocketRotation, InSocketName]
        - from: [GetMesh, Exec]
          to: [SpawnProjectile, Exec]
        - from: [GetProjectileClass, ProjectileClass]
          to: [SpawnProjectile, Class]
        - from: [GetSocketLocation, ReturnValue]
          to: [MakeSpawnTransform, Location]
        - from: [GetSocketRotation, ReturnValue]
          to: [MakeSpawnTransform, Rotation]
        - from: [MakeSpawnTransform, ReturnValue]
          to: [SpawnProjectile, SpawnTransform]
        - from: [SpawnProjectile, Exec]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]

  # GA_FatherElectricTrap - Engineer Electric Web Trap
  # NOTE: Runs on Father ASC, only in Engineer form
  - name: GA_FatherElectricTrap
    folder: Abilities/Combat
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_ElectricTrapCooldown
    tags:
      ability_tags:
        - Ability.Father.ElectricTrap
        - Ability.Father.Engineer.ElectricTrap
      activation_owned_tags:
        - Father.State.Attacking
      activation_required_tags:
        - Effect.Father.FormState.Engineer  # Uses GE-granted tag (Option B)
      activation_blocked_tags:
        - Cooldown.Father.ElectricTrap
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: TrapClass
        type: Class
        class: Actor
        instance_editable: true
      - name: TrapDamage
        type: Float
        default_value: 30.0
        instance_editable: true
      - name: TrapDuration
        type: Float
        default_value: 10.0
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetActorLocation
          type: CallFunction
          properties:
            function: K2_GetActorLocation
          position: [1200, 0]
        - id: MakeSpawnTransform
          type: CallFunction
          properties:
            function: MakeTransform
          position: [1350, 0]
        - id: GetTrapClass
          type: VariableGet
          properties:
            variable_name: TrapClass
          position: [1500, 100]
        - id: SpawnTrap
          type: SpawnActor
          properties:
            actor_class_variable: TrapClass
          position: [1500, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [1800, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2100, 0]
      connections:
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [GetActorLocation, Exec]
        - from: [SetFatherRef, FatherRef]
          to: [GetActorLocation, Target]
        - from: [GetActorLocation, Exec]
          to: [SpawnTrap, Exec]
        - from: [GetTrapClass, TrapClass]
          to: [SpawnTrap, Class]
        - from: [GetActorLocation, ReturnValue]
          to: [MakeSpawnTransform, Location]
        - from: [MakeSpawnTransform, ReturnValue]
          to: [SpawnTrap, SpawnTransform]
        - from: [SpawnTrap, Exec]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]

  # ---------------------------------------------------------------------------
  # ACTION ABILITIES (9)
  # ---------------------------------------------------------------------------
  
  # GA_DomeBurst - Armor Active AOE Damage (player-owned instant)
  # NOTE: Runs on Player ASC, granted via EI_FatherArmorForm - no cross-ASC gates
  - name: GA_DomeBurst
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    cooldown_gameplay_effect_class: GE_DomeBurstCooldown
    tags:
      ability_tags:
        - Ability.Father.DomeBurst
      activation_owned_tags:
        - Father.State.Attacking
      activation_required_tags:
        - Father.Dome.Active           # On Player ASC (from GA_ProtectiveDome)
        - Father.Dome.FullyCharged     # Only burst when dome is FULL (Decision 24)
        # Father.Form.Armor removed - cross-ASC gate, equipment granting handles this
      activation_blocked_tags:
        - Cooldown.Father.DomeBurst
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: BurstRadius
        type: Float
        default_value: 500.0
        instance_editable: true
      - name: BurstDamage
        type: Float
        default_value: 75.0
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        - id: GetPlayerLocation
          type: CallFunction
          properties:
            function: K2_GetActorLocation
          position: [1500, 0]
        - id: GetRadius
          type: VariableGet
          properties:
            variable_name: BurstRadius
          position: [1800, 100]
        - id: MakeObjectTypes
          type: MakeArray
          properties:
            array_type: byte
            values:
              - ObjectTypeQuery3
          position: [1600, 150]
        - id: MakeActorsToIgnore
          type: MakeArray
          properties:
            array_type: object
            class: Actor
          position: [1600, 200]
        - id: SphereOverlap
          type: CallFunction
          properties:
            function: SphereOverlapActors
          position: [1800, 0]
        - id: ForEachActor
          type: ForEachLoop
          position: [2100, 0]
        - id: HasTag
          type: CallFunction
          properties:
            function: ActorHasTag
          position: [2400, 0]
        - id: Branch_Enemy
          type: Branch
          position: [2700, 0]
        - id: GetEnemyASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [3000, 0]
        - id: GetOwnASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponentFromActorInfo
            target_self: true
          position: [3000, 150]
        - id: MakeGESpec
          type: CallFunction
          properties:
            function: MakeOutgoingGameplayEffectSpec
            target_self: true
          position: [3300, 0]
        - id: GetDamage
          type: VariableGet
          properties:
            variable_name: BurstDamage
          position: [3300, 100]
        - id: SetByCaller
          type: CallFunction
          properties:
            function: AssignTagSetByCallerMagnitude
          position: [3600, 0]
        - id: ApplyGE
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectSpecToTarget
          position: [3900, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [2100, 200]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, 200]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SphereOverlap, Exec]
        - from: [SphereOverlap, Exec]
          to: [ForEachActor, Exec]
        - from: [ForEachActor, LoopBody]
          to: [HasTag, Exec]
        - from: [HasTag, Exec]
          to: [Branch_Enemy, Exec]
        - from: [Branch_Enemy, then]
          to: [MakeGESpec, Exec]
        - from: [MakeGESpec, Exec]
          to: [SetByCaller, Exec]
        - from: [SetByCaller, Exec]
          to: [ApplyGE, Exec]
        - from: [ForEachActor, Completed]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]
        # Data flow
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [SetPlayerRef, PlayerRef]
          to: [GetPlayerLocation, Target]
        - from: [GetPlayerLocation, ReturnValue]
          to: [SphereOverlap, SpherePos]
        - from: [GetRadius, BurstRadius]
          to: [SphereOverlap, SphereRadius]
        - from: [MakeObjectTypes, Array]
          to: [SphereOverlap, ObjectTypes]
        - from: [MakeActorsToIgnore, Array]
          to: [SphereOverlap, ActorsToIgnore]
        - from: [SphereOverlap, OutActors]
          to: [ForEachActor, Array]
        - from: [ForEachActor, ArrayElement]
          to: [HasTag, Target]
        - from: [HasTag, ReturnValue]
          to: [Branch_Enemy, Condition]
        - from: [ForEachActor, ArrayElement]
          to: [GetEnemyASC, Actor]
        - from: [GetEnemyASC, ReturnValue]
          to: [ApplyGE, Target]
        - from: [GetOwnASC, ReturnValue]
          to: [ApplyGE, self]
        - from: [MakeGESpec, ReturnValue]
          to: [SetByCaller, SpecHandle]
        - from: [GetDamage, BurstDamage]
          to: [SetByCaller, Magnitude]
        - from: [SetByCaller, ReturnValue]
          to: [ApplyGE, Spec]


  # GA_ProtectiveDome - Armor Passive Damage Absorption (player-owned toggle)
  # NOTE: Runs on Player ASC, granted via EI_FatherArmorForm - no cross-ASC gates
  - name: GA_ProtectiveDome
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    tags:
      ability_tags:
        - Ability.Father.ProtectiveDome
      activation_owned_tags:
        - Father.Dome.Active
      # activation_required_tags removed - Father.Form.Armor is on Father ASC, not Player ASC
      # Equipment granting already ensures this ability is only available in Armor form
    # v4.21: Delegate bindings - fires when player takes damage while dome is active
    delegate_bindings:
      - id: BindDomeDamageAbsorption
        delegate: OnDamagedBy                    # Fires when owner (player) takes damage
        source: OwnerASC                         # Player's ASC (ability runs on player)
        handler: HandleDomeDamageAbsorption      # Custom Event (auto-created with signature)
        # Handler params: DamagerCauserASC, Damage, Spec - use for dome absorption logic
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: DomeAbsorptionHandle
        type: ActiveGameplayEffectHandle
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        - id: GetPlayerASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [1500, 0]
        - id: MakeGESpec
          type: CallFunction
          properties:
            function: MakeOutgoingGameplayEffectSpec
            target_self: true
          position: [1800, 0]
        - id: ApplyGE
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectSpecToSelf
          position: [2100, 0]
        - id: SetDomeHandle
          type: VariableSet
          properties:
            variable_name: DomeAbsorptionHandle
          position: [2400, 0]
        # === END ABILITY - Form exit burst (v4.27: Decisions 22-24) ===
        # When ability ends (form unequipped), try to activate GA_DomeBurst
        # GA_DomeBurst requires Father.Dome.FullyCharged tag, so only fires if charged
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 400]
        - id: GetPlayerRef_End
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [200, 400]
        - id: GetPlayerASC_End
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [400, 400]
        # Step 1: Try to activate GA_DomeBurst (will only succeed if dome is charged)
        - id: TryActivateBurst
          type: CallFunction
          properties:
            function: TryActivateAbilityByClass
            class: AbilitySystemComponent
            parameters:
              InAbilityToActivate: GA_DomeBurst
              bAllowRemoteActivation: false
          position: [600, 400]
        # Step 2: Clear Father.Dome.FullyCharged tag (reset state)
        - id: MakeLiteralTag_Charged
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.Dome.FullyCharged
          position: [600, 550]
        - id: MakeTagContainer_Charged
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [800, 500]
        - id: ClearChargedTag
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1000, 400]
        # Step 3: Remove dome absorption GE
        - id: GetDomeHandle
          type: VariableGet
          properties:
            variable_name: DomeAbsorptionHandle
          position: [1200, 500]
        - id: RemoveGE
          type: CallFunction
          properties:
            function: RemoveActiveGameplayEffect
          position: [1200, 400]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet/CallFunction nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [MakeGESpec, Exec]
        - from: [MakeGESpec, Exec]
          to: [ApplyGE, Exec]
        - from: [ApplyGE, Exec]
          to: [SetDomeHandle, Exec]
        # Data flow
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [SetPlayerRef, PlayerRef]
          to: [GetPlayerASC, Actor]
        # BP_ApplyGameplayEffectSpecToSelf is called on the player's ASC
        - from: [GetPlayerASC, ReturnValue]
          to: [ApplyGE, Target]
        - from: [MakeGESpec, ReturnValue]
          to: [ApplyGE, Spec]
        - from: [ApplyGE, ReturnValue]
          to: [SetDomeHandle, DomeAbsorptionHandle]
        # === END ABILITY FLOW (v4.27: Form exit burst) ===
        # Exec: EndAbility → TryActivateBurst → ClearChargedTag → RemoveGE
        - from: [Event_EndAbility, Then]
          to: [TryActivateBurst, Exec]
        - from: [TryActivateBurst, Exec]
          to: [ClearChargedTag, Exec]
        - from: [ClearChargedTag, Exec]
          to: [RemoveGE, Exec]
        # Data: Get player ASC
        - from: [GetPlayerRef_End, PlayerRef]
          to: [GetPlayerASC_End, Actor]
        # Data: TryActivateBurst target
        - from: [GetPlayerASC_End, ReturnValue]
          to: [TryActivateBurst, Target]
        # Data: ClearChargedTag (Actor + TagContainer)
        - from: [GetPlayerRef_End, PlayerRef]
          to: [ClearChargedTag, Actor]
        - from: [MakeLiteralTag_Charged, ReturnValue]
          to: [MakeTagContainer_Charged, Tag]
        - from: [MakeTagContainer_Charged, ReturnValue]
          to: [ClearChargedTag, GameplayTags]
        # Data: RemoveGE
        - from: [GetPlayerASC_End, ReturnValue]
          to: [RemoveGE, Target]
        - from: [GetDomeHandle, DomeAbsorptionHandle]
          to: [RemoveGE, Handle]

  # GA_FatherExoskeletonDash - Exoskeleton Dash with I-Frames
  # NOTE: Runs on Player ASC, granted via EI_FatherExoskeletonForm - no cross-ASC gates
  - name: GA_FatherExoskeletonDash
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    cooldown_gameplay_effect_class: GE_ExoskeletonDashCooldown
    tags:
      ability_tags:
        - Ability.Father.Exoskeleton.Dash
      activation_owned_tags:
        - Father.State.Dashing
      # activation_required_tags removed - Father.Form.Exoskeleton is cross-ASC gate
      # Equipment granting already ensures this ability is only available in Exoskeleton form
      activation_blocked_tags:
        - Cooldown.Father.Exoskeleton.Dash
        - Father.State.Dashing  # On Player ASC (from this ability's activation_owned_tags)
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: DashDistance
        type: Float
        default_value: 800.0
        instance_editable: true
      - name: DashDuration
        type: Float
        default_value: 0.3
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        # v4.14: Removed MakeInvulnSpec, ApplyInvuln, GetPlayerASC (dead nodes per GAS Audit CRIT-2)
        # GE_DashInvulnerability was removed per INV-1 - no invulnerability during dash
        - id: GetForwardVector
          type: CallFunction
          properties:
            function: GetActorForwardVector
          position: [2400, 0]
        - id: GetDistance
          type: VariableGet
          properties:
            variable_name: DashDistance
          position: [2400, 100]
        - id: MultiplyVector
          type: CallFunction
          properties:
            function: Multiply_VectorFloat
          position: [2700, 0]
        - id: LaunchCharacter
          type: CallFunction
          properties:
            function: LaunchCharacter
          position: [3000, 0]
        - id: GetDuration
          type: VariableGet
          properties:
            variable_name: DashDuration
          position: [3000, 100]
        # v4.15: WaitDelay auto-terminates with ability (Track B GAS Audit)
        - id: Delay
          type: AbilityTaskWaitDelay
          position: [3300, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [3600, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [3900, 0]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        # v4.14: Rewired to skip dead invuln nodes (GAS Audit CRIT-2)
        - from: [SetPlayerRef, Exec]
          to: [LaunchCharacter, Exec]
        - from: [LaunchCharacter, Exec]
          to: [Delay, Exec]
        - from: [Delay, OnFinish]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]
        # Data flow
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        # v4.14: Removed GetPlayerASC, MakeInvulnSpec, ApplyInvuln data flow (dead nodes)
        - from: [SetPlayerRef, PlayerRef]
          to: [GetForwardVector, Target]
        - from: [SetPlayerRef, PlayerRef]
          to: [LaunchCharacter, Target]
        - from: [GetForwardVector, ReturnValue]
          to: [MultiplyVector, A]
        - from: [GetDistance, DashDistance]
          to: [MultiplyVector, B]
        - from: [MultiplyVector, ReturnValue]
          to: [LaunchCharacter, LaunchVelocity]
        - from: [GetDuration, DashDuration]
          to: [Delay, Time]

  # GA_FatherExoskeletonSprint - Exoskeleton Sprint Speed Boost
  # NOTE: Runs on Player ASC, granted via EI_FatherExoskeletonForm - no cross-ASC gates
  - name: GA_FatherExoskeletonSprint
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    tags:
      ability_tags:
        - Ability.Father.Exoskeleton.Sprint
      activation_owned_tags:
        - Father.State.Sprinting
      # activation_required_tags removed - Father.Form.Exoskeleton is cross-ASC gate
      # Equipment granting already ensures this ability is only available in Exoskeleton form
      activation_blocked_tags:
        - Father.State.Dashing  # On Player ASC (from GA_FatherExoskeletonDash)
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: OriginalMaxWalkSpeed
        type: Float
        default_value: 0.0
        instance_editable: true
      - name: SprintSpeedMultiplier
        type: Float
        default_value: 1.5
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        - id: GetCharMov
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [1500, 0]
        - id: GetMaxSpeed
          type: PropertyGet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [1800, 0]
        - id: SetOrigSpeed
          type: VariableSet
          properties:
            variable_name: OriginalMaxWalkSpeed
          position: [2100, 0]
        - id: GetMultiplier
          type: VariableGet
          properties:
            variable_name: SprintSpeedMultiplier
          position: [2100, 100]
        - id: MultiplySpeed
          type: CallFunction
          properties:
            function: Multiply_DoubleDouble
            class: KismetMathLibrary
          position: [2400, 0]
        - id: SetMaxSpeed
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [2700, 0]
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 400]
        - id: GetPlayerRef_End
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [300, 400]
        - id: GetCharMov_End
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [600, 400]
        - id: GetOrigSpeed
          type: VariableGet
          properties:
            variable_name: OriginalMaxWalkSpeed
          position: [900, 500]
        - id: RestoreSpeed
          type: PropertySet
          properties:
            property_name: MaxWalkSpeed
            target_class: CharacterMovementComponent
          position: [900, 400]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SetOrigSpeed, Exec]
        - from: [SetOrigSpeed, Exec]
          to: [SetMaxSpeed, Exec]
        # Data flow - Cast
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        # Data flow - PlayerRef
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetCharMov, Target]
        # Data flow - CharacterMovement
        - from: [GetCharMov, CharacterMovement]
          to: [GetMaxSpeed, Target]
        - from: [GetCharMov, CharacterMovement]
          to: [SetMaxSpeed, Target]
        # Data flow - Speed calculation
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [SetOrigSpeed, OriginalMaxWalkSpeed]
        - from: [GetMaxSpeed, MaxWalkSpeed]
          to: [MultiplySpeed, A]
        - from: [GetMultiplier, SprintSpeedMultiplier]
          to: [MultiplySpeed, B]
        - from: [MultiplySpeed, ReturnValue]
          to: [SetMaxSpeed, NewMaxWalkSpeed]
        # === END ABILITY FLOW ===
        - from: [Event_EndAbility, Then]
          to: [RestoreSpeed, Exec]
        # Data flow - End
        - from: [GetPlayerRef_End, PlayerRef]
          to: [GetCharMov_End, Target]
        - from: [GetCharMov_End, CharacterMovement]
          to: [RestoreSpeed, Target]
        - from: [GetOrigSpeed, OriginalMaxWalkSpeed]
          to: [RestoreSpeed, NewMaxWalkSpeed]

  # GA_StealthField - Exoskeleton Stealth Invisibility (player-owned toggle)
  # NOTE: Runs on Player ASC, granted via EI_FatherExoskeletonForm - no cross-ASC gates
  - name: GA_StealthField
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    cooldown_gameplay_effect_class: GE_StealthCooldown
    tags:
      ability_tags:
        - Ability.Father.StealthField
      activation_owned_tags:
        - Father.State.Stealthed
      # activation_required_tags removed - Father.Form.Exoskeleton is cross-ASC gate
      # Equipment granting already ensures this ability is only available in Exoskeleton form
      activation_blocked_tags:
        - Cooldown.Father.StealthField
    # v4.21: Delegate bindings - break stealth on damage taken or dealt
    delegate_bindings:
      - id: BindStealthDamageBreak
        delegate: OnDamagedBy                    # Fires when player takes damage
        source: OwnerASC                         # Player's ASC (ability runs on player)
        handler: HandleStealthDamageBreak        # Custom Event - ends ability on hit
        # Handler params: DamagerCauserASC, Damage, Spec
      - id: BindStealthAttackBreak
        delegate: OnDealtDamage                  # Fires when player deals damage
        source: OwnerASC                         # Player's ASC
        handler: HandleStealthAttackBreak        # Custom Event - ends ability on attack
        # Handler params: DamagedASC, Damage, Spec - stealth breaks on first hit
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: StealthEffectHandle
        type: ActiveGameplayEffectHandle
      - name: StealthDuration
        type: Float
        default_value: 8.0
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        - id: GetPlayerASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [1500, 0]
        - id: MakeGESpec
          type: CallFunction
          properties:
            function: MakeOutgoingGameplayEffectSpec
            target_self: true
          position: [1800, 0]
        - id: ApplyGE
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectSpecToSelf
          position: [2100, 0]
        - id: SetStealthHandle
          type: VariableSet
          properties:
            variable_name: StealthEffectHandle
          position: [2400, 0]
        - id: GetDuration
          type: VariableGet
          properties:
            variable_name: StealthDuration
          position: [2700, 100]
        # v4.15: WaitDelay auto-terminates with ability (Track B GAS Audit)
        - id: Delay
          type: AbilityTaskWaitDelay
          position: [2700, 0]
        # === POST-DELAY GUARDS (GAS Audit MED-4) ===
        # Guard: Validate PlayerRef still exists after 8s delay
        - id: GetPlayerRef_Guard
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [2850, 100]
        - id: IsValid_PlayerRef_Guard
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [2900, 50]
        - id: Branch_PlayerValid_Guard
          type: Branch
          position: [3000, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [3200, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [3300, 0]
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 400]
        - id: GetPlayerRef_End
          type: VariableGet
          properties:
            variable_name: PlayerRef
          position: [300, 400]
        - id: GetPlayerASC_End
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [600, 400]
        - id: GetStealthHandle
          type: VariableGet
          properties:
            variable_name: StealthEffectHandle
          position: [900, 500]
        - id: RemoveGE
          type: CallFunction
          properties:
            function: RemoveActiveGameplayEffect
          position: [900, 400]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [MakeGESpec, Exec]
        - from: [MakeGESpec, Exec]
          to: [ApplyGE, Exec]
        - from: [ApplyGE, Exec]
          to: [SetStealthHandle, Exec]
        - from: [SetStealthHandle, Exec]
          to: [Delay, Exec]
        # v4.14: Route through guard after delay (GAS Audit MED-4)
        - from: [Delay, OnFinish]
          to: [Branch_PlayerValid_Guard, Exec]
        - from: [Branch_PlayerValid_Guard, True]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]
        # Guard data flow (GAS Audit MED-4)
        - from: [GetPlayerRef_Guard, PlayerRef]
          to: [IsValid_PlayerRef_Guard, Object]
        - from: [IsValid_PlayerRef_Guard, ReturnValue]
          to: [Branch_PlayerValid_Guard, Condition]
        # Data flow
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [SetPlayerRef, PlayerRef]
          to: [GetPlayerASC, Actor]
        # BP_ApplyGameplayEffectSpecToSelf is called on the player's ASC
        - from: [GetPlayerASC, ReturnValue]
          to: [ApplyGE, Target]
        - from: [MakeGESpec, ReturnValue]
          to: [ApplyGE, Spec]
        - from: [ApplyGE, ReturnValue]
          to: [SetStealthHandle, StealthEffectHandle]
        - from: [GetDuration, StealthDuration]
          to: [Delay, Time]
        # === END ABILITY FLOW ===
        - from: [Event_EndAbility, Then]
          to: [RemoveGE, Exec]
        # Data flow - End
        - from: [GetPlayerRef_End, PlayerRef]
          to: [GetPlayerASC_End, Actor]
        - from: [GetPlayerASC_End, ReturnValue]
          to: [RemoveGE, Target]
        - from: [GetStealthHandle, StealthEffectHandle]
          to: [RemoveGE, Handle]

  # GA_Backstab - Universal Player Passive Backstab Damage
  # v4.26 (Decision 4): Universal ability - add to player's Default Abilities array, NOT granted via equipment
  # NOTE: Runs on Player ASC - no cross-ASC gates needed
  # PASSIVE ABILITY: Contains CheckBackstabCondition and ApplyBackstabBonus FUNCTIONS
  # These functions are CALLED BY attack abilities - GA_Backstab itself does not activate
  # Functions must be created manually in editor (manifest only generates event_graph)
  - name: GA_Backstab
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: LocalPredicted
    tags:
      ability_tags:
        - Ability.Father.Backstab
      activation_owned_tags:
        - State.BackstabReady
      # No activation_required_tags - universal ability, internal conditions (sight check, enemy unaware) handle gating
    variables:
      - name: BackstabDamageMultiplier
        type: Float
        default_value: 2.0
        instance_editable: true
    event_graph:
      # Minimal event_graph - passive ability immediately ends on activation
      # Actual logic is in CheckBackstabCondition/ApplyBackstabBonus custom functions
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [300, 0]
      connections:
        - from: [Event_Activate, Then]
          to: [EndAbility, Exec]
    # v4.14: Custom functions for backstab detection and bonus application
    # NOTE: Simplified to use only supported node types. FunctionEntry and FunctionResult
    # are auto-created by the generator. Greater_FloatFloat B pin defaults to 0.
    custom_functions:
      # CheckBackstabCondition - Returns true if enemy is facing away from player
      # Logic: Get dot product of enemy forward vector and direction to player
      # Positive dot means enemy is facing toward player (not backstab)
      # Negative dot means enemy is facing away (valid backstab)
      - function_name: CheckBackstabCondition
        inputs:
          - name: EnemyActor
            type: Actor
        outputs:
          - name: CanBackstab
            type: Boolean
        nodes:
          # Get the owning actor (player)
          - id: GetOwningActor
            type: CallFunction
            properties:
              function: GetAvatarActorFromActorInfo
              target_self: true
            position: [0, 0]
          # Get enemy's forward vector
          - id: GetEnemyForward
            type: CallFunction
            properties:
              function: GetActorForwardVector
            position: [200, 100]
          # Get player location
          - id: GetPlayerLocation
            type: CallFunction
            properties:
              function: GetActorLocation
            position: [200, 200]
          # Get enemy location
          - id: GetEnemyLocation
            type: CallFunction
            properties:
              function: GetActorLocation
            position: [200, 300]
          # Subtract to get direction (player - enemy)
          - id: SubtractVectors
            type: CallFunction
            properties:
              function: Subtract_VectorVector
              class: KismetMathLibrary
            position: [400, 250]
          # Normalize the direction
          - id: NormalizeDir
            type: CallFunction
            properties:
              function: Normal
              class: KismetMathLibrary
            position: [600, 250]
          # Dot product - positive means same direction (not backstab)
          - id: DotProduct
            type: CallFunction
            properties:
              function: Dot_VectorVector
              class: KismetMathLibrary
            position: [800, 150]
          # Check if dot < 0 (enemy facing away = backstab)
          - id: CheckNegative
            type: CallFunction
            properties:
              function: Less_FloatFloat
              class: KismetMathLibrary
            position: [1000, 150]
        connections:
          # EnemyActor -> GetEnemyForward target
          - from: [FunctionEntry, EnemyActor]
            to: [GetEnemyForward, Target]
          # EnemyActor -> GetEnemyLocation target
          - from: [FunctionEntry, EnemyActor]
            to: [GetEnemyLocation, Target]
          # GetOwningActor -> GetPlayerLocation target
          - from: [GetOwningActor, ReturnValue]
            to: [GetPlayerLocation, Target]
          # Player location - Enemy location = direction to player
          - from: [GetPlayerLocation, ReturnValue]
            to: [SubtractVectors, A]
          - from: [GetEnemyLocation, ReturnValue]
            to: [SubtractVectors, B]
          # Normalize the direction
          - from: [SubtractVectors, ReturnValue]
            to: [NormalizeDir, A]
          # Dot product of enemy forward and direction to player
          - from: [GetEnemyForward, ReturnValue]
            to: [DotProduct, A]
          - from: [NormalizeDir, ReturnValue]
            to: [DotProduct, B]
          # Check if dot < 0 (B defaults to 0)
          - from: [DotProduct, ReturnValue]
            to: [CheckNegative, A]
          # Return the result (connects to auto-created FunctionResult)
          - from: [CheckNegative, ReturnValue]
            to: [FunctionResult, CanBackstab]
      # ApplyBackstabBonus - Applies GE_BackstabBonus effect to player
      # GE_BackstabBonus grants +25 AttackRating (instant effect)
      # Attack abilities call: if CheckBackstabCondition(Enemy) then ApplyBackstabBonus()
      # v4.14: Generator now supports TSubclassOf pin defaults via param.PinName syntax
      - function_name: ApplyBackstabBonus
        pure: false
        nodes:
          # BP_ApplyGameplayEffectToOwner applies GE to ability owner (player)
          # Per guide Section 15.2: Apply Gameplay Effect to Owner -> GE_BackstabBonus
          - id: ApplyGEToOwner
            type: CallFunction
            properties:
              # BP_ApplyGameplayEffectToOwner is the Blueprint-callable version on UGameplayAbility
              function: BP_ApplyGameplayEffectToOwner
              target_self: true
              # v4.14: Set TSubclassOf<UGameplayEffect> pin default to GE_BackstabBonus
              param.GameplayEffectClass: GE_BackstabBonus
              param.GameplayEffectLevel: 1
            position: [200, 0]
        connections:
          # Exec flow: Entry -> Apply GE to Owner
          - from: [FunctionEntry, Then]
            to: [ApplyGEToOwner, Exec]

  # GA_ProximityStrike - Symbiote AOE Damage
  # NOTE: Runs on Player ASC, granted via EI_FatherSymbioteForm - no cross-ASC gates
  - name: GA_ProximityStrike
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_ProximityStrikeCooldown
    tags:
      ability_tags:
        - Ability.Father.ProximityStrike
        - Ability.Father.Symbiote.ProximityStrike
      activation_owned_tags:
        - Father.State.ProximityActive
      # activation_required_tags removed - Father.Form.Symbiote is cross-ASC gate
      # Equipment granting already ensures this ability is only available in Symbiote form
      activation_blocked_tags:
        - Cooldown.Father.ProximityStrike
    variables:
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: ProximityRadius
        type: Float
        default_value: 400.0
        instance_editable: true
      - name: ProximityDamage
        type: Float
        default_value: 50.0
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetOwningActor
          type: CallFunction
          properties:
            function: GetOwningActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [900, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1200, 0]
        - id: GetPlayerLocation
          type: CallFunction
          properties:
            function: K2_GetActorLocation
          position: [1500, 0]
        - id: GetRadius
          type: VariableGet
          properties:
            variable_name: ProximityRadius
          position: [1800, 100]
        - id: MakeObjectTypes
          type: MakeArray
          properties:
            array_type: byte
            values:
              - ObjectTypeQuery3
          position: [1600, 150]
        - id: MakeActorsToIgnore
          type: MakeArray
          properties:
            array_type: object
            class: Actor
          position: [1600, 200]
        - id: SphereOverlap
          type: CallFunction
          properties:
            function: SphereOverlapActors
          position: [1800, 0]
        - id: ForEachActor
          type: ForEachLoop
          position: [2100, 0]
        - id: HasTag
          type: CallFunction
          properties:
            function: ActorHasTag
          position: [2400, 0]
        - id: Branch_Enemy
          type: Branch
          position: [2700, 0]
        - id: GetEnemyASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [3000, 0]
        - id: GetOwnASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponentFromActorInfo
            target_self: true
          position: [3000, 150]
        - id: MakeGESpec
          type: CallFunction
          properties:
            function: MakeOutgoingGameplayEffectSpec
            target_self: true
          position: [3300, 0]
        - id: GetDamage
          type: VariableGet
          properties:
            variable_name: ProximityDamage
          position: [3300, 100]
        - id: SetByCaller
          type: CallFunction
          properties:
            function: AssignTagSetByCallerMagnitude
          position: [3600, 0]
        - id: ApplyGE
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectSpecToTarget
          position: [3900, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [2100, 200]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, 200]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (impure nodes only - skip pure PropertyGet nodes)
        - from: [Event_Activate, Then]
          to: [GetOwningActor, Exec]
        - from: [GetOwningActor, Exec]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SphereOverlap, Exec]
        - from: [SphereOverlap, Exec]
          to: [ForEachActor, Exec]
        - from: [ForEachActor, LoopBody]
          to: [HasTag, Exec]
        - from: [HasTag, Exec]
          to: [Branch_Enemy, Exec]
        - from: [Branch_Enemy, then]
          to: [MakeGESpec, Exec]
        - from: [MakeGESpec, Exec]
          to: [SetByCaller, Exec]
        - from: [SetByCaller, Exec]
          to: [ApplyGE, Exec]
        - from: [ForEachActor, Completed]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]
        # Data flow
        - from: [GetOwningActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [SetPlayerRef, PlayerRef]
          to: [GetPlayerLocation, Target]
        - from: [GetPlayerLocation, ReturnValue]
          to: [SphereOverlap, SpherePos]
        - from: [GetRadius, ProximityRadius]
          to: [SphereOverlap, SphereRadius]
        - from: [MakeObjectTypes, Array]
          to: [SphereOverlap, ObjectTypes]
        - from: [MakeActorsToIgnore, Array]
          to: [SphereOverlap, ActorsToIgnore]
        - from: [SphereOverlap, OutActors]
          to: [ForEachActor, Array]
        - from: [ForEachActor, ArrayElement]
          to: [HasTag, Target]
        - from: [HasTag, ReturnValue]
          to: [Branch_Enemy, Condition]
        - from: [ForEachActor, ArrayElement]
          to: [GetEnemyASC, Actor]
        - from: [GetOwnASC, ReturnValue]
          to: [ApplyGE, self]
        - from: [GetEnemyASC, ReturnValue]
          to: [ApplyGE, Target]
        - from: [MakeGESpec, ReturnValue]
          to: [SetByCaller, SpecHandle]
        - from: [GetDamage, ProximityDamage]
          to: [SetByCaller, Magnitude]
        - from: [SetByCaller, ReturnValue]
          to: [ApplyGE, Spec]

  # GA_FatherMark - Mark Enemy for Bonus Damage
  # NOTE: Runs on Father ASC, only in Crawler form
  - name: GA_FatherMark
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    tags:
      ability_tags:
        - Ability.Father.Mark
      activation_owned_tags:
        - Father.State.Marking
      activation_required_tags:
        - Effect.Father.FormState.Crawler  # Uses GE-granted tag (Option B)
      activation_blocked_tags:
        - Father.State.Transitioning
    variables:
      - name: TargetEnemy
        type: Object
        class: Actor
      - name: MarkDuration
        type: Float
        default_value: 10.0
        instance_editable: true
      - name: MarkDamageBonus
        type: Float
        default_value: 1.5
        instance_editable: true
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetTarget
          type: VariableGet
          properties:
            variable_name: TargetEnemy
          position: [300, 0]
        - id: IsValid
          type: CallFunction
          properties:
            function: IsValid
          position: [600, 0]
        - id: Branch_Valid
          type: Branch
          position: [900, 0]
        - id: GetEnemyASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
          position: [1200, 0]
        - id: GetOwnASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponentFromActorInfo
            target_self: true
          position: [1200, 100]
        - id: MakeGESpec
          type: CallFunction
          properties:
            function: MakeOutgoingGameplayEffectSpec
            target_self: true
          position: [1500, 0]
        - id: GetDuration
          type: VariableGet
          properties:
            variable_name: MarkDuration
          position: [1800, 100]
        - id: SetDurationByCaller
          type: CallFunction
          properties:
            function: AssignTagSetByCallerMagnitude
          position: [1800, 0]
        - id: ApplyGE
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectSpecToTarget
          position: [2100, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [2400, 0]
        - id: EndAbility_Invalid
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [1200, 200]
      connections:
        # Exec flow (skip pure IsValid, VariableGet, and GetAbilitySystemComponent)
        - from: [Event_Activate, Then]
          to: [Branch_Valid, Exec]
        - from: [Branch_Valid, True]
          to: [MakeGESpec, Exec]
        - from: [MakeGESpec, Exec]
          to: [SetDurationByCaller, Exec]
        - from: [SetDurationByCaller, Exec]
          to: [ApplyGE, Exec]
        - from: [ApplyGE, Exec]
          to: [EndAbility, Exec]
        - from: [Branch_Valid, False]
          to: [EndAbility_Invalid, Exec]
        # Data flow
        - from: [GetTarget, TargetEnemy]
          to: [IsValid, Object]
        - from: [IsValid, ReturnValue]
          to: [Branch_Valid, Condition]
        - from: [GetTarget, TargetEnemy]
          to: [GetEnemyASC, Actor]
        - from: [MakeGESpec, ReturnValue]
          to: [SetDurationByCaller, SpecHandle]
        - from: [GetDuration, MarkDuration]
          to: [SetDurationByCaller, Magnitude]
        - from: [SetDurationByCaller, ReturnValue]
          to: [ApplyGE, Spec]
        - from: [GetEnemyASC, ReturnValue]
          to: [ApplyGE, Target]
        - from: [GetOwnASC, ReturnValue]
          to: [ApplyGE, self]

  # GA_FatherSacrifice - Emergency Save with Dormant Period
  - name: GA_FatherSacrifice
    folder: Abilities/Actions
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    tags:
      ability_tags:
        - Ability.Father.Sacrifice
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
      activation_owned_tags:
        - Father.State.Sacrificing
      activation_required_tags:
        - Father.State.Recruited
      activation_blocked_tags:
        - Cooldown.Father.Sacrifice
        - Father.State.Dormant
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: PlayerRef
        type: Object
        class: NarrativePlayerCharacter
      - name: IsMonitoring
        type: Bool
        default_value: false
      - name: InvulnerabilityDuration
        type: Float
        default_value: 10.0
        instance_editable: true
      - name: DormantDuration
        type: Float
        default_value: 60.0
        instance_editable: true
      - name: DormantTimerHandle
        type: TimerHandle
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1200, 0]
        - id: SetPlayerRef
          type: VariableSet
          properties:
            variable_name: PlayerRef
          position: [1500, 0]
        - id: SetIsMonitoring
          type: VariableSet
          properties:
            variable_name: IsMonitoring
          position: [1800, 0]
        # === FULL SACRIFICE LOGIC (GAS Audit CRIT-3) ===
        # Step 1: Apply GE_SacrificeInvulnerability to PLAYER (8 seconds)
        - id: GetPlayerASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [2100, 0]
        - id: ApplySacrificeInvuln
          type: CallFunction
          properties:
            function: BP_ApplyGameplayEffectToOwner
            target_self: true
            gameplay_effect_class: GE_SacrificeInvulnerability
          position: [2400, 0]
        # Step 2: Hide Father actor
        - id: HideFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [2700, 0]
        # Step 3: Disable Father collision
        - id: DisableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [3000, 0]
        # Step 4: Add Father.State.Dormant tag
        - id: GetFatherASC
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [3300, 100]
        - id: AddDormantTag
          type: CallFunction
          properties:
            function: AddLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [3300, 0]
        - id: MakeTagContainer_Dormant
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [3200, 150]
        - id: MakeLiteralTag_Dormant
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Dormant
          position: [3100, 200]
        # Step 5: Start dormant timer
        - id: GetDormantDuration
          type: VariableGet
          properties:
            variable_name: DormantDuration
          position: [3600, 100]
        - id: SetDormantTimer
          type: CallFunction
          properties:
            function: K2_SetTimerDelegate
          position: [3600, 0]
        - id: SetTimerHandle
          type: VariableSet
          properties:
            variable_name: DormantTimerHandle
          position: [3900, 0]
        # === TIMER CALLBACK (with guards) ===
        - id: CustomEvent_DormantExpired
          type: CustomEvent
          properties:
            event_name: OnDormantTimerExpired
          position: [0, 600]
        # Guard 1: Validate FatherRef
        - id: GetFatherRef_Timer
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [100, 700]
        - id: IsValid_FatherRef_Timer
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [250, 600]
        - id: Branch_FatherValid_Timer
          type: Branch
          position: [400, 600]
        # Guard 2: Check Father.State.Dormant tag
        - id: GetFatherASC_Timer
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [500, 750]
        - id: HasDormantTag_Timer
          type: CallFunction
          properties:
            function: HasMatchingGameplayTag
            class: AbilitySystemComponent
          position: [650, 700]
        - id: MakeLiteralTag_Dormant_Timer
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Dormant
          position: [500, 800]
        - id: Branch_DormantTag_Timer
          type: Branch
          position: [800, 600]
        # Guarded timer callback logic
        - id: ShowFather_Timer
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [950, 600]
        - id: EnableCollision_Timer
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1200, 600]
        - id: RemoveDormantTag_Timer
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1450, 600]
        - id: MakeTagContainer_RemoveDormant
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1350, 750]
        - id: MakeLiteralTag_RemoveDormant
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Dormant
          position: [1250, 800]
        - id: EndAbility_Timer
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [1700, 600]
        # === EVENT_ENDABILITY ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 1000]
        - id: Branch_WasCancelled
          type: Branch
          position: [250, 1000]
        # Cleanup path (only when cancelled)
        - id: ClearTimer
          type: CallFunction
          properties:
            function: K2_ClearAndInvalidateTimerHandle
            class: KismetSystemLibrary
          position: [450, 1000]
        - id: GetTimerHandle
          type: VariableGet
          properties:
            variable_name: DormantTimerHandle
          position: [300, 1100]
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [600, 1100]
        - id: IsValid_Father_End
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [700, 1050]
        - id: Branch_FatherValid_End
          type: Branch
          position: [850, 1000]
        - id: ShowFather_End
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [1000, 1000]
        - id: EnableCollision_End
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1250, 1000]
        - id: GetFatherASC_End
          type: CallFunction
          properties:
            function: GetAbilitySystemComponent
            class: AbilitySystemBlueprintLibrary
          position: [1350, 1150]
        - id: RemoveDormantTag_End
          type: CallFunction
          properties:
            function: RemoveLooseGameplayTags
            class: AbilitySystemBlueprintLibrary
          position: [1500, 1000]
        - id: MakeTagContainer_End
          type: CallFunction
          properties:
            function: MakeGameplayTagContainerFromTag
            class: BlueprintGameplayTagLibrary
          position: [1400, 1150]
        - id: MakeLiteralTag_End
          type: CallFunction
          properties:
            function: MakeLiteralGameplayTag
            class: BlueprintGameplayTagLibrary
            literal_value: Father.State.Dormant
          position: [1300, 1200]
      connections:
        # === ACTIVATION FLOW (GAS Audit CRIT-3 - full sacrifice logic) ===
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [SetPlayerRef, Exec]
        - from: [SetPlayerRef, Exec]
          to: [SetIsMonitoring, Exec]
        - from: [SetIsMonitoring, Exec]
          to: [ApplySacrificeInvuln, Exec]
        - from: [ApplySacrificeInvuln, Exec]
          to: [HideFather, Exec]
        - from: [HideFather, Exec]
          to: [DisableCollision, Exec]
        - from: [DisableCollision, Exec]
          to: [AddDormantTag, Exec]
        - from: [AddDormantTag, Exec]
          to: [SetDormantTimer, Exec]
        - from: [SetDormantTimer, Exec]
          to: [SetTimerHandle, Exec]
        # Data flow - Activation
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [SetFatherRef, FatherRef]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [SetPlayerRef, PlayerRef]
        - from: [SetPlayerRef, PlayerRef]
          to: [GetPlayerASC, Actor]
        - from: [SetFatherRef, FatherRef]
          to: [HideFather, Target]
        - from: [SetFatherRef, FatherRef]
          to: [DisableCollision, Target]
        - from: [SetFatherRef, FatherRef]
          to: [GetFatherASC, Actor]
        - from: [SetFatherRef, FatherRef]
          to: [AddDormantTag, Actor]
        - from: [MakeLiteralTag_Dormant, ReturnValue]
          to: [MakeTagContainer_Dormant, Tag]
        - from: [MakeTagContainer_Dormant, ReturnValue]
          to: [AddDormantTag, GameplayTags]
        - from: [GetDormantDuration, DormantDuration]
          to: [SetDormantTimer, Time]
        - from: [SetDormantTimer, ReturnValue]
          to: [SetTimerHandle, DormantTimerHandle]
        # === TIMER CALLBACK FLOW (with guards) ===
        - from: [CustomEvent_DormantExpired, Then]
          to: [Branch_FatherValid_Timer, Exec]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [IsValid_FatherRef_Timer, Object]
        - from: [IsValid_FatherRef_Timer, ReturnValue]
          to: [Branch_FatherValid_Timer, Condition]
        - from: [Branch_FatherValid_Timer, True]
          to: [Branch_DormantTag_Timer, Exec]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [GetFatherASC_Timer, Actor]
        - from: [GetFatherASC_Timer, ReturnValue]
          to: [HasDormantTag_Timer, Target]
        - from: [MakeLiteralTag_Dormant_Timer, ReturnValue]
          to: [HasDormantTag_Timer, Tag]
        - from: [HasDormantTag_Timer, ReturnValue]
          to: [Branch_DormantTag_Timer, Condition]
        - from: [Branch_DormantTag_Timer, True]
          to: [ShowFather_Timer, Exec]
        - from: [ShowFather_Timer, Exec]
          to: [EnableCollision_Timer, Exec]
        - from: [EnableCollision_Timer, Exec]
          to: [RemoveDormantTag_Timer, Exec]
        - from: [RemoveDormantTag_Timer, Exec]
          to: [EndAbility_Timer, Exec]
        # Data flow - Timer callback
        - from: [GetFatherRef_Timer, FatherRef]
          to: [ShowFather_Timer, Target]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [EnableCollision_Timer, Target]
        - from: [GetFatherRef_Timer, FatherRef]
          to: [RemoveDormantTag_Timer, Actor]
        - from: [MakeLiteralTag_RemoveDormant, ReturnValue]
          to: [MakeTagContainer_RemoveDormant, Tag]
        - from: [MakeTagContainer_RemoveDormant, ReturnValue]
          to: [RemoveDormantTag_Timer, GameplayTags]
        # === EVENT_ENDABILITY FLOW ===
        - from: [Event_EndAbility, Then]
          to: [Branch_WasCancelled, Exec]
        - from: [Event_EndAbility, bWasCancelled]
          to: [Branch_WasCancelled, Condition]
        - from: [Branch_WasCancelled, True]
          to: [ClearTimer, Exec]
        - from: [GetTimerHandle, DormantTimerHandle]
          to: [ClearTimer, Handle]
        - from: [ClearTimer, Exec]
          to: [Branch_FatherValid_End, Exec]
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_Father_End, Object]
        - from: [IsValid_Father_End, ReturnValue]
          to: [Branch_FatherValid_End, Condition]
        - from: [Branch_FatherValid_End, True]
          to: [ShowFather_End, Exec]
        - from: [ShowFather_End, Exec]
          to: [EnableCollision_End, Exec]
        - from: [EnableCollision_End, Exec]
          to: [RemoveDormantTag_End, Exec]
        # Data flow - EndAbility cleanup
        - from: [GetFatherRef_End, FatherRef]
          to: [ShowFather_End, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [EnableCollision_End, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [GetFatherASC_End, Actor]
        - from: [GetFatherRef_End, FatherRef]
          to: [RemoveDormantTag_End, Actor]
        - from: [MakeLiteralTag_End, ReturnValue]
          to: [MakeTagContainer_End, Tag]
        - from: [MakeTagContainer_End, ReturnValue]
          to: [RemoveDormantTag_End, GameplayTags]

  # GA_FatherRifle - Rifle Weapon Form (NPC-owned form ability)
  # v2.7.0: Full Narrative Pro item flow with BreakStruct/GetArrayItem
  # NOTE: Uses placeholder class NarrativeItem until EI_FatherRifleWeapon is generated
  - name: GA_FatherRifle
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    tags:
      ability_tags:
        - Ability.Father.Rifle
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
        - Ability.Father.Sword
      activation_owned_tags:
        - Father.Form.Rifle
        - Father.State.Wielded
      activation_required_tags:
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.Form.Rifle
        - Father.State.Transitioning
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: WeaponRef
        type: Object
        class: WeaponItem
    event_graph:
      nodes:
        # === ACTIVATION NODES ===
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: HideFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [1200, 0]
        - id: DisableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1500, 0]
        # Get player and inventory
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1200, 150]
        - id: GetInventory
          type: CallFunction
          properties:
            function: GetComponentByClass
            class: Actor
            component_class: NarrativeInventoryComponent
          position: [1500, 150]
        - id: CastToInventory
          type: DynamicCast
          properties:
            target_class: NarrativeInventoryComponent
          position: [1800, 150]
        # Add weapon item to player inventory
        - id: TryAddWeapon
          type: CallFunction
          properties:
            function: TryAddItemFromClass
            class: NarrativeInventoryComponent
            # TODO: item_class should be EI_FatherRifleWeapon after first generation
            item_class: NarrativeItem
            quantity: 1
          position: [2100, 150]
        # Break FItemAddResult struct to get Stacks array
        - id: BreakItemResult
          type: BreakStruct
          properties:
            struct_type: FItemAddResult
          position: [2400, 150]
        # Get first item from Stacks array (index 0)
        - id: GetFirstStack
          type: GetArrayItem
          properties:
            index: 0
          position: [2700, 150]
        # Cast to WeaponItem and wield
        - id: CastToWeapon
          type: DynamicCast
          properties:
            target_class: WeaponItem
          position: [3000, 150]
        - id: SetWeaponRef
          type: VariableSet
          properties:
            variable_name: WeaponRef
          position: [3300, 150]
        - id: WieldWeapon
          type: CallFunction
          properties:
            function: WieldInSlot
            slot_tag: Narrative.Equipment.WieldSlot.MainHand
          position: [3600, 150]
        - id: EndAbility_Success
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [3900, 150]
        # === END ABILITY NODES ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 500]
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [300, 500]
        # === GUARDS (GAS Audit MED-5) ===
        - id: IsValid_FatherRef_End
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [400, 450]
        - id: Branch_Valid_End
          type: Branch
          position: [500, 500]
        - id: ShowFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [700, 500]
        - id: EnableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1000, 500]
        # Remove weapon from player
        - id: GetWeaponRef_End
          type: VariableGet
          properties:
            variable_name: WeaponRef
          position: [300, 650]
        - id: GetPlayerEnd
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [600, 650]
        - id: GetInventoryEnd
          type: CallFunction
          properties:
            function: GetComponentByClass
            class: Actor
            component_class: NarrativeInventoryComponent
          position: [900, 650]
        - id: CastToInventoryEnd
          type: DynamicCast
          properties:
            target_class: NarrativeInventoryComponent
          position: [1200, 650]
        - id: RemoveWeapon
          type: CallFunction
          properties:
            function: RemoveItem
          position: [1500, 650]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [HideFather, Exec]
        - from: [HideFather, Exec]
          to: [DisableCollision, Exec]
        - from: [DisableCollision, Exec]
          to: [GetInventory, Exec]
        - from: [GetInventory, Exec]
          to: [CastToInventory, Exec]
        - from: [CastToInventory, Exec]
          to: [TryAddWeapon, Exec]
        - from: [TryAddWeapon, Exec]
          to: [CastToWeapon, Exec]
        - from: [CastToWeapon, Exec]
          to: [SetWeaponRef, Exec]
        - from: [SetWeaponRef, Exec]
          to: [WieldWeapon, Exec]
        - from: [WieldWeapon, Exec]
          to: [EndAbility_Success, Exec]
        # Data flow - Activation
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [SetFatherRef, FatherRef]
          to: [HideFather, Target]
        - from: [SetFatherRef, FatherRef]
          to: [DisableCollision, Target]
        - from: [SetFatherRef, FatherRef]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetInventory, Target]
        - from: [GetInventory, ReturnValue]
          to: [CastToInventory, Object]
        - from: [CastToInventory, AsNarrative Inventory]
          to: [TryAddWeapon, Target]
        - from: [TryAddWeapon, ReturnValue]
          to: [BreakItemResult, ItemAddResult]
        - from: [BreakItemResult, Stacks]
          to: [GetFirstStack, Array]
        - from: [GetFirstStack, Output]
          to: [CastToWeapon, Object]
        - from: [CastToWeapon, AsWeapon Item]
          to: [SetWeaponRef, WeaponRef]
        - from: [SetWeaponRef, WeaponRef]
          to: [WieldWeapon, Target]
        # === END ABILITY FLOW ===
        # v4.14: Route through guard (GAS Audit MED-5)
        - from: [Event_EndAbility, Then]
          to: [Branch_Valid_End, Exec]
        - from: [Branch_Valid_End, True]
          to: [ShowFather, Exec]
        - from: [ShowFather, Exec]
          to: [EnableCollision, Exec]
        - from: [EnableCollision, Exec]
          to: [GetInventoryEnd, Exec]
        - from: [GetInventoryEnd, Exec]
          to: [CastToInventoryEnd, Exec]
        - from: [CastToInventoryEnd, Exec]
          to: [RemoveWeapon, Exec]
        # Guard data flow (GAS Audit MED-5)
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_FatherRef_End, Object]
        - from: [IsValid_FatherRef_End, ReturnValue]
          to: [Branch_Valid_End, Condition]
        # Data flow - End
        - from: [GetFatherRef_End, FatherRef]
          to: [ShowFather, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [EnableCollision, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [GetPlayerEnd, Target]
        - from: [GetPlayerEnd, OwnerPlayer]
          to: [GetInventoryEnd, Target]
        - from: [GetInventoryEnd, ReturnValue]
          to: [CastToInventoryEnd, Object]
        - from: [CastToInventoryEnd, AsNarrative Inventory]
          to: [RemoveWeapon, Target]
        - from: [GetWeaponRef_End, WeaponRef]
          to: [RemoveWeapon, Item]

  # GA_FatherSword - Sword Weapon Form (NPC-owned form ability)
  # v2.7.0: Full Narrative Pro item flow with BreakStruct/GetArrayItem
  # NOTE: Uses placeholder class NarrativeItem until EI_FatherSwordWeapon is generated
  - name: GA_FatherSword
    folder: Abilities/Forms
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    tags:
      ability_tags:
        - Ability.Father.Sword
      cancel_abilities_with_tag:
        - Ability.Father.Crawler
        - Ability.Father.Armor
        - Ability.Father.Exoskeleton
        - Ability.Father.Symbiote
        - Ability.Father.Engineer
        - Ability.Father.Rifle
      activation_owned_tags:
        - Father.Form.Sword
        - Father.State.Wielded
      activation_required_tags:
        - Father.State.Recruited
      activation_blocked_tags:
        - Father.Form.Sword
        - Father.State.Transitioning
    variables:
      - name: FatherRef
        type: Object
        class: BP_FatherCompanion
      - name: WeaponRef
        type: Object
        class: WeaponItem
    event_graph:
      nodes:
        # === ACTIVATION NODES ===
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: GetAvatarActor
          type: CallFunction
          properties:
            function: GetAvatarActorFromActorInfo
            target_self: true
          position: [300, 0]
        - id: CastToFather
          type: DynamicCast
          properties:
            target_class: BP_FatherCompanion
          position: [600, 0]
        - id: SetFatherRef
          type: VariableSet
          properties:
            variable_name: FatherRef
          position: [900, 0]
        - id: HideFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [1200, 0]
        - id: DisableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1500, 0]
        # Get player and inventory
        - id: GetOwnerPlayer
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [1200, 150]
        - id: GetInventory
          type: CallFunction
          properties:
            function: GetComponentByClass
            class: Actor
            component_class: NarrativeInventoryComponent
          position: [1500, 150]
        - id: CastToInventory
          type: DynamicCast
          properties:
            target_class: NarrativeInventoryComponent
          position: [1800, 150]
        # Add weapon item to player inventory
        - id: TryAddWeapon
          type: CallFunction
          properties:
            function: TryAddItemFromClass
            class: NarrativeInventoryComponent
            # TODO: item_class should be EI_FatherSwordWeapon after first generation
            item_class: NarrativeItem
            quantity: 1
          position: [2100, 150]
        # Break FItemAddResult struct to get Stacks array
        - id: BreakItemResult
          type: BreakStruct
          properties:
            struct_type: FItemAddResult
          position: [2400, 150]
        # Get first item from Stacks array (index 0)
        - id: GetFirstStack
          type: GetArrayItem
          properties:
            index: 0
          position: [2700, 150]
        # Cast to WeaponItem and wield
        - id: CastToWeapon
          type: DynamicCast
          properties:
            target_class: WeaponItem
          position: [3000, 150]
        - id: SetWeaponRef
          type: VariableSet
          properties:
            variable_name: WeaponRef
          position: [3300, 150]
        - id: WieldWeapon
          type: CallFunction
          properties:
            function: WieldInSlot
            slot_tag: Narrative.Equipment.WieldSlot.MainHand
          position: [3600, 150]
        - id: EndAbility_Success
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [3900, 150]
        # === END ABILITY NODES ===
        - id: Event_EndAbility
          type: Event
          properties:
            event_name: K2_OnEndAbility
          position: [0, 500]
        - id: GetFatherRef_End
          type: VariableGet
          properties:
            variable_name: FatherRef
          position: [300, 500]
        # === GUARDS (GAS Audit MED-6) ===
        - id: IsValid_FatherRef_End
          type: CallFunction
          properties:
            function: IsValid
            class: KismetSystemLibrary
          position: [400, 450]
        - id: Branch_Valid_End
          type: Branch
          position: [500, 500]
        - id: ShowFather
          type: CallFunction
          properties:
            function: SetActorHiddenInGame
          position: [700, 500]
        - id: EnableCollision
          type: CallFunction
          properties:
            function: SetActorEnableCollision
          position: [1000, 500]
        # Remove weapon from player
        - id: GetWeaponRef_End
          type: VariableGet
          properties:
            variable_name: WeaponRef
          position: [300, 650]
        - id: GetPlayerEnd
          type: PropertyGet
          properties:
            property_name: OwnerPlayer
            target_class: BP_FatherCompanion
          position: [600, 650]
        - id: GetInventoryEnd
          type: CallFunction
          properties:
            function: GetComponentByClass
            class: Actor
            component_class: NarrativeInventoryComponent
          position: [900, 650]
        - id: CastToInventoryEnd
          type: DynamicCast
          properties:
            target_class: NarrativeInventoryComponent
          position: [1200, 650]
        - id: RemoveWeapon
          type: CallFunction
          properties:
            function: RemoveItem
          position: [1500, 650]
      connections:
        # === ACTIVATION FLOW ===
        # Exec flow (GetAvatarActor is pure - no exec pins)
        - from: [Event_Activate, Then]
          to: [CastToFather, Exec]
        - from: [CastToFather, Exec]
          to: [SetFatherRef, Exec]
        - from: [SetFatherRef, Exec]
          to: [HideFather, Exec]
        - from: [HideFather, Exec]
          to: [DisableCollision, Exec]
        - from: [DisableCollision, Exec]
          to: [GetInventory, Exec]
        - from: [GetInventory, Exec]
          to: [CastToInventory, Exec]
        - from: [CastToInventory, Exec]
          to: [TryAddWeapon, Exec]
        - from: [TryAddWeapon, Exec]
          to: [CastToWeapon, Exec]
        - from: [CastToWeapon, Exec]
          to: [SetWeaponRef, Exec]
        - from: [SetWeaponRef, Exec]
          to: [WieldWeapon, Exec]
        - from: [WieldWeapon, Exec]
          to: [EndAbility_Success, Exec]
        # Data flow - Activation
        - from: [GetAvatarActor, ReturnValue]
          to: [CastToFather, Object]
        - from: [CastToFather, AsBP_FatherCompanion]
          to: [SetFatherRef, FatherRef]
        - from: [SetFatherRef, FatherRef]
          to: [HideFather, Target]
        - from: [SetFatherRef, FatherRef]
          to: [DisableCollision, Target]
        - from: [SetFatherRef, FatherRef]
          to: [GetOwnerPlayer, Target]
        - from: [GetOwnerPlayer, OwnerPlayer]
          to: [GetInventory, Target]
        - from: [GetInventory, ReturnValue]
          to: [CastToInventory, Object]
        - from: [CastToInventory, AsNarrative Inventory]
          to: [TryAddWeapon, Target]
        - from: [TryAddWeapon, ReturnValue]
          to: [BreakItemResult, ItemAddResult]
        - from: [BreakItemResult, Stacks]
          to: [GetFirstStack, Array]
        - from: [GetFirstStack, Output]
          to: [CastToWeapon, Object]
        - from: [CastToWeapon, AsWeapon Item]
          to: [SetWeaponRef, WeaponRef]
        - from: [SetWeaponRef, WeaponRef]
          to: [WieldWeapon, Target]
        # === END ABILITY FLOW ===
        # v4.14: Route through guard (GAS Audit MED-6)
        - from: [Event_EndAbility, Then]
          to: [Branch_Valid_End, Exec]
        - from: [Branch_Valid_End, True]
          to: [ShowFather, Exec]
        - from: [ShowFather, Exec]
          to: [EnableCollision, Exec]
        - from: [EnableCollision, Exec]
          to: [GetInventoryEnd, Exec]
        - from: [GetInventoryEnd, Exec]
          to: [CastToInventoryEnd, Exec]
        - from: [CastToInventoryEnd, Exec]
          to: [RemoveWeapon, Exec]
        # Guard data flow (GAS Audit MED-6)
        - from: [GetFatherRef_End, FatherRef]
          to: [IsValid_FatherRef_End, Object]
        - from: [IsValid_FatherRef_End, ReturnValue]
          to: [Branch_Valid_End, Condition]
        # Data flow - End
        - from: [GetFatherRef_End, FatherRef]
          to: [ShowFather, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [EnableCollision, Target]
        - from: [GetFatherRef_End, FatherRef]
          to: [GetPlayerEnd, Target]
        - from: [GetPlayerEnd, OwnerPlayer]
          to: [GetInventoryEnd, Target]
        - from: [GetInventoryEnd, ReturnValue]
          to: [CastToInventoryEnd, Object]
        - from: [CastToInventoryEnd, AsNarrative Inventory]
          to: [RemoveWeapon, Target]
        - from: [GetWeaponRef_End, WeaponRef]
          to: [RemoveWeapon, Item]

# ============================================================================
# EQUIPPABLE ITEMS (7) - Attached forms (3) + Weapons (2) + Rifle/Sword forms (2)
# ============================================================================
equippable_items:
  # Per Tech Doc Section 58.5, 58.10, 58.11: Dual Entry System + Activities to Grant
  # NOTE: Crawler/Engineer do NOT have EquippableItems - activated via GAS directly (Option B)
  # Only attached forms (Armor, Exoskeleton, Symbiote) and weapons (Rifle, Sword) use equipment

  - name: EI_FatherArmorForm
    folder: Items/Forms
    parent_class: EquippableItem
    equipment_slot: Narrative.Equipment.Slot.FatherForm
    abilities_to_grant:
      - GA_FatherArmor
      - GA_ProtectiveDome
      - GA_DomeBurst
    equipment_modifier_ge: GE_EquipmentModifier_FatherArmor
    # Per Section 58.5: Armor +50
    equipment_effect_values:
      SetByCaller.Armor: 50.0
      SetByCaller.AttackRating: 0.0
      SetByCaller.StealthRating: 0.0
    armor_rating: 50.0
    attack_rating: 0.0
    stealth_rating: 0.0
    # v4.27 NOTE: Form exit burst (Decisions 22-24) is implemented in GA_ProtectiveDome's EndAbility event.
    # When armor form is unequipped, GA_ProtectiveDome ends and tries to activate GA_DomeBurst.
    # GA_DomeBurst requires Father.Dome.FullyCharged tag, so it only fires if dome was fully charged.

  - name: EI_FatherExoskeletonForm
    folder: Items/Forms
    parent_class: EquippableItem
    equipment_slot: Narrative.Equipment.Slot.FatherForm
    # v4.26 (Decision 4): Removed GA_Backstab - universal ability, add to player's Default Abilities array
    abilities_to_grant:
      - GA_FatherExoskeleton
      - GA_FatherExoskeletonDash
      - GA_FatherExoskeletonSprint
      - GA_StealthField
    equipment_modifier_ge: GE_EquipmentModifier_FatherExoskeleton
    # Per Section 58.5: AttackRating +10 (speed/jump via CharacterMovement)
    equipment_effect_values:
      SetByCaller.Armor: 0.0
      SetByCaller.AttackRating: 10.0
      SetByCaller.StealthRating: 0.0
    armor_rating: 0.0
    attack_rating: 10.0
    stealth_rating: 0.0

  - name: EI_FatherSymbioteForm
    folder: Items/Forms
    parent_class: EquippableItem
    equipment_slot: Narrative.Equipment.Slot.FatherForm
    abilities_to_grant:
      - GA_FatherSymbiote
      - GA_ProximityStrike
    equipment_modifier_ge: GE_EquipmentModifier_FatherSymbiote
    # Per Section 58.5: AttackRating +100
    equipment_effect_values:
      SetByCaller.Armor: 0.0
      SetByCaller.AttackRating: 100.0
      SetByCaller.StealthRating: 0.0
    armor_rating: 0.0
    attack_rating: 100.0
    stealth_rating: 0.0

  - name: EI_FatherRifleForm
    folder: Items/Forms
    parent_class: EquippableItem
    equipment_slot: Narrative.Equipment.Slot.FatherForm
    abilities_to_grant:
      - GA_FatherRifle
    equipment_modifier_ge: GE_EquipmentModifier_FatherRifle
    equipment_effect_values:
      SetByCaller.Armor: 0.0
      SetByCaller.AttackRating: 15.0
      SetByCaller.StealthRating: 0.0
    armor_rating: 0.0
    attack_rating: 15.0
    stealth_rating: 0.0

  - name: EI_FatherSwordForm
    folder: Items/Forms
    parent_class: EquippableItem
    equipment_slot: Narrative.Equipment.Slot.FatherForm
    abilities_to_grant:
      - GA_FatherSword
    equipment_modifier_ge: GE_EquipmentModifier_FatherSword
    equipment_effect_values:
      SetByCaller.Armor: 0.0
      SetByCaller.AttackRating: 25.0
      SetByCaller.StealthRating: 0.0
    armor_rating: 0.0
    attack_rating: 25.0
    stealth_rating: 0.0

  # Weapon Items - use Narrative Pro weapon classes (v2.6.8)
  # v3.9.7: Fixed prefix from BP_ to EI_ (RangedWeaponItem/MeleeWeaponItem are UObject data assets, not Actors)
  - name: EI_FatherRifleWeapon
    folder: FatherCompanion/Weapons
    parent_class: RangedWeaponItem
    display_name: Father Rifle
    description: Transform your father companion into a bio-organic rifle. Fires high-energy projectiles with precision accuracy.
    equipment_slot: Narrative.Equipment.Slot.Weapon_Back
    # v4.15: Weapon properties
    weapon_hand: TwoHanded
    attack_damage: 10.0
    clip_size: 30
    allow_manual_reload: true
    bot_attack_range: 2000.0

  - name: EI_FatherSwordWeapon
    folder: FatherCompanion/Weapons
    parent_class: MeleeWeaponItem
    display_name: Father Sword
    description: Transform your father companion into a bio-organic blade. Devastating melee attacks with increased reach.
    equipment_slot: Narrative.Equipment.Slot.Weapon_Back

# ============================================================================
# BLACKBOARDS (2)
# ============================================================================
blackboards:
  - name: BB_FatherCompanion
    folder: AI/Blackboards
    keys:
      - key_name: SelfActor
        key_type: Object
        base_class: Actor
      - key_name: OwnerPlayer
        key_type: Object
        base_class: NarrativePlayerCharacter
      - key_name: TargetPlayer
        key_type: Object
        base_class: NarrativePlayerCharacter
      - key_name: AttackTarget
        key_type: Object
        base_class: Actor
      - key_name: CurrentTarget
        key_type: Object
        base_class: Actor
      - key_name: FollowDistance
        key_type: Float
        default_value: 300.0
      - key_name: AttackRange
        key_type: Float
        default_value: 200.0
      - key_name: IsInCombat
        key_type: Bool
      - key_name: CurrentForm
        key_type: Enum
        enum_type: E_FatherForm
      - key_name: HomeLocation
        key_type: Vector
      - key_name: TargetLocation
        key_type: Vector
      - key_name: MarkTarget
        key_type: Object
        base_class: Actor

  - name: BB_FatherEngineer
    folder: AI/Blackboards
    keys:
      - key_name: SelfActor
        key_type: Object
        base_class: Actor
      - key_name: TurretLocation
        key_type: Vector
      - key_name: AttackTarget
        key_type: Object
        base_class: Actor
      - key_name: CurrentTarget
        key_type: Object
        base_class: Actor
      - key_name: TrapTarget
        key_type: Object
        base_class: Actor
      - key_name: IsActive
        key_type: Bool

# ============================================================================
# BEHAVIOR TREES (2)
# ============================================================================
behavior_trees:
  - name: BT_FatherFollow
    folder: AI/BehaviorTrees
    blackboard: BB_FatherCompanion
    root_type: Selector
    description: Main father companion AI for following and combat
    nodes:
      # Root Selector - Chooses between combat and follow behaviors
      - id: root_selector
        type: Selector
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: TargetPlayer
            key_query: IsSet
            flow_abort_mode: Both
        children:
          - combat_sequence
          - follow_sequence
      # Combat Sequence - Attack if enemy detected
      - id: combat_sequence
        type: Sequence
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: AttackTarget
            key_query: IsSet
        children:
          - move_to_enemy
      - id: move_to_enemy
        type: Task
        task_class: BTTask_MoveTo
        blackboard_key: AttackTarget
        properties:
          AcceptableRadius: "100.0"
      # Follow Sequence - Follow player when no combat
      - id: follow_sequence
        type: Sequence
        children:
          - move_to_player
      - id: move_to_player
        type: Task
        task_class: BTTask_MoveTo
        blackboard_key: TargetPlayer
        properties:
          AcceptableRadius: "200.0"

  - name: BT_FatherEngineer
    folder: AI/BehaviorTrees
    blackboard: BB_FatherEngineer
    root_type: Selector
    description: Engineer turret mode AI for automated combat
    nodes:
      # Root Selector - Turret mode selects targets
      - id: root_selector
        type: Selector
        children:
          - attack_sequence
          - idle_wait
      # Attack Sequence - Shoot at detected targets
      - id: attack_sequence
        type: Sequence
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: AttackTarget
            key_query: IsSet
        services:
          - class: BTS_SetAIFocus
            interval: 0.5
        children:
          - turret_wait
      - id: turret_wait
        type: Task
        task_class: BTTask_Wait
        properties:
          WaitTime: "1.0"
      # Idle - Wait when no targets
      - id: idle_wait
        type: Task
        task_class: BTTask_Wait
        properties:
          WaitTime: "0.5"

# ============================================================================
# ACTIVITIES (1)
# ============================================================================
activities:
  - name: BPA_FatherFollow
    folder: AI/Activities
    parent_class: NarrativeActivityBase
    behavior_tree: BT_FatherFollow

# ============================================================================
# ABILITY CONFIGURATIONS (1)
# ============================================================================
ability_configurations:
  # Per Tech Doc Section 57.7: AC_FatherCompanion_Default pattern (matches AC_NPC_Default)
  # Option B: startup_effects applies default form state at spawn
  - name: AC_FatherCompanion
    folder: Configs
    abilities:
      # Form abilities (5 forms)
      - GA_FatherCrawler
      - GA_FatherArmor
      - GA_FatherExoskeleton
      - GA_FatherSymbiote
      - GA_FatherEngineer
      # AI abilities - Crawler mode
      - GA_FatherAttack
      - GA_FatherLaserShot
      # AI abilities - Engineer mode (baseline, not equipment-granted)
      - GA_TurretShoot
      - GA_FatherElectricTrap
      # Passive/utility abilities
      - GA_FatherMark
      - GA_FatherSacrifice
      - GA_Death  # Per Tech Doc Section 57.1: "Same as AC_NPC_Default - ADD THIS"
    startup_effects:
      - GE_CrawlerState  # Default form state at spawn (Option B)

# ============================================================================
# ACTIVITY CONFIGURATIONS (1)
# ============================================================================
activity_configurations:
  # Per Tech Doc Section 57.8: AC_FatherBehavior pattern (matches AC_RunAndGun)
  - name: AC_FatherBehavior
    folder: Configs
    default_activity: BPA_FatherFollow
    request_interval: 0.5
    activities:
      - BPA_Attack_Melee              # Crawler melee combat (Narrative Pro built-in)
      - BPA_Attack_Ranged_Strafe      # Laser shot - mobile strafing (Narrative Pro built-in)
      - BPA_Attack_Ranged             # Turret shoot - stationary ranged (Narrative Pro built-in)
      - BPA_FollowCharacter           # Follow player (Narrative Pro built-in)
      - BPA_Idle                      # Default idle (Narrative Pro built-in)
      - BPA_FatherFollow              # Custom father follow (Section 55.15)
    goal_generators:
      - GoalGenerator_Attack          # Auto-target hostiles (Section 57.9)

# ============================================================================
# NPC DEFINITIONS (1)
# ============================================================================
npc_definitions:
  - name: NPC_FatherCompanion
    folder: Configs
    npc_name: Father
    npc_blueprint: BP_FatherCompanion
    ability_configuration: AC_FatherCompanion
    activity_configuration: AC_FatherBehavior
    default_factions:
      - Narrative.Factions.FatherCompanion
      - Narrative.Factions.Player

# ============================================================================
# CHARACTER DEFINITIONS (1)
# ============================================================================
character_definitions:
  - name: CD_FatherCompanion
    folder: Configs
    display_name: Father Companion
    npc_definition: NPC_FatherCompanion

# ============================================================================
# ITEM COLLECTIONS (1)
# ============================================================================
item_collections:
  - name: IC_FatherForms
    folder: Items
    # NOTE: Only forms with EquippableItems (attached forms + weapons)
    # Crawler/Engineer activate via GAS directly - no equipment needed
    items:
      - item: EI_FatherArmorForm
        quantity: 1
      - item: EI_FatherExoskeletonForm
        quantity: 1
      - item: EI_FatherSymbioteForm
        quantity: 1
      - item: EI_FatherRifleForm
        quantity: 1
      - item: EI_FatherSwordForm
        quantity: 1

# ============================================================================
# NARRATIVE EVENTS (2)
# ============================================================================
narrative_events:
  - name: NE_FatherRecruited
    folder: Events
    parent_class: NarrativeEvent
    event_tag: GameplayEvent.Father.Reactivated

  - name: NE_FatherSacrificed
    folder: Events
    parent_class: NarrativeEvent
    event_tag: GameplayEvent.Father.Sacrificed

# ============================================================================
# ACTOR BLUEPRINTS (4) - Characters (1) + Projectiles (2) + Traps (1)
# ============================================================================
actor_blueprints:
  - name: BP_FatherCompanion
    folder: Characters
    parent_class: NarrativeNPCCharacter
    components:
      - name: AbilitySystemComponent
        type: NarrativeAbilitySystemComponent
      - name: EquipmentComponent
        type: EquipmentComponent
      - name: InteractionComponent
        type: NPCInteractionComponent
    variables:
      - name: OwnerPlayer
        type: NarrativePlayerCharacter
        replicated: true
      - name: CurrentForm
        type: E_FatherForm
        default: Crawler
        replicated: true
      - name: IsAttached
        type: Bool
        default: false
        replicated: true
      - name: DomeEnergy
        type: Float
        default: 0.0
        replicated: true
      - name: SymbioteCharge
        type: Float
        default: 0.0
        replicated: true
      - name: IsDeployed
        type: Bool
        default: false
        replicated: true
    event_graph:
      nodes:
        # BeginPlay - Spawn companion VFX
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: SelfRef
          type: Self
          position: [200, 100]
        - id: GetMesh
          type: PropertyGet
          properties:
            property_name: Mesh
            target_class: Character
          position: [400, 0]
        - id: SpawnCompanionVFX
          type: CallFunction
          properties:
            function: SpawnSystemAttached
            class: NiagaraFunctionLibrary
          position: [700, 0]
        # EndPlay - Safety net cleanup
        - id: Event_EndPlay
          type: Event
          properties:
            event_name: ReceiveEndPlay
          position: [0, 400]
        - id: PrintCleanup
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
          position: [300, 400]
      connections:
        # BeginPlay flow - Self -> GetMesh -> SpawnVFX
        - from: [Event_BeginPlay, Then]
          to: [SpawnCompanionVFX, Exec]
        - from: [SelfRef, Self]
          to: [GetMesh, Target]
        - from: [GetMesh, Mesh]
          to: [SpawnCompanionVFX, AttachToComponent]
        # EndPlay flow
        - from: [Event_EndPlay, Then]
          to: [PrintCleanup, Exec]

  - name: BP_LaserProjectile
    folder: Projectiles
    parent_class: NarrativeProjectile
    variables:
      - name: Damage
        type: Float
        default: 25.0
      - name: Speed
        type: Float
        default: 5000.0

  - name: BP_TurretProjectile
    folder: Projectiles
    parent_class: NarrativeProjectile
    variables:
      - name: Damage
        type: Float
        default: 15.0
      - name: Speed
        type: Float
        default: 3000.0

  - name: BP_ElectricTrap
    folder: Traps
    parent_class: Actor
    components:
      - name: TriggerSphere
        type: SphereComponent
        radius: 150.0
      - name: TrapMesh
        type: StaticMeshComponent
    variables:
      - name: Damage
        type: Float
        default: 30.0
      - name: RootDuration
        type: Float
        default: 3.0
      - name: Lifetime
        type: Float
        default: 15.0

# ============================================================================
# WIDGET BLUEPRINTS (3)
# ============================================================================
widget_blueprints:
  - name: WBP_MarkIndicator
    folder: UI
    parent_class: UserWidget
    variables:
      - name: TargetActor
        type: Actor
        instance_editable: true
      - name: MarkDuration
        type: Float
        default: 5.0

  - name: WBP_UltimatePanel
    folder: UI
    parent_class: UserWidget
    variables:
      - name: CurrentCharge
        type: Float
        default: 0.0
        instance_editable: true
      - name: MaxCharge
        type: Float
        default: 100.0
    # v4.3: Widget tree layout automation - creates full widget hierarchy
    widget_tree:
      root_widget: RootCanvas
      widgets:
        - id: RootCanvas
          type: CanvasPanel
          name: RootCanvas
          children: [ContentBox]
        - id: ContentBox
          type: VerticalBox
          name: ContentBox
          is_variable: true
          slot:
            anchors: BottomCenter
            alignment: "0.5, 1.0"
            position: "0, -50"
          children: [ChargeLabel, ChargeBar]
        - id: ChargeLabel
          type: TextBlock
          name: UltimateLabel
          text: "ULTIMATE"
          slot:
            h_align: Center
            v_align: Center
          properties:
            Font.Size: 18
            ColorAndOpacity: "(R=1.0, G=0.8, B=0.2, A=1.0)"
        - id: ChargeBar
          type: ProgressBar
          name: ChargeProgressBar
          is_variable: true
          slot:
            h_align: Fill
            size_rule: Fill
            padding: "10, 5, 10, 5"
          properties:
            BarFillType: LeftToRight
            Percent: 0.0
            FillColorAndOpacity: "(R=1.0, G=0.6, B=0.0, A=1.0)"

  - name: WBP_FormWheel
    folder: UI
    parent_class: UserWidget
    variables:
      - name: SelectedSlot
        type: Int
        default: 0
      - name: IsOpen
        type: Bool
        default: false
    # v4.10: Widget tree for radial form selection wheel
    # Layout per System Design Document Section 5.2:
    # Armor (top), Symbiote (left), Engineer (right), Exoskeleton (bottom-left), Crawler (bottom-right)
    widget_tree:
      root_widget: RootCanvas
      widgets:
        - id: RootCanvas
          type: CanvasPanel
          name: RootCanvas
          children: [WheelBackground, Slot_Armor, Slot_Symbiote, Slot_Engineer, Slot_Exoskeleton, Slot_Crawler, CenterIcon, SelectionIndicator]
        - id: WheelBackground
          type: Image
          name: WheelBackground
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "0, 0"
            size: "400, 400"
          properties:
            ColorAndOpacity: "(R=0.02, G=0.02, B=0.05, A=0.85)"
        - id: Slot_Armor
          type: Button
          name: Slot_Armor
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "0, -120"
            size: "70, 70"
        - id: Slot_Symbiote
          type: Button
          name: Slot_Symbiote
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "-120, 0"
            size: "70, 70"
        - id: Slot_Engineer
          type: Button
          name: Slot_Engineer
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "120, 0"
            size: "70, 70"
        - id: Slot_Exoskeleton
          type: Button
          name: Slot_Exoskeleton
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "-74, 97"
            size: "70, 70"
        - id: Slot_Crawler
          type: Button
          name: Slot_Crawler
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "74, 97"
            size: "70, 70"
        - id: CenterIcon
          type: Image
          name: CenterIcon
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "0, 0"
            size: "80, 80"
          properties:
            ColorAndOpacity: "(R=1.0, G=0.8, B=0.4, A=1.0)"
        - id: SelectionIndicator
          type: Image
          name: SelectionIndicator
          is_variable: true
          slot:
            anchors: Center
            alignment: "0.5, 0.5"
            position: "0, 0"
            size: "70, 70"
          properties:
            ColorAndOpacity: "(R=1.0, G=0.6, B=0.0, A=0.0)"

# ============================================================================
# NIAGARA SYSTEMS (7) - v2.6.11 Enhanced with user parameters
# ============================================================================
# v2.9.0: Niagara Systems now support data-driven FX architecture
# Two modes:
#   1. user_parameters: - Define custom User.* params (current method)
#   2. fx_descriptor: + template_system: - Use template duplication with standard params
#
# For fx_descriptor mode, artist must first create NS_FatherFXTemplate with Uber-Emitters
# See: guides/Niagara_Uber_Emitter_Setup_Guide_v1_0.md
# ============================================================================

# ============================================================================
# FX PRESETS (v4.9) - Reusable VFX parameter configurations with inheritance
# ============================================================================
fx_presets:
  # Base preset for all Father VFX - common parameters
  - name: FX_FatherBase
    folder: VFX/Presets
    parameters:
      SpawnRate: "50.0"
      ParticleLifetime: "2.0"
      BaseColor: "(0.8, 0.6, 0.2, 1.0)"
      EmissiveIntensity: "3.0"

  # Energy burst preset - inherits from base, overrides for burst effects
  - name: FX_EnergyBurst
    folder: VFX/Presets
    base_preset: FX_FatherBase
    parameters:
      SpawnRate: "200.0"
      ParticleLifetime: "0.5"
      EmissiveIntensity: "8.0"

  # Ambient glow preset - inherits from base, lower intensity for ambient
  - name: FX_AmbientGlow
    folder: VFX/Presets
    base_preset: FX_FatherBase
    parameters:
      SpawnRate: "25.0"
      ParticleLifetime: "4.0"
      EmissiveIntensity: "2.0"

  # Laser/beam preset - high intensity, short lifetime
  - name: FX_LaserBeam
    folder: VFX/Presets
    parameters:
      SpawnRate: "100.0"
      ParticleLifetime: "0.2"
      BaseColor: "(1.0, 0.3, 0.1, 1.0)"
      EmissiveIntensity: "15.0"
      BeamWidth: "5.0"

  # Electric/trap preset - blue-white sparks
  - name: FX_Electric
    folder: VFX/Presets
    parameters:
      SpawnRate: "150.0"
      ParticleLifetime: "0.3"
      BaseColor: "(0.4, 0.7, 1.0, 1.0)"
      EmissiveIntensity: "10.0"
      SparkIntensity: "5.0"

niagara_systems:
  # v4.11 NOTE: From-scratch Niagara systems (no template_system) require editor mode with
  # real RHI to generate. Headless -nullrhi mode only supports template-based systems.
  # To test template-based generation, use:
  #   template_system: "/Niagara/DefaultAssets/Templates/Systems/MinimalLightweight.MinimalLightweight"

  # Main Father companion floating energy orb VFX
  # Composed of: NE_FatherCore, NE_FatherShell, NE_FatherParticles, NE_FatherAura, NE_FatherTrail
  - name: NS_FatherCompanion
    folder: VFX
    effect_type: ambient
    preset: FX_AmbientGlow  # v4.9: FX Preset reference
    fixed_bounds: true
    bounds_min: -100, -100, -100
    bounds_max: 100, 100, 100
    warmup_time: 0.0
    pooling: AutoRelease
    max_pool_size: 5
    # v4.9: LOD/Scalability settings
    cull_distance_low: 500
    cull_distance_medium: 1000
    cull_distance_high: 2000
    cull_distance_epic: 5000
    cull_distance_cinematic: 0
    cull_max_distance: 10000
    significance_distance: 1500
    max_particle_budget: 500
    scalability_mode: Self
    allow_culling_for_local_players: false
    user_parameters:
      - name: CoreScale
        type: float
        default: 1.0
      - name: ShellScale
        type: float
        default: 1.0
      - name: ParticleSpawnRate
        type: float
        default: 15.0
      - name: AlertLevel
        type: float
        default: 0.0
      - name: EmotionColor
        type: linear_color
        default: 1.0, 0.8, 0.4, 1.0
    # v4.9: Per-emitter parameter overrides
    # NOTE: emitter_overrides requires template_system or emitters: array to provide the emitters
    # These overrides reference emitters that would exist in a custom template system.
    # Commented out until a proper template is created with CoreEmitter/ShellEmitter/TrailEmitter.
    # emitter_overrides:
    #   - emitter: CoreEmitter
    #     enabled: true
    #     parameters:
    #       CoreGlowIntensity: "5.0"
    #       CorePulseRate: "1.5"
    #   - emitter: ShellEmitter
    #     enabled: true
    #     parameters:
    #       ShellOpacity: "0.3"
    #   - emitter: TrailEmitter
    #     enabled: false  # Disable trail in base config

  # Form transition burst VFX - used during 5s form change animation
  - name: NS_FatherFormTransition
    folder: VFX
    effect_type: burst
    preset: FX_EnergyBurst  # v4.9: FX Preset reference
    warmup_time: 0.0
    pooling: AutoRelease
    max_pool_size: 3
    # v4.9: LOD settings for burst effects
    cull_distance_low: 1000
    cull_distance_medium: 2000
    cull_distance_high: 4000
    max_particle_budget: 1000
    user_parameters:
      - name: TransitionIntensity
        type: float
        default: 1.0
      - name: BurstColor
        type: linear_color
        default: 0.5, 0.8, 1.0, 1.0

  # Laser beam VFX for GA_FatherLaserShot
  - name: NS_LaserBeam
    folder: VFX
    effect_type: beam
    preset: FX_LaserBeam  # v4.9: FX Preset reference
    determinism: true
    random_seed: 42
    fixed_bounds: true
    bounds_min: -500, -50, -50
    bounds_max: 500, 50, 50
    # v4.9: LOD for beam effects
    cull_distance_low: 2000
    cull_distance_high: 5000
    max_particle_budget: 200
    user_parameters:
      - name: BeamWidth
        type: float
        default: 5.0
      - name: BeamLength
        type: float
        default: 1500.0
      - name: BeamColor
        type: linear_color
        default: 1.0, 0.2, 0.2, 1.0
      - name: BeamIntensity
        type: float
        default: 10.0

  # Electric trap VFX for GA_FatherElectricTrap
  - name: NS_ElectricTrap
    folder: VFX
    effect_type: ambient
    preset: FX_Electric  # v4.9: FX Preset reference
    fixed_bounds: true
    bounds_min: -200, -200, -50
    bounds_max: 200, 200, 50
    warmup_time: 0.5
    # v4.9: LOD for trap effects
    cull_distance_low: 1500
    cull_distance_high: 4000
    max_particle_budget: 300
    user_parameters:
      - name: TrapRadius
        type: float
        default: 150.0
      - name: ArcCount
        type: int
        default: 8
      - name: ElectricColor
        type: linear_color
        default: 0.3, 0.6, 1.0, 1.0
      - name: ArcIntensity
        type: float
        default: 5.0
    # NOTE: emitter_overrides require template_system - commented out until custom template exists
    # emitter_overrides:
    #   - emitter: ArcEmitter
    #     enabled: true
    #     parameters:
    #       ArcFrequency: "10.0"
    #       ArcJitter: "2.0"

  # Dome shield VFX for GA_ProtectiveDome (spherical particle shield)
  - name: NS_DomeShield
    folder: VFX
    effect_type: ambient
    fixed_bounds: true
    bounds_min: -300, -300, -300
    bounds_max: 300, 300, 300
    user_parameters:
      - name: DomeRadius
        type: float
        default: 250.0
      - name: ShieldOpacity
        type: float
        default: 0.5
      - name: ShieldColor
        type: linear_color
        default: 0.2, 0.6, 1.0, 0.8
      - name: PulseSpeed
        type: float
        default: 1.0

  # Dome burst VFX for GA_DomeBurst (expansion ring burst effect)
  - name: NS_DomeBurst
    folder: VFX
    effect_type: burst
    pooling: AutoRelease
    max_pool_size: 5
    user_parameters:
      - name: BurstRadius
        type: float
        default: 500.0
      - name: BurstSpeed
        type: float
        default: 1000.0
      - name: BurstColor
        type: linear_color
        default: 1.0, 0.8, 0.2, 1.0
      - name: BurstDamageIntensity
        type: float
        default: 1.0

  # Legacy dome VFX (renamed for clarity)
  - name: NS_ProtectiveDome
    folder: VFX
    effect_type: ambient
    fixed_bounds: true
    bounds_min: -300, -300, -300
    bounds_max: 300, 300, 300

  # v2.9.0 EXAMPLE: Data-driven FX using fx_descriptor
  # Requires NS_FatherFXTemplate to be created by artist first
  # Uncomment when template is ready:
  #
  # - name: NS_ImpactFX_Fire
  #   folder: VFX/Impacts
  #   template_system: /Game/FatherCompanion/VFX/Systems/NS_FatherFXTemplate
  #   fx_descriptor:
  #     # Enable specific emitters
  #     particles_enabled: true
  #     burst_enabled: true
  #     light_enabled: true
  #     smoke_enabled: true
  #     # Core emission
  #     spawn_rate: 200.0
  #     lifetime: [0.3, 0.8]
  #     max_particles: 300
  #     # Appearance (Fire orange)
  #     color: [1.0, 0.4, 0.1, 1.0]
  #     size: [8.0, 20.0]
  #     opacity: 1.0
  #     emissive: 5.0
  #     # Motion
  #     initial_velocity: [0, 0, 150]
  #     noise_strength: 2.0
  #     gravity_scale: -0.3
  #     # Light
  #     light_intensity: 8000.0
  #     light_radius: 300.0

# ============================================================================
# ANIMATION ASSETS (7) - DISABLED: Blocked by SK_FatherCompanion (R1)
# Re-enable when skeleton mesh is imported
# ============================================================================
# animation_montages:
#   - name: AM_FatherAttack
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
#   - name: AM_FatherThrowWeb
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
#   - name: AM_FatherSacrifice
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
#   - name: AM_FatherReactivate
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
#   - name: AM_FatherDetach
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
#   - name: AM_FatherAttach
#     folder: Animations
#     skeleton: SK_FatherCompanion
#
# animation_notifies:
#   - name: NAS_FatherAttack
#     folder: Animations
#     montage: AM_FatherAttack

# ============================================================================
# MATERIALS (4) - v2.6.12 Enhanced with expression graphs
# ============================================================================
materials:
  # Core energy orb material for Father companion
  - name: M_FatherCore
    folder: Materials/VFX
    blend_mode: Additive
    shading_model: Unlit
    two_sided: true
    expressions:
      - id: core_color
        type: VectorParam
        name: CoreColor
        default: 1.0, 0.8, 0.4, 1.0
        pos_x: -400
        pos_y: 0
      - id: intensity
        type: ScalarParam
        name: EmissiveIntensity
        default: 100.0
        pos_x: -400
        pos_y: 100
      - id: fresnel
        type: Fresnel
        pos_x: -200
        pos_y: 200
        properties:
          exponent: 3.0
      - id: mul_fresnel
        type: Multiply
        pos_x: 0
        pos_y: 0
      - id: mul_intensity
        type: Multiply
        pos_x: 200
        pos_y: 0
    connections:
      - from: core_color
        from_output: RGB
        to: mul_fresnel
        to_input: A
      - from: fresnel
        from_output: Result
        to: mul_fresnel
        to_input: B
      - from: mul_fresnel
        from_output: Result
        to: mul_intensity
        to_input: A
      - from: intensity
        from_output: Result
        to: mul_intensity
        to_input: B
      - from: mul_intensity
        from_output: Result
        to: Material
        to_input: EmissiveColor

  # Outer shell material for Father companion
  - name: M_FatherShell
    folder: Materials/VFX
    blend_mode: Translucent
    shading_model: Unlit
    two_sided: true
    expressions:
      - id: edge_color
        type: VectorParam
        name: EdgeColor
        default: 0.4, 0.6, 1.0, 1.0
        pos_x: -400
        pos_y: 0
      - id: shell_intensity
        type: ScalarParam
        name: ShellIntensity
        default: 20.0
        pos_x: -400
        pos_y: 100
      - id: fresnel_power
        type: ScalarParam
        name: FresnelPower
        default: 3.0
        pos_x: -400
        pos_y: 200
      - id: base_opacity
        type: ScalarParam
        name: BaseOpacity
        default: 0.3
        pos_x: -400
        pos_y: 300
      - id: fresnel
        type: Fresnel
        pos_x: -200
        pos_y: 200
      - id: mul_color_intensity
        type: Multiply
        pos_x: -100
        pos_y: 50
      - id: mul_fresnel_color
        type: Multiply
        pos_x: 100
        pos_y: 100
    connections:
      # FresnelPower controls fresnel exponent (connected internally)
      - from: fresnel_power
        from_output: Result
        to: fresnel
        to_input: ExponentIn
      # EdgeColor * ShellIntensity = base emissive
      - from: edge_color
        from_output: RGB
        to: mul_color_intensity
        to_input: A
      - from: shell_intensity
        from_output: Result
        to: mul_color_intensity
        to_input: B
      # Fresnel * color_intensity = final emissive with edge glow
      - from: fresnel
        from_output: Result
        to: mul_fresnel_color
        to_input: A
      - from: mul_color_intensity
        from_output: Result
        to: mul_fresnel_color
        to_input: B
      - from: mul_fresnel_color
        from_output: Result
        to: Material
        to_input: EmissiveColor
      # BaseOpacity controls overall transparency
      - from: base_opacity
        from_output: Result
        to: Material
        to_input: Opacity

  # Particle trail material
  - name: M_FatherParticle
    folder: Materials/VFX
    blend_mode: Additive
    shading_model: Unlit
    two_sided: true
    expressions:
      - id: particle_color
        type: VectorParam
        name: ParticleColor
        default: 1.0, 0.9, 0.5, 1.0
        pos_x: -300
        pos_y: 0
      - id: intensity
        type: ScalarParam
        name: ParticleIntensity
        default: 2.0
        pos_x: -300
        pos_y: 100
      - id: mul
        type: Multiply
        pos_x: 0
        pos_y: 0
    connections:
      - from: particle_color
        from_output: RGB
        to: mul
        to_input: A
      - from: intensity
        from_output: Result
        to: mul
        to_input: B
      - from: mul
        from_output: Result
        to: Material
        to_input: EmissiveColor

  # Laser beam material
  - name: M_LaserGlow
    folder: Materials/VFX
    blend_mode: Additive
    shading_model: Unlit
    expressions:
      - id: laser_color
        type: VectorParam
        name: LaserColor
        default: 1.0, 0.2, 0.2, 1.0
        pos_x: -400
        pos_y: 0
      - id: glow_intensity
        type: ScalarParam
        name: GlowIntensity
        default: 10.0
        pos_x: -400
        pos_y: 100
      - id: mul
        type: Multiply
        pos_x: -100
        pos_y: 0
    connections:
      - from: laser_color
        from_output: RGB
        to: mul
        to_input: A
      - from: glow_intensity
        from_output: Result
        to: mul
        to_input: B
      - from: mul
        from_output: Result
        to: Material
        to_input: EmissiveColor

# ============================================================================
# MATERIAL FUNCTIONS (3) - v2.6.12 VFX helper functions
# ============================================================================
material_functions:
  # Animated energy pulse effect
  - name: MF_EnergyPulse
    folder: Materials/Functions
    description: Generates animated energy pulse effect
    expose_to_library: true
    inputs:
      - name: Speed
        type: float
        default: 1.0
        sort_priority: 0
      - name: Amplitude
        type: float
        default: 0.5
        sort_priority: 1
    outputs:
      - name: Pulse
        type: float
        sort_priority: 0
    expressions:
      - id: time
        type: Time
        pos_x: -300
        pos_y: 0
      - id: speedMul
        type: Multiply
        pos_x: -150
        pos_y: 0
      - id: sine
        type: Sine
        pos_x: 0
        pos_y: 0
      - id: ampMul
        type: Multiply
        pos_x: 150
        pos_y: 0
    connections:
      - from: time
        to: speedMul
        to_input: A
      - from: Speed
        to: speedMul
        to_input: B
      - from: speedMul
        to: sine
        to_input: Input
      - from: sine
        to: ampMul
        to_input: A
      - from: Amplitude
        to: ampMul
        to_input: B
      - from: ampMul
        to: Pulse
        to_input: A

  # Fresnel-based glow effect
  - name: MF_FresnelGlow
    folder: Materials/Functions
    description: Fresnel-based edge glow effect
    expose_to_library: true
    inputs:
      - name: Exponent
        type: float
        default: 3.0
        sort_priority: 0
      - name: GlowColor
        type: float3
        default: 1.0, 0.8, 0.4
        sort_priority: 1
    outputs:
      - name: GlowResult
        type: float3
        sort_priority: 0
    expressions:
      - id: fresnel
        type: Fresnel
        pos_x: -100
        pos_y: 0
        properties:
          exponent: 3.0
      - id: mul
        type: Multiply
        pos_x: 100
        pos_y: 0
    connections:
      - from: Exponent
        to: fresnel
        to_input: ExponentIn
      - from: fresnel
        to: mul
        to_input: A
      - from: GlowColor
        to: mul
        to_input: B
      - from: mul
        to: GlowResult
        to_input: A

  # Radial gradient for dome/sphere effects
  - name: MF_RadialGradient
    folder: Materials/Functions
    description: Radial gradient for spherical effects
    expose_to_library: true
    inputs:
      - name: Center
        type: float2
        default: 0.5, 0.5
        sort_priority: 0
      - name: Falloff
        type: float
        default: 1.0
        sort_priority: 1
    outputs:
      - name: Gradient
        type: float
        sort_priority: 0
    expressions:
      - id: texcoord
        type: TexCoord
        pos_x: -300
        pos_y: 0
      - id: dist
        type: Distance
        pos_x: -100
        pos_y: 0
      - id: falloffMul
        type: Multiply
        pos_x: 50
        pos_y: 0
      - id: invert
        type: OneMinus
        pos_x: 200
        pos_y: 0
      - id: clampResult
        type: Clamp
        pos_x: 350
        pos_y: 0
    connections:
      - from: texcoord
        to: dist
        to_input: A
      - from: Center
        to: dist
        to_input: B
      - from: dist
        to: falloffMul
        to_input: A
      - from: Falloff
        to: falloffMul
        to_input: B
      - from: falloffMul
        to: invert
        to_input: Input
      - from: invert
        to: clampResult
        to_input: Input
      - from: clampResult
        to: Gradient
        to_input: A

# ============================================================================
# MATERIAL INSTANCES (v4.9) - Material Instance Constants for VFX variation
# ============================================================================
material_instances:
  # Core glow variant - high intensity orange for alert state
  - name: MIC_FatherCore_Alert
    folder: Materials/VFX/Instances
    parent_material: M_FatherCore
    scalar_parameters:
      EmissiveIntensity: 150.0
    vector_parameters:
      CoreColor: "(1.0, 0.4, 0.1, 1.0)"

  # Core glow variant - calm blue for idle state
  - name: MIC_FatherCore_Calm
    folder: Materials/VFX/Instances
    parent_material: M_FatherCore
    scalar_parameters:
      EmissiveIntensity: 50.0
    vector_parameters:
      CoreColor: "(0.4, 0.6, 1.0, 1.0)"

  # Core glow variant - green for healing/support state
  - name: MIC_FatherCore_Support
    folder: Materials/VFX/Instances
    parent_material: M_FatherCore
    scalar_parameters:
      EmissiveIntensity: 80.0
    vector_parameters:
      CoreColor: "(0.3, 1.0, 0.5, 1.0)"

  # Shell variant - high opacity for combat
  - name: MIC_FatherShell_Combat
    folder: Materials/VFX/Instances
    parent_material: M_FatherShell
    scalar_parameters:
      BaseOpacity: 0.6
      ShellIntensity: 30.0
    vector_parameters:
      EdgeColor: "(1.0, 0.3, 0.3, 1.0)"

  # Laser glow variant - red for damage beam
  - name: MIC_LaserGlow_Red
    folder: Materials/VFX/Instances
    parent_material: M_LaserGlow
    scalar_parameters:
      GlowIntensity: 15.0
    vector_parameters:
      GlowColor: "(1.0, 0.2, 0.1, 1.0)"

  # Laser glow variant - blue for utility beam
  - name: MIC_LaserGlow_Blue
    folder: Materials/VFX/Instances
    parent_material: M_LaserGlow
    scalar_parameters:
      GlowIntensity: 12.0
    vector_parameters:
      GlowColor: "(0.2, 0.5, 1.0, 1.0)"

# ============================================================================
# DIALOGUE BLUEPRINTS (1)
# ============================================================================
dialogue_blueprints:
  - name: DBP_FatherCompanion
    folder: Dialogue
    parent_class: Dialogue

# ============================================================================
# NPC SYSTEMS - WARDEN HUSK (Two-Phase Enemy)
# ============================================================================
tags:  # WARDEN SYSTEM
  - tag: State.Warden.Husk
    comment: Applied to husk entity
  - tag: State.Warden.Core
    comment: Applied to flying core
  - tag: State.Warden.Ejecting
    comment: During transition phase
  - tag: Faction.Enemy.Warden
    comment: Warden faction identifier
  - tag: Ability.Warden.CoreLaser
    comment: Laser attack ability
  - tag: Cooldown.Warden.CoreLaser
    comment: Laser cooldown tag
  - tag: Effect.Damage.WardenLaser
    comment: Laser damage type

gameplay_effects:  # WARDEN SYSTEM
  - name: GE_CoreLaserDamage
    folder: Enemies/Warden/Effects
    duration_policy: Instant

  - name: GE_CoreLaserCooldown
    folder: Enemies/Warden/Effects
    duration_policy: HasDuration
    duration_magnitude: 1.5
    granted_tags:
      - Cooldown.Warden.CoreLaser

  - name: GE_WardenHuskAttributes
    folder: Enemies/Warden/Effects
    duration_policy: Instant

  - name: GE_WardenCoreAttributes
    folder: Enemies/Warden/Effects
    duration_policy: Instant

actor_blueprints:  # WARDEN SYSTEM
  - name: BP_WardenHusk
    folder: Enemies/Warden
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (HandleDeath override needed for Core spawn)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "WardenHusk Active - HandleDeath spawns Core"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]
    # v2.8.3: Function override for death spawning
    function_overrides:
      - function: HandleDeath
        nodes:
          - id: HasAuth
            type: CallFunction
            properties:
              function: HasAuthority
              class: Actor
              target_self: true
            position: [200, 0]
          - id: AuthBranch
            type: Branch
            position: [400, 0]
          - id: PrintSpawning
            type: PrintString
            properties:
              message: "WardenHusk HandleDeath: Spawning BP_WardenCore"
            position: [600, 0]
          - id: CallParentDeath
            type: CallParent
            position: [800, 0]
        connections:
          - from: [FunctionEntry, Then]
            to: [HasAuth, Exec]
          - from: [HasAuth, ReturnValue]
            to: [AuthBranch, Condition]
          - from: [AuthBranch, True]
            to: [PrintSpawning, Exec]
          - from: [PrintSpawning, Then]
            to: [CallParentDeath, Exec]
          - from: [AuthBranch, False]
            to: [CallParentDeath, Exec]

  - name: BP_WardenCore
    folder: Enemies/Warden
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Set Flying movement mode for hovering behavior
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: SelfRef
          type: Self
          position: [100, 100]
        - id: GetCharMovement
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [300, 0]
        - id: SetMovementMode
          type: CallFunction
          properties:
            function: SetMovementMode
            class: CharacterMovementComponent
            parameters:
              NewMovementMode: Flying
          position: [600, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [SetMovementMode, Exec]
        - from: [SelfRef, Self]
          to: [GetCharMovement, Target]
        - from: [GetCharMovement, CharacterMovement]
          to: [SetMovementMode, Target]

  - name: BP_CoreLaserProjectile
    folder: Enemies/Warden
    parent_class: NarrativeProjectile

materials:  # WARDEN SYSTEM
  - name: M_CoreLaserGlow
    folder: Enemies/Warden/Materials
    blend_mode: Additive
    shading_model: Unlit

gameplay_abilities:  # WARDEN SYSTEM (NOT Father Companion - see Warden_Husk_System_Implementation_Guide_v1_2.md)
  # GA_CoreLaser - Warden Core Laser Attack
  # v4.14: Added minimal event_graph per GAS Audit CRIT-4 (instant ability pattern)
  - name: GA_CoreLaser
    folder: Enemies/Warden/Abilities
    parent_class: NarrativeGameplayAbility
    instancing_policy: InstancedPerActor
    net_execution_policy: ServerOnly
    cooldown_gameplay_effect_class: GE_CoreLaserCooldown
    tags:
      ability_tags:
        - Ability.Warden.CoreLaser
      activation_blocked_tags:
        - Cooldown.Warden.CoreLaser
    event_graph:
      nodes:
        - id: Event_Activate
          type: Event
          properties:
            event_name: K2_ActivateAbility
          position: [0, 0]
        - id: CommitCooldown
          type: CallFunction
          properties:
            function: K2_CommitAbilityCooldown
            target_self: true
          position: [300, 0]
        - id: EndAbility
          type: CallFunction
          properties:
            function: K2_EndAbility
            target_self: true
          position: [600, 0]
      connections:
        - from: [Event_Activate, Then]
          to: [CommitCooldown, Exec]
        - from: [CommitCooldown, Exec]
          to: [EndAbility, Exec]

# ============================================================================
# NPC SYSTEMS - GUARD FORMATION
# ============================================================================
tags:  # GUARD FORMATION
  - tag: Narrative.State.NPC.Activity.FormationFollow
    comment: NPC is following in formation

blackboards:  # GUARD FORMATION
  - name: BB_FormationFollow
    folder: AI/Blackboards
    keys:
      - key_name: SelfActor
        key_type: Object
        base_class: Actor
      - key_name: FollowTarget
        key_type: Object
        base_class: Actor
      - key_name: TargetCharacter
        key_type: Object
        base_class: Actor
      - key_name: FormationOffset
        key_type: Vector
      - key_name: TargetLocation
        key_type: Vector

behavior_trees:  # GUARD FORMATION
  - name: BT_FormationFollow
    folder: AI/BehaviorTrees
    blackboard: BB_FormationFollow
    root_type: Selector
    description: Formation follow behavior
    nodes:
      # Root Selector - Formation follow with position calculation
      - id: root_selector
        type: Selector
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: TargetCharacter
            key_query: IsSet
        children:
          - formation_sequence
      # Formation Sequence - Calculate position and move
      - id: formation_sequence
        type: Sequence
        services:
          - class: BTS_CalculateFormationPosition
            interval: 0.25
          - class: BTS_AdjustFormationSpeed
            interval: 0.1
        children:
          - move_to_formation
      - id: move_to_formation
        type: Task
        task_class: BTTask_MoveTo
        blackboard_key: TargetLocation
        properties:
          AcceptableRadius: "50.0"

activities:  # GUARD FORMATION
  - name: BPA_FormationFollow
    folder: AI/Activities
    parent_class: NarrativeActivityBase
    behavior_tree: BT_FormationFollow

  - name: BPA_Attack_Formation
    folder: AI/Activities
    parent_class: BPA_Attack_Melee

actor_blueprints:  # GUARD FORMATION BT SERVICES
  - name: BTS_CalculateFormationPosition
    folder: AI/Services
    parent_class: BTService_BlueprintBase

  - name: BTS_AdjustFormationSpeed
    folder: AI/Services
    parent_class: BTService_BlueprintBase

goals:  # GUARD FORMATION
  - name: Goal_FormationFollow
    folder: AI/Goals
    parent_class: Goal_FollowCharacter

# ============================================================================
# NPC SYSTEMS - POSSESSED EXPLODER
# ============================================================================
tags:  # POSSESSED EXPLODER
  - tag: State.Enemy.PossessedExploder
    comment: NPC identifier
  - tag: State.Enemy.Exploder.Alert
    comment: Applied during alert state
  - tag: Faction.Enemy.Possessed
    comment: Possessed faction identifier
  - tag: Effect.Enemy.ExplosionDamage
    comment: Explosion damage effect tag
  - tag: GameplayCue.Enemy.Exploder.Alert
    comment: Alert VFX/SFX trigger
  - tag: GameplayCue.Enemy.Exploder.Explosion
    comment: Explosion VFX/SFX trigger

gameplay_effects:  # POSSESSED EXPLODER
  - name: GE_ExploderAttributes
    folder: Enemies/Possessed/Effects
    duration_policy: Instant

  - name: GE_ExplosionDamage
    folder: Enemies/Possessed/Effects
    duration_policy: Instant

actor_blueprints:  # POSSESSED EXPLODER
  - name: BP_PossessedExploder
    folder: Enemies/Possessed
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Set Flying movement mode for hovering behavior
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: SelfRef
          type: Self
          position: [100, 100]
        - id: GetCharMovement
          type: PropertyGet
          properties:
            property_name: CharacterMovement
            target_class: Character
          position: [300, 0]
        - id: SetMovementMode
          type: CallFunction
          properties:
            function: SetMovementMode
            class: CharacterMovementComponent
            parameters:
              NewMovementMode: Flying
          position: [600, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [SetMovementMode, Exec]
        - from: [SelfRef, Self]
          to: [GetCharMovement, Target]
        - from: [GetCharMovement, CharacterMovement]
          to: [SetMovementMode, Target]

actor_blueprints:  # POSSESSED EXPLODER BT SERVICES
  - name: BTS_CheckExplosionProximity
    folder: AI/Services
    parent_class: BTService_BlueprintBase

behavior_trees:  # POSSESSED EXPLODER
# NOTE: Uses NarrativePro's BB_Attack at /NarrativePro/Pro/Core/AI/Activities/Attacks/
  - name: BT_Explode
    folder: AI/BehaviorTrees
    blackboard: BB_Attack
    root_type: Selector
    description: Suicide explosion behavior
    nodes:
      # Selector - Only run if AttackTarget is set
      - id: root_selector
        type: Selector
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: AttackTarget
            key_query: IsSet
            notify_observer: OnResultChange
        children:
          - pursuit_sequence
      # Sequence - Pursue target with proximity check service
      - id: pursuit_sequence
        type: Sequence
        services:
          - class: BTS_CheckExplosionProximity
            interval: 0.1
        children:
          - move_to_target
      # Move To - Chase the attack target
      - id: move_to_target
        type: Task
        task_class: BTTask_MoveTo
        blackboard_key: AttackTarget
        properties:
          AcceptableRadius: "50.0"
          bAllowStrafe: "false"
          bReachTestIncludesAgentRadius: "true"
          bTrackMovingGoal: "true"

activities:  # POSSESSED EXPLODER
  - name: BPA_Explode
    folder: AI/Activities
    parent_class: NarrativeActivityBase
    behavior_tree: BT_Explode

# ============================================================================
# NPC SYSTEMS - SUPPORT BUFFER
# ============================================================================
tags:  # SUPPORT BUFFER
  - tag: State.NPC.SupportBuffer
    comment: NPC identifier
  - tag: State.NPC.Support.Healing
    comment: Applied during heal action
  - tag: Faction.Friendly.Support
    comment: Support faction identifier
  - tag: Effect.Support.Heal
    comment: Heal effect tag
  - tag: Effect.Support.SpeedBoost
    comment: Speed boost effect tag
  - tag: GameplayCue.Support.Heal
    comment: Heal VFX/SFX trigger

gameplay_effects:  # SUPPORT BUFFER
  - name: GE_SupporterAttributes
    folder: NPCs/Support/Effects
    duration_policy: Instant

  - name: GE_SupportHeal
    folder: NPCs/Support/Effects
    duration_policy: Instant

actor_blueprints:  # SUPPORT BUFFER
  - name: BP_SupportBuffer
    folder: NPCs/Support
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (healing via BTS_HealNearbyAllies service)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "SupportBuffer Active - Healing via service"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]

actor_blueprints:  # SUPPORT BUFFER BT SERVICES
  - name: BTS_HealNearbyAllies
    folder: AI/Services
    parent_class: BTService_BlueprintBase

behavior_trees:  # SUPPORT BUFFER
# NOTE: Uses NarrativePro's BB_FollowCharacter at /NarrativePro/Pro/Core/AI/Activities/FollowCharacter/
  - name: BT_SupportFollow
    folder: AI/BehaviorTrees
    blackboard: BB_FollowCharacter
    root_type: Selector
    description: Support follow with healing behavior
    nodes:
      # Root Selector - Follow target while healing allies
      - id: root_selector
        type: Selector
        decorators:
          - class: BTDecorator_Blackboard
            blackboard_key: TargetCharacter
            key_query: IsSet
        children:
          - follow_heal_sequence
      # Follow Sequence - Move to target while healing nearby allies
      - id: follow_heal_sequence
        type: Sequence
        services:
          - class: BTS_HealNearbyAllies
            interval: 1.0
        children:
          - move_to_target
      - id: move_to_target
        type: Task
        task_class: BTTask_MoveTo
        blackboard_key: TargetCharacter
        properties:
          AcceptableRadius: "150.0"

activities:  # SUPPORT BUFFER
  - name: BPA_SupportFollow
    folder: AI/Activities
    parent_class: BPA_FollowCharacter
    behavior_tree: BT_SupportFollow

# ============================================================================
# NPC SYSTEMS - BIOMECHANICAL DETACHMENT
# ============================================================================
tags:  # BIOMECH
  - tag: State.Biomech.Host
    comment: Applied to combined host entity
  - tag: State.Biomech.Creature
    comment: Applied to detached creature
  - tag: State.Biomech.Detaching
    comment: During transition phase
  - tag: Faction.Enemy.Biomech
    comment: Biomech faction identifier

gameplay_effects:  # BIOMECH
  - name: GE_BiomechHostAttributes
    folder: Enemies/Biomech/Effects
    duration_policy: Instant

  - name: GE_BiomechCreatureAttributes
    folder: Enemies/Biomech/Effects
    duration_policy: Instant

actor_blueprints:  # BIOMECH
  - name: BP_BiomechHost
    folder: Enemies/Biomech
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (HandleDeath override needed for Creature spawn)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "BiomechHost Active - HandleDeath spawns Creature"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]
    # v2.8.3: Function override for death spawning
    function_overrides:
      - function: HandleDeath
        nodes:
          - id: HasAuth
            type: CallFunction
            properties:
              function: HasAuthority
              class: Actor
              target_self: true
            position: [200, 0]
          - id: AuthBranch
            type: Branch
            position: [400, 0]
          - id: PrintSpawning
            type: PrintString
            properties:
              message: "BiomechHost HandleDeath: Spawning BP_BiomechCreature"
            position: [600, 0]
          - id: CallParentDeath
            type: CallParent
            position: [800, 0]
        connections:
          - from: [FunctionEntry, Then]
            to: [HasAuth, Exec]
          - from: [HasAuth, ReturnValue]
            to: [AuthBranch, Condition]
          - from: [AuthBranch, True]
            to: [PrintSpawning, Exec]
          - from: [PrintSpawning, Then]
            to: [CallParentDeath, Exec]
          - from: [AuthBranch, False]
            to: [CallParentDeath, Exec]

  - name: BP_BiomechCreature
    folder: Enemies/Biomech
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (spawned from BiomechHost death)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "BiomechCreature Detached - Combat mode"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]

# ============================================================================
# NPC SYSTEMS - GATHERER SCOUT
# ============================================================================
tags:  # GATHERER
  - tag: State.NPC.Alert.Signaling
    comment: Applied during alert animation
  - tag: Faction.Enemy.Gatherer
    comment: Gatherer faction identifier
  - tag: Faction.Enemy.Reinforcement
    comment: Reinforcement faction identifier
  - tag: Goal.Alert
    comment: Goal type identifier

actor_blueprints:  # GATHERER
  - name: BP_GathererScout
    folder: Enemies/Gatherer
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (alert behavior via GoalGenerator_Alert)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "GathererScout Active - Alert via GoalGenerator"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]

  - name: BP_Reinforcement
    folder: Enemies/Gatherer
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (spawned by GathererScout alert)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "Reinforcement Deployed - Moving to alert location"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]

goals:  # GATHERER
  - name: Goal_Alert
    folder: AI/Goals
    parent_class: NPCGoalItem

actor_blueprints:  # GATHERER GOAL GENERATORS
  - name: GoalGenerator_Alert
    folder: AI/GoalGenerators
    parent_class: NPCGoalGenerator

activities:  # GATHERER
  - name: BPA_Alert
    folder: AI/Activities
    parent_class: NarrativeActivityBase

  - name: BPA_Gather
    folder: AI/Activities
    parent_class: NarrativeActivityBase

# ============================================================================
# NPC SYSTEMS - STALKER RANDOM AGGRESSION
# ============================================================================
tags:  # STALKER
  - tag: State.NPC.Returned.Following
    comment: Applied during follow state
  - tag: State.NPC.Returned.Bonded
    comment: Applied when TalkCount > 0
  - tag: State.NPC.Returned.Defending
    comment: Applied while defending player
  - tag: State.NPC.Returned.Aggressive
    comment: Applied after attacking player
  - tag: Narrative.TaggedDialogue.Returned.StartFollowing
    comment: When follow begins
  - tag: Narrative.TaggedDialogue.Returned.Following.First
    comment: First talk (TalkCount = 1)
  - tag: Narrative.TaggedDialogue.Returned.Following.Bonding
    comment: TalkCount 2-3
  - tag: Narrative.TaggedDialogue.Returned.Following.Deep
    comment: TalkCount 4+
  - tag: Narrative.TaggedDialogue.Returned.Defending
    comment: When defending player
  - tag: Narrative.TaggedDialogue.Returned.Attacking
    comment: When attacking player
  - tag: Narrative.TaggedDialogue.Returned.GivingUp
    comment: When timeout expires

  # Father Tagged Dialogue Tags (6)
  - tag: Narrative.TaggedDialogue.Father.Combat
    comment: Father combat barks
  - tag: Narrative.TaggedDialogue.Father.Damaged
    comment: Father damaged barks
  - tag: Narrative.TaggedDialogue.Father.FormChange
    comment: Father form change barks
  - tag: Narrative.TaggedDialogue.Father.Idle
    comment: Father idle barks
  - tag: Narrative.TaggedDialogue.Father.Reactivate
    comment: Father reactivation barks
  - tag: Narrative.TaggedDialogue.Father.Sacrifice
    comment: Father sacrifice barks

actor_blueprints:  # STALKER
  - name: BP_ReturnedStalker
    folder: NPCs/Returned
    parent_class: NarrativeNPCCharacter
    event_graph:
      nodes:
        # BeginPlay - Log spawn (behavior via GoalGenerator_RandomAggression)
        - id: Event_BeginPlay
          type: Event
          properties:
            event_name: ReceiveBeginPlay
          position: [0, 0]
        - id: PrintReady
          type: CallFunction
          properties:
            function: PrintString
            class: KismetSystemLibrary
            parameters:
              InString: "ReturnedStalker Active - Random aggression mode"
          position: [300, 0]
      connections:
        - from: [Event_BeginPlay, Then]
          to: [PrintReady, Exec]

actor_blueprints:  # STALKER GOAL GENERATORS
  - name: GoalGenerator_RandomAggression
    folder: AI/GoalGenerators
    parent_class: NPCGoalGenerator

tagged_dialogue_sets:  # STALKER
  - name: TaggedDialogueSet_Returned
    folder: Dialogue/TaggedSets
    dialogues:
      - tag: Narrative.TaggedDialogue.Returned.StartFollowing
        cooldown: 30.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.Following.First
        cooldown: 30.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.Following.Bonding
        cooldown: 30.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.Following.Deep
        cooldown: 30.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.Defending
        cooldown: 5.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.Attacking
        cooldown: 5.0
        max_distance: 5000.0
      - tag: Narrative.TaggedDialogue.Returned.GivingUp
        cooldown: 30.0
        max_distance: 5000.0

# ============================================================================
# END OF MANIFEST
# ============================================================================
